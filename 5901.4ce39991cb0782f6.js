"use strict";(self.webpackChunkcheapflightclient=self.webpackChunkcheapflightclient||[]).push([[5901],{85901:(Qe,P,h)=>{h.r(P),h.d(P,{BookingSuccessPageComponent:()=>je});var C=h(36895),F=h(37094),U=h(83700),O=h(87683),f=h(72506),L=h(44143),M=h(7800),x=h(15535),k=h(7542),q=h(20348),y=h(4482),B=h(89319),K=h(26655),w=h(80296),j=h(44500),g=h(40899),H=h(89701),Y=h(64190),A=h(44586),D=h(52013),Z=h(50494),_=h(15439),V=h(88996),$=h(95577),J=h(54004),Q=h(70262),I=h(39646),G=h(57359),R=h(54482);const z=(l,u)=>(l.push(u),l);var E=h(28746),e=h(94650),ee=h(3803),te=h(4520),ie=h(36634),oe=h(86432),ae=h(3193),ne=h(62733),se=h(28490),re=h(97579),le=h(35991),ce=h(64425),ge=h(82761),de=h(62331),he=h(22340),ue=h(95293),me=h(9381),pe=h(56684),ve=h(77492);function be(l,u){1&l&&e._UZ(0,"cf-spinner")}function fe(l,u){if(1&l&&(e.TgZ(0,"div",25)(1,"div",5),e._UZ(2,"div",6),e.TgZ(3,"div",7),e._uU(4,"Th\xf4ng tin h\xe0nh kh\xe1ch"),e.qZA()(),e._UZ(5,"booking-passenger-info",26),e.qZA()),2&l){const t=e.oxw();e.xp6(5),e.Q6J("passengerInfos",t.passengerInfos)}}const Te=function(){return["BOOKED","ISSUED"]};function ke(l,u){if(1&l){const t=e.EpF();e.TgZ(0,"booking-detail",27),e.NdJ("actionChange",function(i){const a=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.onActionChange(i,a))})("retryBooking",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.onRetryBooking(i))}),e.qZA()}if(2&l){const t=u.$implicit;e.Q6J("bookingDetail",t)("isBooked",e.DdM(2,Te).includes(t.status))}}function _e(l,u){if(1&l&&(e.TgZ(0,"tr")(1,"td",35),e._UZ(2,"img",36),e.qZA(),e.TgZ(3,"td",35),e._uU(4),e.qZA(),e.TgZ(5,"td",35),e._uU(6),e.qZA(),e.TgZ(7,"td",35),e._uU(8),e.qZA(),e.TgZ(9,"td",35),e._uU(10),e.qZA(),e.TgZ(11,"td",35),e._uU(12),e.ALo(13,"number"),e.qZA()()),2&l){const t=u.$implicit;e.xp6(2),e.Q6J("src",t.airlineLogo,e.LSH),e.xp6(2),e.Oqu(t.flight),e.xp6(2),e.Oqu(t.departDate),e.xp6(2),e.Oqu(t.passengerName),e.xp6(2),e.Oqu(t.serviceName),e.xp6(2),e.Oqu(e.lcZ(13,6,t.totalCharge))}}function Ce(l,u){if(1&l&&(e.TgZ(0,"div",28)(1,"div",29)(2,"span",30),e._uU(3,"H\xe0nh l\xfd & d\u1ecbch v\u1ee5 kh\xe1c"),e.qZA()(),e.TgZ(4,"div")(5,"table",31)(6,"thead")(7,"tr",32)(8,"th",33),e._uU(9,"H\xe3ng bay"),e.qZA(),e.TgZ(10,"th",33),e._uU(11,"Chuy\u1ebfn bay"),e.qZA(),e.TgZ(12,"th",33),e._uU(13,"Ng\xe0y \u0111i"),e.qZA(),e.TgZ(14,"th",33),e._uU(15,"H\xe0nh kh\xe1ch"),e.qZA(),e.TgZ(16,"th",33),e._uU(17,"T\xean d\u1ecbch v\u1ee5"),e.qZA(),e.TgZ(18,"th",33),e._uU(19,"T\u1ed5ng gi\xe1"),e.qZA()()(),e.TgZ(20,"tbody"),e.YNc(21,_e,14,8,"tr",34),e.qZA()()()()),2&l){const t=e.oxw();e.xp6(21),e.Q6J("ngForOf",t.listBaggage)}}function xe(l,u){if(1&l&&(e.TgZ(0,"tr")(1,"td",35),e._UZ(2,"img",36),e.qZA(),e.TgZ(3,"td",35),e._uU(4),e.qZA(),e.TgZ(5,"td",35),e._uU(6),e.qZA(),e.TgZ(7,"td",35),e._uU(8),e.qZA(),e.TgZ(9,"td",35),e._uU(10),e.qZA(),e.TgZ(11,"td",35),e._uU(12),e.ALo(13,"number"),e.qZA()()),2&l){const t=u.$implicit;e.xp6(2),e.Q6J("src",t.airlineLogo,e.LSH),e.xp6(2),e.Oqu(t.flight),e.xp6(2),e.Oqu(t.departDate),e.xp6(2),e.Oqu(t.passengerName),e.xp6(2),e.Oqu(t.serviceName),e.xp6(2),e.Oqu(e.lcZ(13,6,t.totalCharge))}}function Se(l,u){if(1&l&&(e.TgZ(0,"div",28)(1,"div",29)(2,"span",30),e._uU(3,"D\u1ecbch v\u1ee5"),e.qZA()(),e.TgZ(4,"div")(5,"table",31)(6,"thead")(7,"tr",32)(8,"th",33),e._uU(9,"H\xe3ng bay"),e.qZA(),e.TgZ(10,"th",33),e._uU(11,"Chuy\u1ebfn bay"),e.qZA(),e.TgZ(12,"th",33),e._uU(13,"Ng\xe0y \u0111i"),e.qZA(),e.TgZ(14,"th",33),e._uU(15,"H\xe0nh kh\xe1ch"),e.qZA(),e.TgZ(16,"th",33),e._uU(17,"T\xean d\u1ecbch v\u1ee5"),e.qZA(),e.TgZ(18,"th",33),e._uU(19,"T\u1ed5ng gi\xe1"),e.qZA()()(),e.TgZ(20,"tbody"),e.YNc(21,xe,14,8,"tr",34),e.qZA()()()()),2&l){const t=e.oxw();e.xp6(21),e.Q6J("ngForOf",t.listService)}}function ye(l,u){if(1&l&&(e.TgZ(0,"div")(1,"div",37),e._UZ(2,"div",6),e.TgZ(3,"div",7),e._uU(4,"T\u1ed5ng chi ph\xed h\xe0nh tr\xecnh"),e.qZA()(),e.TgZ(5,"div",38),e._UZ(6,"price-detail",39),e.TgZ(7,"div",40)(8,"div",41)(9,"div",42),e._uU(10,"T\u1ed5ng chi ph\xed"),e.qZA(),e.TgZ(11,"div",43),e._uU(12),e.ALo(13,"replace"),e.ALo(14,"number"),e.qZA()()()()()),2&l){const t=e.oxw();e.xp6(6),e.Q6J("priceDetail",t.priceDetail),e.xp6(6),e.hij("",e.Dn7(13,2,e.lcZ(14,6,t.totalPrice),",",".")," \u0111")}}function Be(l,u){if(1&l){const t=e.EpF();e.TgZ(0,"booking-detail-mobile",47),e.NdJ("onDetailClick",function(){const n=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.mobileDetailClick(n))})("actionChange",function(i){const a=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.onActionChange(i,a))})("retryBooking",function(i){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onRetryBooking(i))}),e.qZA()}2&l&&e.Q6J("bookingDetail",u.$implicit)}function Ae(l,u){1&l&&(e.TgZ(0,"div",52),e._uU(1,"H\xe0nh l\xfd & d\u1ecbch v\u1ee5 kh\xe1c"),e.qZA())}function Ee(l,u){if(1&l&&(e.TgZ(0,"div",53)(1,"div",54)(2,"div",55),e._uU(3,"H\xe3ng bay"),e.qZA(),e.TgZ(4,"div",56),e._uU(5),e.qZA()(),e.TgZ(6,"div",54)(7,"div",55),e._uU(8,"H\xe0nh kh\xe1ch"),e.qZA(),e.TgZ(9,"div",56),e._uU(10),e.qZA()(),e.TgZ(11,"div",54)(12,"div",55),e._uU(13,"Chuy\u1ebfn bay"),e.qZA(),e.TgZ(14,"div",56),e._uU(15),e.qZA()(),e.TgZ(16,"div",54)(17,"div",55),e._uU(18,"Ng\xe0y \u0111i"),e.qZA(),e.TgZ(19,"div",56),e._uU(20),e.qZA()(),e.TgZ(21,"div",54)(22,"div",55),e._uU(23,"T\xean d\u1ecbch v\u1ee5"),e.qZA(),e.TgZ(24,"div",56),e._uU(25),e.qZA()(),e.TgZ(26,"div",54)(27,"div",55),e._uU(28,"T\u1ed5ng gi\xe1"),e.qZA(),e.TgZ(29,"div",56),e._uU(30),e.ALo(31,"replace"),e.ALo(32,"number"),e.qZA()()()),2&l){const t=u.$implicit;e.xp6(5),e.Oqu(t.airlineName),e.xp6(5),e.Oqu(t.passengerName),e.xp6(5),e.Oqu(t.flight),e.xp6(5),e.Oqu(t.departDate),e.xp6(5),e.Oqu(t.serviceName),e.xp6(5),e.hij("",e.Dn7(31,6,e.lcZ(32,10,t.totalCharge),",","."),"\u0111")}}function De(l,u){if(1&l&&(e.TgZ(0,"div",48)(1,"cf-collapse",48)(2,"cf-collapse-panel",49),e.YNc(3,Ae,2,0,"ng-template",null,50,e.W1O),e.YNc(5,Ee,33,12,"div",51),e.qZA()()()),2&l){const t=e.MAs(4),o=e.oxw(2);e.xp6(2),e.Q6J("title",t)("active",!1)("contentClass","!p-0 bg-transparent")("panelClass","!p-3 bg-neutral-white rounded-lg"),e.xp6(3),e.Q6J("ngForOf",o.listBaggage)}}function Ze(l,u){1&l&&(e.TgZ(0,"div",52),e._uU(1,"D\u1ecbch v\u1ee5"),e.qZA())}function Ie(l,u){if(1&l&&(e.TgZ(0,"div",53)(1,"div",54)(2,"div",55),e._uU(3,"H\xe3ng bay"),e.qZA(),e.TgZ(4,"div",56),e._uU(5),e.qZA()(),e.TgZ(6,"div",54)(7,"div",55),e._uU(8,"H\xe0nh kh\xe1ch"),e.qZA(),e.TgZ(9,"div",56),e._uU(10),e.qZA()(),e.TgZ(11,"div",54)(12,"div",55),e._uU(13,"Chuy\u1ebfn bay"),e.qZA(),e.TgZ(14,"div",56),e._uU(15),e.qZA()(),e.TgZ(16,"div",54)(17,"div",55),e._uU(18,"Ng\xe0y \u0111i"),e.qZA(),e.TgZ(19,"div",56),e._uU(20),e.qZA()(),e.TgZ(21,"div",54)(22,"div",55),e._uU(23,"T\xean d\u1ecbch v\u1ee5"),e.qZA(),e.TgZ(24,"div",56),e._uU(25),e.qZA()(),e.TgZ(26,"div",54)(27,"div",55),e._uU(28,"T\u1ed5ng gi\xe1"),e.qZA(),e.TgZ(29,"div",56),e._uU(30),e.ALo(31,"replace"),e.ALo(32,"number"),e.qZA()()()),2&l){const t=u.$implicit;e.xp6(5),e.Oqu(t.airlineName),e.xp6(5),e.Oqu(t.passengerName),e.xp6(5),e.Oqu(t.flight),e.xp6(5),e.Oqu(t.departDate),e.xp6(5),e.Oqu(t.serviceName),e.xp6(5),e.hij("",e.Dn7(31,6,e.lcZ(32,10,t.totalCharge),",","."),"\u0111")}}function Ne(l,u){if(1&l&&(e.TgZ(0,"div",48)(1,"cf-collapse",48)(2,"cf-collapse-panel",49),e.YNc(3,Ze,2,0,"ng-template",null,50,e.W1O),e.YNc(5,Ie,33,12,"div",51),e.qZA()()()),2&l){const t=e.MAs(4),o=e.oxw(2);e.xp6(2),e.Q6J("title",t)("active",!1)("contentClass","!p-0 bg-transparent")("panelClass","!p-3 bg-neutral-white rounded-lg"),e.xp6(3),e.Q6J("ngForOf",o.listService)}}function Pe(l,u){if(1&l&&(e.TgZ(0,"div",44),e.YNc(1,Be,1,1,"booking-detail-mobile",45),e.YNc(2,De,6,5,"div",46),e.YNc(3,Ne,6,5,"div",46),e.qZA()),2&l){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.bookingDetails),e.xp6(1),e.Q6J("ngIf",t.hasBaggageSelected),e.xp6(1),e.Q6J("ngIf",t.hasSeatSelected)}}function Fe(l,u){if(1&l&&(e.TgZ(0,"div",58)(1,"div",54)(2,"div",55),e._uU(3,"H\xe0nh kh\xe1ch"),e.qZA(),e.TgZ(4,"div",56),e._uU(5),e.qZA()(),e.TgZ(6,"div",54)(7,"div",55),e._uU(8,"Lo\u1ea1i h\xe0nh kh\xe1ch"),e.qZA(),e.TgZ(9,"div",56),e._uU(10),e.qZA()(),e.TgZ(11,"div",54)(12,"div",55),e._uU(13,"Ng\xe0y sinh"),e.qZA(),e.TgZ(14,"div",56),e._uU(15),e.qZA()(),e.TgZ(16,"div",54)(17,"div",55),e._uU(18,"Gi\u1edbi t\xednh"),e.qZA(),e.TgZ(19,"div",56),e._uU(20),e.qZA()()()),2&l){const t=u.$implicit;e.xp6(5),e.Oqu(t.name),e.xp6(5),e.Oqu(t.type),e.xp6(5),e.Oqu(t.birthday),e.xp6(5),e.Oqu(t.sex)}}function Oe(l,u){if(1&l&&(e.TgZ(0,"div",44)(1,"div",52),e._uU(2,"Th\xf4ng tin kh\xe1ch h\xe0ng"),e.qZA(),e.YNc(3,Fe,21,4,"div",57),e.TgZ(4,"div",52),e._uU(5,"Th\xf4ng tin li\xean h\u1ec7"),e.qZA(),e.TgZ(6,"div",58)(7,"div",54)(8,"div",55),e._uU(9,"M\xe3 v\xf9ng"),e.qZA(),e.TgZ(10,"div",56),e._uU(11,"+84"),e.qZA()(),e.TgZ(12,"div",54)(13,"div",55),e._uU(14,"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i"),e.qZA(),e.TgZ(15,"div",56),e._uU(16),e.qZA()(),e.TgZ(17,"div",54)(18,"div",55),e._uU(19,"Email"),e.qZA(),e.TgZ(20,"div",56),e._uU(21),e.qZA()()()()),2&l){const t=e.oxw();e.xp6(3),e.Q6J("ngForOf",t.passengerInfos),e.xp6(13),e.Oqu(t.bookingContact.phone),e.xp6(5),e.Oqu(t.bookingContact.email)}}function Me(l,u){if(1&l&&(e.TgZ(0,"div",58)(1,"div",54)(2,"div",55),e._uU(3,"H\xe0nh kh\xe1ch"),e.qZA(),e.TgZ(4,"div",56),e._uU(5),e.qZA()(),e.TgZ(6,"div",54)(7,"div",55),e._uU(8,"Lo\u1ea1i kh\xe1ch"),e.qZA(),e.TgZ(9,"div",56),e._uU(10),e.qZA()(),e.TgZ(11,"div",54)(12,"div",55),e._uU(13,"Gi\xe1 v\xe9"),e.qZA(),e.TgZ(14,"div",56),e._uU(15),e.ALo(16,"replace"),e.ALo(17,"number"),e.qZA()(),e.TgZ(18,"div",54)(19,"div",55),e._uU(20,"Thu\u1ebf ph\xed"),e.qZA(),e.TgZ(21,"div",56),e._uU(22),e.ALo(23,"replace"),e.ALo(24,"number"),e.qZA()(),e.TgZ(25,"div",54)(26,"div",55),e._uU(27,"T\u1ed5ng gi\xe1"),e.qZA(),e.TgZ(28,"div",56),e._uU(29),e.ALo(30,"replace"),e.ALo(31,"number"),e.qZA()()()),2&l){const t=u.$implicit;e.xp6(5),e.Oqu(t.name),e.xp6(5),e.Oqu(t.type),e.xp6(5),e.hij("",e.Dn7(16,5,e.lcZ(17,9,t.base),",","."),"\u0111 "),e.xp6(7),e.hij("",e.Dn7(23,11,e.lcZ(24,15,t.tax),",","."),"\u0111"),e.xp6(7),e.hij("",e.Dn7(30,17,e.lcZ(31,21,t.total),",","."),"\u0111 ")}}function Re(l,u){if(1&l&&(e.TgZ(0,"div",44),e.YNc(1,Me,32,23,"div",57),e.qZA()),2&l){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",null==t.priceDetail?null:t.priceDetail.passengers)}}function Ue(l,u){if(1&l&&(e.TgZ(0,"div",65)(1,"div",66)(2,"div",67)(3,"div",68)(4,"div",69),e._uU(5," Gi\xe1 v\xe9 m\xe1y bay "),e.qZA(),e.TgZ(6,"div",69),e._uU(7," D\u1ecbch v\u1ee5 c\u1ed9ng th\xeam "),e.qZA(),e.TgZ(8,"div",69),e._uU(9," Ph\xed d\u1ecbch v\u1ee5 "),e.qZA()()(),e.TgZ(10,"div",70)(11,"div",71),e._uU(12),e.ALo(13,"replace"),e.ALo(14,"number"),e.qZA(),e.TgZ(15,"div",71),e._uU(16),e.ALo(17,"replace"),e.ALo(18,"number"),e.qZA(),e.TgZ(19,"div",71),e._uU(20),e.ALo(21,"replace"),e.ALo(22,"number"),e.qZA()()()()),2&l){const t=e.oxw(2);e.xp6(12),e.hij(" ",e.Dn7(13,3,e.lcZ(14,7,t.priceDetail.totalBasePrice),",","."),"\u0111 "),e.xp6(4),e.hij(" ",e.Dn7(17,9,e.lcZ(18,13,t.priceDetail.totalAddonService),",","."),"\u0111 "),e.xp6(4),e.hij(" ",e.Dn7(21,15,e.lcZ(22,19,t.priceDetail.totalServiceFee),",","."),"\u0111 ")}}function Le(l,u){if(1&l){const t=e.EpF();e.TgZ(0,"div",59),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(11),n=e.oxw();return e.KtG(n.togglePriceBottomSheet(i))}),e.TgZ(1,"div",60)(2,"div",60)(3,"div",61),e._uU(4," T\u1ed5ng chi ph\xed: "),e.qZA(),e.TgZ(5,"div",62),e._uU(6),e.ALo(7,"replace"),e.ALo(8,"number"),e.qZA()(),e._UZ(9,"cf-icon",63),e.qZA(),e.YNc(10,Ue,23,21,"ng-template",null,64,e.W1O),e.qZA()}if(2&l){const t=e.oxw();e.ekj("z-1000",t.zIndexPriceIncrease),e.xp6(6),e.hij(" ",e.Dn7(7,3,e.lcZ(8,7,t.totalPrice),",",".")," \u0111 ")}}function qe(l,u){if(1&l){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",72)(2,"div",73),e.NdJ("click",function(){const n=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onShare(n.airline))}),e._UZ(3,"cf-icon",74),e.TgZ(4,"div",75),e._uU(5," Sao ch\xe9p "),e.qZA()(),e._UZ(6,"booking-text-origin",76),e.qZA(),e.BQk()}if(2&l){const t=u.$implicit;e.xp6(6),e.Q6J("bookingText",t)}}function Ke(l,u){if(1&l&&(e.TgZ(0,"div",44),e.YNc(1,qe,7,1,"ng-container",34),e.qZA()),2&l){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.listBookingText)}}function we(l,u){if(1&l&&(e.TgZ(0,"div",44),e._UZ(1,"remark-booking-page",13),e.qZA()),2&l){const t=e.oxw();e.xp6(1),e.Q6J("listBookingCode",t.listBookingCode)}}let je=(()=>{class l{constructor(t,o,i,n,a,s,r,c,d,m,v,T,p,b,S,N,He,Ye,Ve,$e,Je){this._flightDataService=s,this._locationDataService=r,this._bookingResultDataProvider=c,this._modal=d,this._manageBookingService=m,this.clipboard=v,this._route=T,this._bookFlightService=p,this._permissionService=b,this._toastService=S,this._searchFlightService=N,this._bottomSheetService=He,this._bookingDetailService=Ye,this._detectMobileService=Ve,this._ticketLowFareService=$e,this._eventLogService=Je,this.passengerInfos=[],this.bookingDetails=[],this.isSuccess=!1,this.dataBaggageInput=[],this.hasBaggageSelected=!1,this.dataSeatInput=[],this.hasSeatSelected=!1,this.listBaggage=[],this.listService=[],this.listJourneyBasic=[],this.isLoading=!1,this.listBookingText=[],this.listBookingTextExplain=[],this.modeBookingText="explain",this.listBookingCode=[],this.zIndexPriceIncrease=!1,this.firstLoad=!1,this.afterIssueBooking=!1,this.maxBag=10,this.mobileTabMode="BOOKING_DETAIL",i.registerIcons([f.xgX,f.Ey$,f.B2I,f.xgX,f.llu,f.bHT,f.QkI,f.ILM,f.tLH,f.xbi,f.NYs,f.okA,f.B2I,f.s5C,f.qDv,f.rks,f.Ffn,f._tC,f.fqi,f.n78,f.Hge,f.cnj]),this.ticketSelected=t.ticketSelectedData,this.bookFlightResult=(0,Z.yE)(y.aM,c.bookingResultData,{excludeExtraneousValues:!0}),this.firstLoad=c.firstBookingResult,c.firstBookingResult=!1,this.bookingRequest=o.bookingRequestData}ngOnInit(){this.isSuccess=this.bookFlightResult.data.some(t=>"OK"===t.status),this.isSuccess&&this.initPassenger(),this.initBookingDetail()}getBookingContact(){const t=this.bookFlightResult.data.find(o=>"OK"===o.status);this.bookingContact=t?t.bookingResult.bookingContact:this.bookingRequest.data.bookingContact}getBooingText(){const t=this.bookFlightResult.data.filter(o=>"OK"===o.status);this.listBookingText=t.filter(o=>o.bookingResult.bookingText).map(o=>{var i;return Object.assign(Object.assign({},o.bookingResult.bookingText),{airline:o.bookingResult.airline,totalPrice:new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(o.bookingResult.bookingText.totalPrice||0),timeLimit:null!==(i=o.bookingResult.bookDetail)&&void 0!==i&&i.timeHoldBooking?_(o.bookingResult.bookDetail.timeHoldBooking).format("HH:mm, DD/MM/YYYY"):""})}),this.listBookingTextExplain=t.filter(o=>o.bookingResult.bookingTextExplain).map(o=>o.bookingResult.bookingTextExplain)}getAirlineLogo(t){return this._flightDataService.getAirlineLogoByCode(t)}initPassenger(){const t=this.bookFlightResult.data.find(o=>"OK"==o.status);t&&(this.passengerInfos=t.bookingResult.passengers.map(o=>({name:o.getName(),type:o.getType(),sex:o.getGender(),birthday:o.getBirthday()})),this.passengers=t.bookingResult.passengers.map(o=>({name:o.getName(),type:o.type,typeName:o.getType(),key:o.key})))}initBookingDetail(){this.isLoading=!0,(0,V.D)(this.bookFlightResult.data).pipe((0,$.z)(t=>{if("OK"==t.status){const o=t.bookingResult;return this.listBookingCode.push({bookingCode:o.bookingCode}),this.firstLoad||this.afterIssueBooking?(0,I.of)(this.parseBookingResult(t.bookingResult)):this._bookingDetailService.getBookingDetail(o.bookingCode,o.airline).pipe((0,J.U)(i=>i.success?(t.bookingResult=Object.assign(Object.assign({},t.bookingResult),i.data),this.parseBookingResult(t.bookingResult)):this.parseBookingResult(t.bookingResult)),(0,Q.K)(i=>(0,I.of)(this.parseBookingResult(t.bookingResult))))}{const o=t.bookingResult.journeys.flatMap(a=>a),i=[];let n;return o.forEach(a=>{const s=this.ticketSelected.find(r=>a.key===r.journeyKey);s&&(0===s.leg&&(n=s),i.push(s))}),(0,I.of)({agentId:"",coOwnerId:"",bookingCode:"",holdLimitTime:"",codeAirline:"",provider:"",bookingCodeDisplay:"",airline:n.airline,airlineLogo:this._flightDataService.getAirlineLogoByCode(n.airline),mobileAirlineLogo:["VJ","VN","QH"].includes(n.airline)?"assets/airline-logo/"+n.airline+"_small.png":"assets/airline-logo/"+n.airline+".png",airlineName:this._flightDataService.getAirlineSystemNameByCode(n.airline),airlineSystem:n.airline,startPoint:n.startCode,endPoint:n.endCode,status:t.bookingResult.state,issued:!1,statusText:t.bookingResult.getStatusText(),statusDesc:t.error.errorDescription.vi?t.error.errorDescription.vi:t.error.errorDescription.en,caCode:"N/A",timeHoldBooking:new Date,timeHoldPricing:new Date,tourCode:"N/A",totalFare:0,totalCharge:0,totalServiceFee:0,targetPriceOrder:0,flightNumber:"",journeys:i.map(a=>({airline:a.airline,airlineLogo:this._flightDataService.getAirlineLogoByCode(a.airline),airlineName:this._flightDataService.getAirlineSystemNameByCode(a.airline),operating:a.operating,operatingName:a.operatingName,startPoint:a.startCode,startPointName:this._locationDataService.getCityNameByCode(a.startCode),endPoint:a.endCode,endPointName:this._locationDataService.getCityNameByCode(a.endCode),startTime:_(a.startTime).toDate(),endTime:_(a.endTime).toDate(),flightNumber:a.flight,duration:a.duration,key:a.journeyKey,numOfStops:0,segments:a.segments.map(s=>({airline:s.airline,airlineLogo:s.airlineLogo,airlineName:s.airlineName,startPoint:s.startCode,startPointName:s.startPointName,endPoint:s.endCode,endPointName:s.endPointName,startTime:_(s.departDate).toDate(),endTime:_(s.arrivalDate).toDate(),flightNumber:s.flightNumber,duration:s.duration,key:s.segmentKey,operating:s.operating,operatingName:s.operatingName,checkedBaggage:s.checkedBaggage||"",fareClass:s.fareClass||"",handBaggage:s.handBaggage||"",modelAirplane:s.modelAirplane||"",stopPoint:s.stopPoint}))})),passengers:[],canRetry:t.error.canRetry})}}),function W(){return(0,R.e)((l,u)=>{(function X(l,u){return(0,R.e)((0,G.U)(l,u,arguments.length>=2,!1,!0))})(z,[])(l).subscribe(u)})}()).subscribe(t=>{this.bookingDetails=t,this._getSeatCharge(),this._getBaggageCharge(),this.isSuccess&&this.initPriceDetail(),this.isSuccess&&this.initTotalPrice(),this.mappingJourneyBasic(),this.getBookingContact(),this.getBooingText(),this.isLoading=!1})}parseBookingResult(t){var o,i,n;return{agentId:t.agentId,coOwnerId:t.coOwnerId,bookingCode:t.bookingCode,holdLimitTime:t.bookingTextExplain.holdLimitTime,provider:t.provider,bookingCodeDisplay:t.bookingCode,airline:t.airline,airlineLogo:this._flightDataService.getAirlineLogoByCode(t.airline),mobileAirlineLogo:["VJ","VN","QH"].includes(t.airline)?"assets/airline-logo/"+t.airline+"_small.png":"assets/airline-logo/"+t.airline+".png",airlineName:["VJ","VN","QH"].includes(t.airline)?this._flightDataService.getAirlineSystemNameByCode(t.airline):t.airlineName,airlineSystem:t.airline,startPoint:t.journeys[0].departure.airport.code,endPoint:1===t.journeys.length?t.journeys[0].arrival.airport.code:t.journeys[t.journeys.length-1].departure.airport.code,status:t.state,issued:t.issued,statusText:this.getStatusText(t.state),statusDesc:"N/A",caCode:"N/A",timeHoldBooking:null!==(o=t.bookDetail)&&void 0!==o&&o.timeHoldBooking?_(t.bookDetail.timeHoldBooking).format("HH:mm, DD/MM/YYYY"):"",timeHoldPricing:null!==(i=t.bookDetail)&&void 0!==i&&i.timeKeepPrice?_(t.bookDetail.timeKeepPrice).format("HH:mm, DD/MM/YYYY"):"N/A",tourCode:"N/A",totalFare:t.fareCharges.total?t.fareCharges.total.total:null,totalServiceFee:t.totalCharges.total?t.totalCharges.total.totalServiceFee:null,totalCharge:t.totalCharges.total.total,targetPriceOrder:null===(n=t.fareCharges)||void 0===n?void 0:n.getTotalChargeOrder(),flightNumber:`${t.journeys[0].segments[0].airline}${t.journeys[0].segments[0].flightNumber}`,journeys:t.journeys.map(a=>({airline:a.airline,airlineLogo:this._flightDataService.getAirlineLogoByCode(a.airline),airlineName:this._flightDataService.getAirlineSystemNameByCode(a.airline),operating:a.operating,operatingName:a.operatingName,startPoint:a.departure.airport.code,startPointName:this._locationDataService.getCityNameByCode(a.departure.airport.code),endPoint:a.arrival.airport.code,endPointName:this._locationDataService.getCityNameByCode(a.arrival.airport.code),startTime:_(a.departure.localTime).toDate(),endTime:_(a.arrival.localTime).toDate(),key:a.key,segments:a.segments.map(s=>{var r,c,d,m,v;const T=s.getDelayString();return{airline:s.airline,airlineLogo:this._flightDataService.getAirlineLogoByCode(s.operating||s.airline),airlineName:this._flightDataService.getAirlineSystemNameByCode(s.operatingName),startPoint:s.departure.airport.code,startPointName:this._locationDataService.getCityNameByCode(s.departure.airport.code),endPoint:s.arrival.airport.code,endPointName:this._locationDataService.getCityNameByCode(s.arrival.airport.code),startTime:_(s.departure.localTime).toDate(),endTime:_(s.arrival.localTime).toDate(),flightNumber:s.flightNumber,duration:s.getDurationString(),shortDuration:(0,H.N)(s.duration),key:s.key,operating:s.operating,operatingName:s.operatingName,codeAirline:s.codeAirline,checkedBaggage:(null===(r=s.bookedInfo)||void 0===r?void 0:r.checkedBaggage)||"",fareClass:(null===(c=s.bookedInfo)||void 0===c?void 0:c.fareClass)||"",fareType:(null===(d=s.bookedInfo)||void 0===d?void 0:d.fareType)||s.bookedInfo.fareClass||"",fareBasic:(null===(m=s.bookedInfo)||void 0===m?void 0:m.fareBasic)||"",handBaggage:(null===(v=s.bookedInfo)||void 0===v?void 0:v.handBaggage)||"",modelAirplane:s.modelAirplane,stopPoint:T?`D\u1eebng t\u1ea1i: ${this._locationDataService.getAirportNameByCode(s.departure.airport.code)} (${s.departure.airport.code}). Th\u1eddi gian d\u1eebng: ${T}`:""}})})),passengers:t.passengers.map(a=>({name:a.getName(),firstName:a.firstName,lastName:a.lastName,type:a.getType(),farePrice:t.fareCharges.getBaseCharge(a.type)-t.fareCharges.getDiscount(a.type),tax:t.fareCharges.getTaxCharge(a.type),vat:t.fareCharges.getVATCharge(a.type),total:t.fareCharges.getTotalCharge(a.type),key:a.key,parentKey:a.parentKey,birthday:a.birthday,namePrefix:a.namePrefix,gender:a.gender})),actions:this.getListTicketAction(t.state,t.provider),bookingTextExplain:t.bookingTextExplain}}getStatusText(t){switch(t){case"BOOKED":return"\u0110\xe3 gi\u1eef ch\u1ed7";case"ISSUED":return"\u0110\xe3 xu\u1ea5t v\xe9";case"REFUND":return"\u0110\xe3 ho\xe0n";case"CANCEL":return"\u0110\xe3 h\u1ee7y";case"EXPIRED":return"H\u1ebft h\u1ea1n";case"INVALID":return"Kh\xf4ng c\xf2n gi\xe1 tr\u1ecb";case"VOID":return"\u0110\xe3 void";default:return"\u0110\u1eb7t ch\u1ed7 l\u1ed7i"}}initPriceDetail(){this.priceDetail={provider:this.bookFlightResult.data.filter(t=>"OK"==t.status).map(t=>t.bookingResult.provider),totalBasePrice:this.bookFlightResult.data.filter(t=>"OK"==t.status).flatMap(t=>t.bookingResult.totalCharges?t.bookingResult.totalCharges.total.totalFareCharge:0).reduce((t,o)=>t+o,0),totalServiceFee:this.bookFlightResult.data.filter(t=>"OK"==t.status).flatMap(t=>t.bookingResult.totalCharges?t.bookingResult.totalCharges.total.totalServiceFee:0).reduce((t,o)=>t+o,0),totalAddonService:this.computeTotalChargeAddOn(),passengers:this.passengers.map(t=>({name:t.name,type:t.typeName,base:this.bookFlightResult.data.filter(o=>"OK"==o.status).flatMap(o=>o.bookingResult.fareCharges.getBaseCharge(t.type)-o.bookingResult.fareCharges.getDiscount(t.type)).reduce((o,i)=>o+i,0),tax:this.bookFlightResult.data.filter(o=>"OK"==o.status).flatMap(o=>o.bookingResult.fareCharges.getTaxAndVat(t.type)).reduce((o,i)=>o+i,0),total:this.bookFlightResult.data.filter(o=>"OK"==o.status).flatMap(o=>o.bookingResult.fareCharges.getTotalCharge(t.type)).reduce((o,i)=>o+i,0)}))}}initTotalPrice(){this.totalPrice=this.bookFlightResult.data.filter(t=>"OK"==t.status).flatMap(t=>t.bookingResult.totalCharges.total?t.bookingResult.totalCharges.total.totalFareCharge+t.bookingResult.totalCharges.total.totalServiceFee:-1).reduce((t,o)=>t+o,0)+this.computeTotalChargeAddOn()}onActionChange(t,o){const i={airline:o.airlineSystem,bookingCode:o.bookingCode,payNow:"ISSUED"===o.status};switch(t){case"booking_detail":return this.gotoBookingDetail(i.airline,i.bookingCode);case"addon_baggage":return this.onAddonBaggage(i);case"addon_seat":return this.onAddonSeat(i);case"void":return this.onVoidBooking(i);case"issue":return this.onIssueBooking(i);case"boarding_pass":return this.onShowBoardingPass(o);case"delete_segments":return this.onDeleteSegment(o);case"register_order":return this._eventLogService.captureOpenFormDownFare({hasPNR:1,source:0}),this.onRegisterOrder(o);default:return}}gotoBookingDetail(t,o){this._route.navigate([`admin/booking-detail/${t}/${o}`])}onAddonBaggage(t){if(this.dataBaggageInput=this.mappingDataBaggageInput(t),!this.dataBaggageInput.length||this.dataBaggageInput.every(i=>!i.journeys.length))return void this._toastService.add({severity:"error",summary:"Th\xeam h\xe0nh l\xfd th\u1ea5t b\u1ea1i",detail:"H\xe0nh l\xfd \u0111\xe3 c\xf3",sticky:!1});const o=Object.assign({},t);if(this._detectMobileService.isMobile()){const i=this._bottomSheetService.open(B.AddOnBaggageModalComponent,{headerTitle:"Th\xeam h\xe0nh l\xfd",leftButtonIcon:"arrow_left",leftButtonIconClass:"text-neutral-gray-4",rightButtonIcon:"",containerFullHeigh:!0,data:{dataBaggageInput:this.dataBaggageInput,addonBaggageReq:o,type:"baggage_addon",bookingInfo:t}});i.containerInstance._leftButtonClick.subscribe(n=>i.dismiss()),i.afterDismissed().subscribe(n=>{this.processAddonBaggage({type:"",data:n})})}else this._modal.open(B.AddOnBaggageModalComponent,{dataBaggageInput:this.dataBaggageInput,addonBaggageReq:o,type:"baggage_addon",bookingInfo:t}).afterClosed$.subscribe({next:n=>{this.processAddonBaggage(n)}})}processAddonBaggage(t){if("backdropClick"==t.type)return;const o=t.data;if(o&&o.success){const i=o.data,n=i.bookingCode,a=this.bookFlightResult.data.find(r=>r.bookingResult.bookingCode===n),s=i.addOnCharges.map(r=>({charge:Object.assign({},r.charge.charge),ssrInfo:{category:{name:r.ancillaryItem.category,description:r.ancillaryItem.description},code:"",description:r.ancillaryItem.description,journeyKey:r.ancillaryItem.journeyKey,name:r.ancillaryItem.name,passengerKey:r.ancillaryItem.passengerKey,segmentKey:"",unit:"",weight:""}}));if(a&&(a.bookingResult.ssrCharges.push(...s),this._bookingResultDataProvider.bookingResultData=this.bookFlightResult,this.priceDetail.totalServiceFee+=i.derivativeFee,this._getBaggageCharge(),this.initPriceDetail(),this.initTotalPrice(),this.getShortRetrieve(a.bookingResult.airline,i.bookingCode)),this._detectMobileService.isMobile()){const r=this._bottomSheetService.open(k.z5,{headerTitle:"",rightButtonIcon:"close",rightButtonIconClass:"text-neutral-gray-4",leftButtonIcon:"",data:{title:"Th\xeam h\xe0nh l\xfd th\xe0nh c\xf4ng!",content:"<div>\u0110\xe3 th\xeam h\xe0nh l\xfd cho booking code:</div>",status:"success",okText:"OK",extraText:`${n}`}});r.containerInstance._rightButtonClick.subscribe(c=>r.dismiss())}else this._modal.open(k.z5,{title:"Th\xeam h\xe0nh l\xfd th\xe0nh c\xf4ng!",content:"<div>\u0110\xe3 th\xeam h\xe0nh l\xfd cho booking code:</div>",status:"success",okText:"OK",extraText:`${n}`})}else if(o&&!o.success){const i=o.objectError.errorDescription.vi?o.objectError.errorDescription.vi:o.objectError.errorDescription.en;if(this._detectMobileService.isMobile()){const n=this._bottomSheetService.open(k.z5,{headerTitle:"",rightButtonIcon:"close",rightButtonIconClass:"text-neutral-gray-4",leftButtonIcon:"",data:{title:"Th\xeam h\xe0nh l\xfd th\u1ea5t b\u1ea1i",content:`<div>\n                        <div>${i}</div>\n                        <div>Vui l\xf2ng th\u1eed l\u1ea1i sau!</div>\n                    </div>`,status:"error",okText:"Th\u1eed l\u1ea1i",cancelText:"\u0110\xf3ng"}});n.containerInstance._rightButtonClick.subscribe(a=>n.dismiss())}else this._modal.open(k.z5,{title:"Th\xeam h\xe0nh l\xfd th\u1ea5t b\u1ea1i",content:`<div>\n                      <div>${i}</div>\n                      <div>Vui l\xf2ng th\u1eed l\u1ea1i sau!</div>\n                  </div>`,status:"error",okText:"Th\u1eed l\u1ea1i",cancelText:"\u0110\xf3ng"})}}onAddonSeat(t){this.dataSeatInput=this.mappingDataSeatInput(t);const o=Object.assign({},t);if(this._detectMobileService.isMobile()){const i=this._bottomSheetService.open(B.AddOnSeatModalComponent,{headerTitle:"Th\xeam ch\u1ed7 ng\u1ed3i",leftButtonIcon:"arrow_left",leftButtonIconClass:"text-neutral-gray-4",rightButtonIcon:"",containerFullHeigh:!0,data:{dataSeatInput:this.dataSeatInput,addonSeatReq:o,type:"seat_addon",bookingInfo:t}});i.containerInstance._leftButtonClick.subscribe(n=>i.dismiss()),i.afterDismissed().subscribe(n=>{this.processAddonSeat(n)})}else this._modal.open(B.AddOnSeatModalComponent,{dataSeatInput:this.dataSeatInput,addonSeatReq:o,type:"seat_addon",bookingInfo:t}).afterClosed$.subscribe({next:n=>{this.processAddonSeat(n.data)}})}processAddonSeat(t){let o=t;if(!t.data.addOnCharges&&t.data.data&&(o=t.data),o&&o.success){const i=o.data,n=i.bookingCode,a=this.bookFlightResult.data.find(r=>r.bookingResult.bookingCode===n),s=i.addOnCharges.map(r=>({charge:Object.assign({},r.charge.charge),seatInfos:{journeyKey:r.seatItem.journeyKey,mapCell:Object.assign({},r.seatItem.mapCell),passengerKey:r.seatItem.passengerKey,segmentKey:r.seatItem.segmentKey}}));if(a&&(a.bookingResult.seatCharges.push(...s),this._bookingResultDataProvider.bookingResultData=this.bookFlightResult,this.priceDetail.totalServiceFee+=i.derivativeFee,this._getSeatCharge(),this.initPriceDetail(),this.initTotalPrice(),this.getShortRetrieve(a.bookingResult.airline,i.bookingCode)),this._detectMobileService.isMobile()){const r=this._bottomSheetService.open(k.z5,{headerTitle:"",rightButtonIcon:"close",rightButtonIconClass:"text-neutral-gray-4",leftButtonIcon:"",data:{title:"Th\xeam ch\u1ed7 ng\u1ed3i th\xe0nh c\xf4ng!",content:"<div>\u0110\xe3 th\xeam ch\u1ed7 ng\u1ed3i cho booking code:</div>",status:"success",okText:"OK",extraText:`${n}`}});r.containerInstance._rightButtonClick.subscribe(c=>r.dismiss())}else this._modal.open(k.z5,{title:"Th\xeam ch\u1ed7 ng\u1ed3i th\xe0nh c\xf4ng!",content:"<div>\u0110\xe3 th\xeam ch\u1ed7 ng\u1ed3i cho booking code:</div>",status:"success",okText:"OK",extraText:`${n}`})}if(o&&!o.success){const i=o.objectError.errorDescription.vi?o.objectError.errorDescription.vi:o.objectError.errorDescription.en;if(this._detectMobileService.isMobile()){const n=this._bottomSheetService.open(k.z5,{headerTitle:"",rightButtonIcon:"close",rightButtonIconClass:"text-neutral-gray-4",leftButtonIcon:"",data:{title:"Th\xeam ch\u1ed7 ng\u1ed3i th\u1ea5t b\u1ea1i",content:`<div>\n                      <div>${i}</div>\n                      <div>Vui l\xf2ng th\u1eed l\u1ea1i sau!</div>\n                  </div>`,status:"error",okText:"Th\u1eed l\u1ea1i",cancelText:"\u0110\xf3ng"}});n.containerInstance._rightButtonClick.subscribe(a=>n.dismiss())}else this._modal.open(k.z5,{title:"Th\xeam ch\u1ed7 ng\u1ed3i th\u1ea5t b\u1ea1i",content:`<div>\n                      <div>${i}</div>\n                      <div>Vui l\xf2ng th\u1eed l\u1ea1i sau!</div>\n                  </div>`,status:"error",okText:"Th\u1eed l\u1ea1i",cancelText:"\u0110\xf3ng"})}}mappingDataBaggageInput(t){var o,i;let n=[];const a=null===(i=null===(o=this.bookFlightResult.data)||void 0===o?void 0:o.find(s=>s.bookingResult.bookingCode===t.bookingCode))||void 0===i?void 0:i.bookingResult;return a&&(n=a.passengers.filter(s=>"INFANT"!==s.type).map(s=>{var r;return{passengerKey:s.key,passengerType:s.type,passengerName:s.lastName+" "+s.firstName,addBaggageFee:(null===(r=s.passengerDerivativeFee)||void 0===r?void 0:r.addBaggageFee)||0,journeys:a.journeys.filter(c=>{const d=a.ssrCharges?a.ssrCharges.filter(m=>m.ssrInfo.journeyKey===c.key&&m.ssrInfo.passengerKey===s.key):[];return!("VN"===c.airline&&d.length>=this.maxBag||"VN"!==c.airline&&d.length)&&c}).map(c=>{const d=_(c.departure.localTime).toDate();return{flight:c.segments[0].airline.concat(" ",c.segments[0].flightNumber),flightNumber:c.segments[0].flightNumber,airlineName:this._flightDataService.getAirlineSystemNameByCode(c.airline),airlineLogo:this.getAirlineLogo(c.airline),journeyKey:c.key,journeyName:`D\u1ecbch v\u1ee5 b\u1ed5 sung ${c.departure.airport.code}-${c.arrival.airport.code}, ${(0,C.p6)(d,"EEEE, ","vi-VN")} ${d.getDate()} th\xe1ng ${d.getMonth()+1}, ${d.getFullYear()}`,leg:c.leg,fareOptionKey:"",startCode:c.departure.airport.code,endCode:c.arrival.airport.code,startTime:(0,C.p6)(new Date(c.departure.localTime),"EEEE, dd/MM/yyyy","vi-VN"),baggageOptions:[],baggageSelected:{baggageName:"",baggageKey:"",containerKey:"",totalCharge:0}}})}})),n=n.filter(s=>s.journeys.length),n}mappingDataSeatInput(t){var o,i;const n=null===(i=null===(o=this.bookFlightResult.data)||void 0===o?void 0:o.find(s=>s.bookingResult.bookingCode===t.bookingCode))||void 0===i?void 0:i.bookingResult;let a=[];return n&&(a=n.journeys.map(s=>({segments:s.segments.map(r=>{var c;const d=_(r.departure.localTime).toDate(),m=`${(0,C.p6)(d,"EEEE, ","vi-VN")} ${d.getDate()} th\xe1ng ${d.getMonth()+1}, ${d.getFullYear()}`;return{airline:r.airline,flightNumber:r.flightNumber,modelAirplaneName:"",bookingCode:null!==(c=n.bookingCode)&&void 0!==c?c:"",serviceName:`Th\xeam ch\u1ed7 ng\u1ed3i tr\xean chuy\u1ebfn bay ${r.departure.airport.code}-${r.arrival.airport.code}, ${m}`,mobileServiceName:`${r.departure.airport.code}-${r.arrival.airport.code}, ${m}`,airlineLogo:this._flightDataService.getAirlineLogoByCode(r.airline),jetCode:"N/A",startCode:r.departure.airport.code,endCode:r.arrival.airport.code,departDate:m,passengers:n.passengers.filter(v=>"INFANT"!==v.type).map(v=>{var T;const p=n.seatCharges.find(b=>b.seatInfos.passengerKey===v.key&&b.seatInfos.journeyKey===s.key&&b.seatInfos.segmentKey===r.key);return{passengerName:`${v.lastName} ${v.firstName}`,passengerType:v.type.toLowerCase(),passengerKey:v.key,addSeatFee:(null===(T=v.passengerDerivativeFee)||void 0===T?void 0:T.addSeatFee)||0,seatSelected:{containerKey:"",seat:p?p.seatInfos.mapCell.row+p.seatInfos.mapCell.identifier:"",seatKey:"",totalPrice:p?p.charge.total:0}}}),segmentKey:r.key,segmentIndex:r.index,journeyKey:s.key,leg:s.leg,active:!1,seatSegment:{rows:[],cols:[],containerKey:"",seatMaps:[]},available:!(n.seatCharges&&n.seatCharges.some(v=>v.seatInfos.journeyKey===s.key&&v.seatInfos.segmentKey===r.key))}})})).flatMap(s=>s.segments)),a.map((s,r)=>Object.assign(Object.assign({},s),{active:0===r}))}mappingJourneyBasic(){this.listJourneyBasic=this.bookingDetails.filter(t=>"INVALID"!==t.status).map(t=>({journeyInfo:t.journeys.map(o=>({airlineLogo:o.airlineLogo,flight:`${o.startPoint} - ${o.endPoint}`,startTime:(0,C.p6)(new Date(o.startTime),"dd/MM/yyyy","vi-VN"),journeyKey:o.key}))})).flatMap(t=>t.journeyInfo)}computeTotalChargeAddOn(){return this.listBaggage.reduce((i,n)=>i+n.totalCharge,0)+this.listService.reduce((i,n)=>i+n.totalCharge,0)}_getSeatCharge(){this.listService.length=0,this.bookFlightResult.data.filter(o=>"ERROR"!==o.bookingResult.state&&o.bookingResult.seatCharges&&o.bookingResult.seatCharges.length).forEach(o=>{const i=o.bookingResult,n=i.journeys.flatMap(r=>r.segments),a=i.passengers,s=o.bookingResult.seatCharges.map(r=>{const c=a.find(m=>m.key===r.seatInfos.passengerKey),d=n.find(m=>m.key===r.seatInfos.segmentKey);return{airline:(null==d?void 0:d.airline)||"",airlineName:d?this._flightDataService.getAirlineNameByCode(d.airline):"",airlineLogo:d?this.getAirlineLogo(d.airline):"",journeyKey:"",flight:d?d.departure.airport.code+" - "+d.arrival.airport.code:"",flightName:d?this._locationDataService.getCityNameByCode(d.departure.airport.code)+" - "+this._locationDataService.getCityNameByCode(d.arrival.airport.code):"",flightNumber:d?`${d.airline}${d.flightNumber}`:"",departDate:d?(0,C.p6)(new Date(d.departure.localTime),"dd/MM/yyyy","vi-VN"):"",passengerKey:c?c.key:"",passengerName:c?c.lastName+" "+c.firstName:"",serviceKey:"",totalCharge:r.charge.total,serviceName:r.seatInfos.mapCell.seatNumber?r.seatInfos.mapCell.seatNumber:r.seatInfos.mapCell.row+r.seatInfos.mapCell.identifier,categoryName:"seat"}});this.listService.push(...s)}),this.hasSeatSelected=this.listService.some(o=>o)}_getBaggageCharge(){const t=this.bookFlightResult.data.filter(i=>"ERROR"!==i.bookingResult.state&&i.bookingResult.ssrCharges&&i.bookingResult.ssrCharges.length),o=[];t.forEach(i=>{const n=i.bookingResult,a=n.journeys,s=n.passengers,r=i.bookingResult.ssrCharges.map(c=>{const d=s.find(v=>v.key===c.ssrInfo.passengerKey),m=a.find(v=>v.key===c.ssrInfo.journeyKey);return{airline:(null==m?void 0:m.airline)||"",airlineName:m?this._flightDataService.getAirlineNameByCode(m.airline):"",airlineLogo:m?this.getAirlineLogo(m.airline):"",journeyKey:m?m.key:"",flight:m?m.departure.airport.code+" - "+m.arrival.airport.code:"",flightName:m?this._locationDataService.getCityNameByCode(m.departure.airport.code)+" - "+this._locationDataService.getCityNameByCode(m.arrival.airport.code):"",flightNumber:"",departDate:m?(0,C.p6)(new Date(m.departure.localTime),"dd/MM/yyyy","vi-VN"):"",passengerKey:d?d.key:"",passengerName:d?d.lastName+" "+d.firstName:"",serviceKey:"",totalCharge:c.charge.total,serviceName:c.ssrInfo.name,categoryName:c.ssrInfo.category.name.toLowerCase()}});o.push(...r)}),this.listBaggage=o,this.hasBaggageSelected=this.listBaggage.some(i=>i)}onVoidBooking(t){this._modal.open(x.hF,{bookingCode:t.bookingCode,airline:t.airline})}onIssueBooking(t){const o={title:"Xu\u1ea5t v\xe9 th\xe0nh c\xf4ng",content:"<div>V\xe9 \u0111\xe3 \u0111\u01b0\u1ee3c xu\u1ea5t th\xe0nh c\xf4ng!</div>",status:"success",okText:"X\xe1c nh\u1eadn"},i={title:"Xu\u1ea5t v\xe9 th\u1ea5t b\u1ea1i",content:"<div>Xu\u1ea5t s\u1ed1 v\xe9 kh\xf4ng th\xe0nh c\xf4ng. Vui l\xf2ng th\u1eed l\u1ea1i ho\u1eb7c li\xean h\u1ec7 booker \u0111\u1ec3 \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3!</div>",status:"error"},n={agentId:"",airline:t.airline,bookingCode:t.bookingCode,bookingPrice:0,internal:!0};this._modal.open(k.V0,{title:"X\xe1c nh\u1eadn xu\u1ea5t v\xe9",body:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n xu\u1ea5t v\xe9 n\xe0y kh\xf4ng."}).afterClosed$.subscribe({next:s=>{s.data&&(this.isLoading=!0,this._manageBookingService.issueTicket(n).pipe((0,E.x)(()=>this.isLoading=!1)).subscribe({next:r=>{if(r.success&&r.data){this.afterIssueBooking=!0,this._modal.open(k.z5,o);const c=this.bookFlightResult.data.find(d=>d.bookingResult.bookingCode===t.bookingCode);c&&(c.bookingResult=Object.assign(Object.assign({},r.data),{passengers:c.bookingResult.passengers}),this._bookingResultDataProvider.bookingResultData=this.bookFlightResult,this.bookFlightResult=(0,Z.yE)(y.aM,this._bookingResultDataProvider.bookingResultData,{excludeExtraneousValues:!0}),this.initBookingDetail(),this.initPriceDetail(),this.getShortRetrieve(n.airline,n.bookingCode))}else if("DS-EL002"===r.objectError.errorCode){const c=r.objectError.errorData.newPrice-r.objectError.errorData.oldPrice,d={newPrice:r.objectError.errorData.newPrice,oldPrice:r.objectError.errorData.oldPrice,priceGap:Math.abs(c),type:c>0?"+":"-"};this._modal.open(q.EH,{priceChangeData:d}).afterClosed$.subscribe({next:v=>{v.data&&(this.isLoading=!0,this._manageBookingService.issueTicket(n).pipe((0,E.x)(()=>this.isLoading=!1)).subscribe({next:T=>{T.success?this._modal.open(k.z5,o).afterClosed$.subscribe({next:b=>{if(b.data){const S=this.bookFlightResult.data.find(N=>N.bookingResult.bookingCode===t.bookingCode);S&&(S.bookingResult.state=T.data.state,S.bookingResult.issued=T.data.issued,this._bookingResultDataProvider.bookingResultData=this.bookFlightResult,this.initBookingDetail())}}}):(i.content=T.objectError.errorDescription.vi?T.objectError.errorDescription.vi:T.objectError.errorDescription.en,this._modal.open(k.z5,i))}}))}})}else i.content=r.objectError.errorDescription.vi?r.objectError.errorDescription.vi:r.objectError.errorDescription.en,this._modal.open(k.z5,i)}}))}})}onShare(t){const o="origin"===this.modeBookingText?this.getOriginText(t):this.getExplaneText(t);this.clipboard.copy(o)}getOriginText(t){var o,i,n,a,s,r,c,d,m,v,T;if(this.listBookingText){let p="";const b=this.listBookingText.find(S=>S.airline===t);return b&&("VN"===b.airline?(p+=`${b.bookingCodeText}\r\n`,p+=(null===(o=b.passengerTexts)||void 0===o?void 0:o.join("\r\n"))+"\r\n",p+=(null===(i=b.segmentTexts)||void 0===i?void 0:i.join("\r\n "))+"\r\n",p+="TKT/TIME LIMIT\r\n ",p+=(null===(n=b.ticketTexts)||void 0===n?void 0:n.join("\r\n "))+"\r\n",p+="VCR COUPON DATA EXISTS *VI TO DISPLAY\r\n",p+="PHONES\r\n ",p+=(null===(a=b.contactTexts)||void 0===a?void 0:a.join("\r\n "))+"\r\n",p+="PASSENGER EMAIL DATA EXISTS *PE TO DISPLAY ALL\r\n",p+="PRICE QUOTE RECORD EXISTS - *PQS\r\n",p+="FREQUENT TRAVELER\r\n",p+=(null===(s=b.frequentTexts)||void 0===s?void 0:s.join("\r\n "))+"\r\n",p+="TICKETED RETAINED REISSUE EXISTS - *PQS\r\n",p+="VN FACTS\r\n ",p+=(null===(r=b.ssrTexts)||void 0===r?void 0:r.join("\r\n "))+"\r\n",b.remarkTexts&&(p+="REMARKS\r\n ",p+=null===(c=b.remarkTexts)||void 0===c?void 0:c.join("\r\n ")),p+=null===(d=b.agentTexts)||void 0===d?void 0:d.join("\r\n")):(p+=`${b.bookingCodeText}\r\n`,p+=(null===(m=b.passengerTexts)||void 0===m?void 0:m.join(" "))+"\r\n",p+=(null===(v=b.segmentTexts)||void 0===v?void 0:v.join("\r\n"))+"\r\n",p+=`TOTAL PRICE: ${b.totalPrice} VND\r\n`,p+=`TIME LIMIT: ${b.timeLimit}\r\n`,p+=b.contactTexts?null===(T=b.contactTexts)||void 0===T?void 0:T.join("\r\n"):"")),p||""}return""}getExplaneText(t){var o;if(this.listBookingTextExplain){let i="";const n=this.listBookingTextExplain.find(a=>a.airline===t);return n&&(i+=(0,Y.K)(n),i+="NOTE:\r\n",i+=null===(o=n.warning)||void 0===o?void 0:o.join("\r\n")),i||""}return""}changeModeBookingText(t){this.modeBookingText=t}onShowBoardingPass(t){if(this._detectMobileService.isMobile()){const o=this._bottomSheetService.open(M.G,{headerTitle:"M\u1eb7t v\xe9",rightButtonIcon:"",leftButtonIcon:"close",leftButtonIconClass:"text-neutral-gray-4",containerFullHeigh:!0,data:{bookingDetail:t,listBaggage:this.listBaggage.filter(i=>i.airline===t.airline),listService:this.listService.filter(i=>i.airline===t.airline),totalPrice:this.totalPrice}});o.containerInstance._leftButtonClick.subscribe(i=>o.dismiss())}else this._modal.open(M.G,{bookingDetail:t,listBaggage:this.listBaggage.filter(o=>o.airline===t.airline),listService:this.listService.filter(o=>o.airline===t.airline),totalPrice:this.totalPrice})}getListTicketAction(t,o){switch(t){case"BOOKED":return"VJ"===o?[{value:"booking_detail",name:"M\u1edf booking",icon:"external_link",enabled:[g.or.ViewAllFlightBookingDetail,g.or.ViewOwnFlightBookingDetail].some(i=>this._permissionService.hasPermission(i))},{value:"issue",name:"Xu\u1ea5t v\xe9",icon:"grouping",enabled:[g.or.CanIssuedFlightTicket].some(i=>this._permissionService.hasPermission(i))},{value:"boarding_pass",name:"M\u1eb7t v\xe9",icon:"coupon",enabled:[g.or.CreateFlightTicketFace].some(i=>this._permissionService.hasPermission(i))},{value:"register_order",name:"Canh v\xe9 r\u1ebb",icon:"price_down",enabled:[g.or.CanMonitorLowFareTicket].some(i=>this._permissionService.hasPermission(i))},{value:"other",name:"Kh\xe1c",icon:"options_vertical",enabled:[g.or.CanAddonFlightBaggage,g.or.CanAddonFlightSeat].some(i=>this._permissionService.hasPermission(i)),items:[{value:"addon_baggage",name:"Th\xeam h\xe0nh l\xfd",icon:"",enabled:[g.or.CanAddonFlightBaggage].some(i=>this._permissionService.hasPermission(i))},{value:"addon_seat",name:"Th\xeam ch\u1ed7 ng\u1ed3i",icon:"",enabled:[g.or.CanAddonFlightSeat].some(i=>this._permissionService.hasPermission(i))}]}]:"VN"===o?[{value:"booking_detail",name:"M\u1edf booking",icon:"external_link",enabled:[g.or.ViewAllFlightBookingDetail,g.or.ViewOwnFlightBookingDetail].some(i=>this._permissionService.hasPermission(i))},{value:"issue",name:"Xu\u1ea5t v\xe9",icon:"grouping",enabled:[g.or.CanIssuedFlightTicket].some(i=>this._permissionService.hasPermission(i))},{value:"boarding_pass",name:"M\u1eb7t v\xe9",icon:"coupon",enabled:[g.or.CreateFlightTicketFace].some(i=>this._permissionService.hasPermission(i))},{value:"delete_segments",name:"H\u1ee7y h\xe0nh tr\xecnh",icon:"delete",enabled:[g.or.CanAddonFlightSeat].some(i=>this._permissionService.hasPermission(i))},{value:"register_order",name:"Canh v\xe9 r\u1ebb",icon:"price_down",enabled:[g.or.CanMonitorLowFareTicket].some(i=>this._permissionService.hasPermission(i))}]:"GDS"===o?[{value:"booking_detail",name:"M\u1edf booking",icon:"external_link",enabled:[g.or.ViewAllFlightBookingDetail,g.or.ViewOwnFlightBookingDetail].some(i=>this._permissionService.hasPermission(i))},{value:"boarding_pass",name:"M\u1eb7t v\xe9",icon:"coupon",enabled:[g.or.CreateFlightTicketFace].some(i=>this._permissionService.hasPermission(i))}]:[{value:"booking_detail",name:"M\u1edf booking",icon:"external_link",enabled:[g.or.ViewAllFlightBookingDetail,g.or.ViewOwnFlightBookingDetail].some(i=>this._permissionService.hasPermission(i))},{value:"issue",name:"Xu\u1ea5t v\xe9",icon:"grouping",enabled:[g.or.CanIssuedFlightTicket].some(i=>this._permissionService.hasPermission(i))},{value:"boarding_pass",name:"M\u1eb7t v\xe9",icon:"coupon",enabled:[g.or.CreateFlightTicketFace].some(i=>this._permissionService.hasPermission(i))},{value:"register_order",name:"Canh v\xe9 r\u1ebb",icon:"price_down",enabled:[g.or.CanMonitorLowFareTicket].some(i=>this._permissionService.hasPermission(i))}];case"ISSUED":if("VN"===o)return[{value:"booking_detail",name:"M\u1edf booking",icon:"external_link",enabled:[g.or.ViewAllFlightBookingDetail,g.or.ViewOwnFlightBookingDetail].some(i=>this._permissionService.hasPermission(i))},{value:"boarding_pass",name:"M\u1eb7t v\xe9",icon:"coupon",enabled:[g.or.CreateFlightTicketFace].some(i=>this._permissionService.hasPermission(i))},{value:"addon_baggage",name:"Th\xeam h\xe0nh l\xfd",icon:"",enabled:[g.or.CanAddonFlightBaggage].some(i=>this._permissionService.hasPermission(i))},{value:"other",name:"Kh\xe1c",icon:"options_vertical",enabled:[g.or.CanAddonFlightSeat].some(i=>this._permissionService.hasPermission(i)),items:[{value:"delete_segments",name:"H\u1ee7y h\xe0nh tr\xecnh",icon:"delete",enabled:[g.or.CanAddonFlightSeat].some(i=>this._permissionService.hasPermission(i))},{value:"void",name:"Void v\xe9",icon:"coupon_slash",enabled:[g.or.CanVoidFlightTicket].some(i=>this._permissionService.hasPermission(i))},{value:"register_order",name:"Canh v\xe9 r\u1ebb",icon:"price_down",enabled:[g.or.CanMonitorLowFareTicket].some(i=>this._permissionService.hasPermission(i))}]}];if("GDS"===o)return[{value:"booking_detail",name:"M\u1edf booking",icon:"external_link",enabled:[g.or.ViewAllFlightBookingDetail,g.or.ViewOwnFlightBookingDetail].some(i=>this._permissionService.hasPermission(i))},{value:"boarding_pass",name:"M\u1eb7t v\xe9",icon:"coupon",enabled:[g.or.CreateFlightTicketFace].some(i=>this._permissionService.hasPermission(i))}];if("QH"===o){const i=[{value:"booking_detail",name:"M\u1edf booking",icon:"external_link",enabled:[g.or.ViewAllFlightBookingDetail,g.or.ViewOwnFlightBookingDetail].some(n=>this._permissionService.hasPermission(n))},{value:"boarding_pass",name:"M\u1eb7t v\xe9",icon:"coupon",enabled:[g.or.CreateFlightTicketFace].some(n=>this._permissionService.hasPermission(n))},{value:"addon_baggage",name:"Th\xeam h\xe0nh l\xfd",icon:"",enabled:[g.or.CanAddonFlightBaggage].some(n=>this._permissionService.hasPermission(n))}];return j.kp.qh&&i.push({value:"addon_seat",name:"Th\xeam ch\u1ed7 ng\u1ed3i",icon:"",enabled:[g.or.CanAddonFlightSeat].some(n=>this._permissionService.hasPermission(n))}),i}return[{value:"booking_detail",name:"M\u1edf booking",icon:"external_link",enabled:[g.or.ViewAllFlightBookingDetail,g.or.ViewOwnFlightBookingDetail].some(i=>this._permissionService.hasPermission(i))},{value:"boarding_pass",name:"M\u1eb7t v\xe9",icon:"coupon",enabled:[g.or.CreateFlightTicketFace].some(i=>this._permissionService.hasPermission(i))},{value:"addon_baggage",name:"Th\xeam h\xe0nh l\xfd",icon:"",enabled:[g.or.CanAddonFlightBaggage].some(i=>this._permissionService.hasPermission(i))},{value:"addon_seat",name:"Th\xeam ch\u1ed7 ng\u1ed3i",icon:"",enabled:[g.or.CanAddonFlightSeat].some(i=>this._permissionService.hasPermission(i))}];case"VOID":return"VJ"===o?[{value:"booking_detail",name:"M\u1edf booking",icon:"external_link",enabled:[g.or.ViewAllFlightBookingDetail,g.or.ViewOwnFlightBookingDetail].some(i=>this._permissionService.hasPermission(i))},{value:"issue",name:"Xu\u1ea5t v\xe9",icon:"grouping",enabled:[g.or.CanIssuedFlightTicket].some(i=>this._permissionService.hasPermission(i))},{value:"boarding_pass",name:"M\u1eb7t v\xe9",icon:"coupon",enabled:[g.or.CreateFlightTicketFace].some(i=>this._permissionService.hasPermission(i))},{value:"other",name:"Kh\xe1c",icon:"options_vertical",enabled:[g.or.CanAddonFlightBaggage,g.or.CanAddonFlightSeat].some(i=>this._permissionService.hasPermission(i)),items:[{value:"addon_baggage",name:"Th\xeam h\xe0nh l\xfd",icon:"",enabled:[g.or.CanAddonFlightBaggage].some(i=>this._permissionService.hasPermission(i))},{value:"addon_seat",name:"Th\xeam ch\u1ed7 ng\u1ed3i",icon:"",enabled:[g.or.CanAddonFlightSeat].some(i=>this._permissionService.hasPermission(i))}]}]:"GDS"===o?[{value:"booking_detail",name:"M\u1edf booking",icon:"external_link",enabled:[g.or.ViewAllFlightBookingDetail,g.or.ViewOwnFlightBookingDetail].some(i=>this._permissionService.hasPermission(i))},{value:"boarding_pass",name:"M\u1eb7t v\xe9",icon:"coupon",enabled:[g.or.CreateFlightTicketFace].some(i=>this._permissionService.hasPermission(i))}]:[{value:"booking_detail",name:"M\u1edf booking",icon:"external_link",enabled:[g.or.ViewAllFlightBookingDetail,g.or.ViewOwnFlightBookingDetail].some(i=>this._permissionService.hasPermission(i))},{value:"issue",name:"Xu\u1ea5t v\xe9",icon:"grouping",enabled:[g.or.CanIssuedFlightTicket].some(i=>this._permissionService.hasPermission(i))},{value:"boarding_pass",name:"M\u1eb7t v\xe9",icon:"coupon",enabled:[g.or.CreateFlightTicketFace].some(i=>this._permissionService.hasPermission(i))}];default:return[]}}onRetryBooking(t){const o=this.bookingRequest.data.bookingFlights.bookingOptions.filter(n=>t.includes(n.journeyKey)),i=Object.assign(Object.assign({},this.bookingRequest),{data:Object.assign(Object.assign({},this.bookingRequest.data),{bookingFlights:{mode:this.bookingRequest.data.bookingFlights.mode,bookingOptions:o.map((n,a)=>Object.assign(Object.assign({},n),{leg:a}))},bookingPassengers:this.bookingRequest.data.bookingPassengers.map(n=>Object.assign(Object.assign({},n),{bookingBaggages:n.bookingBaggages.filter(a=>t.includes(a.journeyKey)),bookingSeats:n.bookingSeats.filter(a=>t.includes(a.journeyKey))}))})});this.isLoading=!0,this._bookFlightService.bookFlight(i).pipe((0,E.x)(()=>this.isLoading=!1)).subscribe({next:n=>{}})}getShortRetrieve(t,o){this._searchFlightService.getShortRetrieve({airline:t,bookingCode:o}).subscribe({next:n=>{if(n.success){const a=this.bookFlightResult.data.find(r=>r.bookingResult.bookingCode===o),s=this.bookingDetails.find(r=>r.bookingCode===o);s&&(s.bookingTextExplain=n.data.bookingTextExplain),a&&(a.bookingResult.bookingText=n.data.bookingText,a.bookingResult.bookingTextExplain=n.data.bookingTextExplain,this._bookingResultDataProvider.bookingResultData=this.bookFlightResult,this.bookFlightResult=(0,Z.yE)(y.aM,this._bookingResultDataProvider.bookingResultData,{excludeExtraneousValues:!0}),this.getBooingText())}}})}togglePriceBottomSheet(t){const o=this._bottomSheetService.open(t,{headerTitle:"Gi\xe1 v\xe9",rightButtonIcon:"close",rightButtonIconClass:"text-neutral-gray-4"});this.zIndexPriceIncrease=!0,o.afterDismissed().subscribe(i=>{this.zIndexPriceIncrease=!1}),o.containerInstance._rightButtonClick.subscribe(i=>{o.dismiss()})}mobileDetailClick(t){const o=this._bottomSheetService.open(x.iU,{headerTitle:"Chi ti\u1ebft \u0111\u1eb7t ch\u1ed7",rightButtonIcon:"",leftButtonIcon:"close",leftButtonIconClass:"text-neutral-gray-4",containerFullHeigh:!0,data:{flightInfos:[this.getFlightInfoDetail(t)]}});o.containerInstance._leftButtonClick.subscribe(i=>{o.dismiss()})}mobileTabChange(t,o){this.mobileTabMode=t,o.scrollIntoView({behavior:"smooth",inline:"center"})}getFlightInfoDetail(t){return{segments:t.journeys.flatMap((i,n)=>i.segments.map((a,s)=>({airline:a.airline,airlineSystem:a.airline,airlineName:a.airlineName,airlineLogo:a.airlineLogo,mobileAirlineLogo:["VJ","VN","QH"].includes(a.airline)?"assets/airline-logo/"+a.airline+"_small.png":"assets/airline-logo/"+a.airline+".png",flightNumber:a.airline+a.flightNumber,startTime:_(a.startTime).format("HH:mm"),startDate:_(a.startTime).format("DD/MM/YYYY"),startPoint:a.startPoint,startPointName:a.startPointName,startAirport:this._locationDataService.getAirportNameByCode(a.startPoint),endTime:_(a.endTime).format("HH:mm"),endDate:_(a.endTime).format("DD/MM/YYYY"),endPoint:a.endPoint,endPointName:a.endPointName,endAirport:this._locationDataService.getAirportNameByCode(a.endPoint),stopPoint:a.stopPoint,modelAirplane:a.modelAirplane,badge:0===n?"Chi\u1ec1u \u0111i":"Chi\u1ec1u v\u1ec1",rules:[{name:"Th\u1eddi gian bay",value:a.duration},{name:"Lo\u1ea1i m\xe1y bay",value:a.modelAirplane},{name:"H\u1ea1ng ch\u1ed7",value:a.fareClass},{name:"H\xe0nh l\xfd k\xfd g\u1eedi",value:a.checkedBaggage||"N/A"},{name:"H\xe0nh l\xfd x\xe1ch tay",value:a.handBaggage||"N/A"}]}))),statusDesc:t.statusDesc,timeHoldBooking:t.timeHoldBooking,timeHoldPricing:t.timeHoldPricing,airlineSystem:t.airlineSystem,airlineName:t.airlineName,totalFare:t.totalFare,passengers:t.passengers.map(i=>({name:i.name,type:i.type,farePrice:i.farePrice,tax:i.tax,vat:i.vat,total:i.total})),status:t.status}}onDeleteSegment(t){const o=t.journeys.flatMap(n=>n.segments).map((n,a)=>({order:a+1,segmentKey:n.key,journey:`${n.startPointName} (${n.startPoint}) - ${n.endPointName} (${n.endPoint})`,startTime:_(n.startTime).format("HH:mm DD/MM/YYYY"),flightNumber:`${n.airline}${n.flightNumber}`,status:""})),i={airline:t.airline,bookingCode:t.bookingCode};if(this._detectMobileService.isMobile()){const n=this._bottomSheetService.open(x.df,{headerTitle:"H\u1ee7y h\xe0nh tr\xecnh",rightButtonIcon:"",leftButtonIcon:"close",leftButtonIconClass:"text-neutral-gray-4",containerFullHeigh:!0,data:{listSegmentData:o,bookingInfo:i}});n.containerInstance._leftButtonClick.subscribe(a=>n.dismiss()),n.afterDismissed().subscribe(a=>{a&&(t.status="CANCEL",t.statusText="\u0110\xe3 h\u1ee7y",t.actions=this.getListTicketAction("CANCEL",i.airline))})}else this._modal.open(x.df,{listSegmentData:o,bookingInfo:i}).afterClosed$.subscribe({next:a=>{a.data&&(t.status="CANCEL",t.statusText="\u0110\xe3 h\u1ee7y",t.actions=this.getListTicketAction("CANCEL",i.airline))}})}onRegisterOrder(t){const o={airline:t.airline,pnr:t.bookingCode};this.isLoading=!0,this._ticketLowFareService.canMonitorLowFare(o).pipe((0,E.x)(()=>this.isLoading=!1)).subscribe({next:i=>{var n,a;if("OK"===i.status&&i.data.canMonitor.enable)if(this._detectMobileService.isMobile()){const s=this._bottomSheetService.open(A.g,{headerTitle:"T\u1ea1o y\xeau c\u1ea7u canh v\xe9 r\u1ebb",rightButtonIcon:"close",rightButtonIconClass:"text-neutral-gray-4",leftButtonIcon:"",containerFullHeigh:!0,data:{bookingDetail:t,sourceEvent:"BOOKING_SUCCESS"}});s.containerInstance._rightButtonClick.subscribe(r=>s.dismiss())}else{const s=this._modal.open(A.g,{bookingDetail:t,sourceEvent:"BOOKING_SUCCESS"});s.afterClosed$.subscribe({next:r=>{r.data||s.close(!1)}})}else if("OK"!==i.status||i.data.canMonitor.enable){const s=null===(a=null===(n=i.objectError)||void 0===n?void 0:n.errorDescription)||void 0===a?void 0:a.vi;this._modal.open(D.V,{title:"M\xe3 \u0111\u1eb7t ch\u1ed7 kh\xf4ng h\u1ee3p l\u1ec7",content:s,status:"error",cancelText:"\u0110\xf3ng",okText:"Canh v\xe9 kh\xe1c",secondaryAction:!0}).afterClosed$.subscribe({next:c=>{c.data&&this.onRegisterNewPnrOrder()}})}else{let s="Xem danh s\xe1ch";s="TPS-TLF006"===i.data.canMonitor.reason.errorCode?"Qu\u1ea3n l\xfd canh v\xe9":"Canh v\xe9 kh\xe1c";const r=i.data.canMonitor.reason.desc;if(this._detectMobileService.isMobile()){const c=this._bottomSheetService.open(k.Q4,{headerTitle:"",rightButtonIcon:"close",rightButtonIconClass:"text-neutral-gray-4",data:{title:"M\xe3 \u0111\u1eb7t ch\u1ed7 kh\xf4ng h\u1ee3p l\u1ec7",body:r,okText:s,cancelText:"\u0110\xf3ng",hasIcon:!0,status:"error"}});c.containerInstance._rightButtonClick.subscribe(()=>{c.dismiss()}),c.afterDismissed().subscribe(d=>{d&&this.onRegisterNewPnrOrder()})}else this._modal.open(D.V,{title:"M\xe3 \u0111\u1eb7t ch\u1ed7 kh\xf4ng h\u1ee3p l\u1ec7",content:r,status:"error",cancelText:"\u0110\xf3ng",okText:s,secondaryAction:!0}).afterClosed$.subscribe({next:d=>{d.data&&("TPS-TLF006"===i.data.canMonitor.reason.errorCode?this._route.navigate(["admin/manage-pnr-orders"]):this.onRegisterNewPnrOrder())}})}},error:()=>{const i="Canh v\xe9 kh\xe1c";if(this._detectMobileService.isMobile()){const n=this._bottomSheetService.open(k.Q4,{headerTitle:"",rightButtonIcon:"close",rightButtonIconClass:"text-neutral-gray-4",data:{title:"M\xe3 \u0111\u1eb7t ch\u1ed7 kh\xf4ng h\u1ee3p l\u1ec7",body:`M\xe3 \u0111\u1eb7t ch\u1ed7 <strong>${t.bookingCode}</strong> kh\xf4ng h\u1ee3p l\u1ec7 \u0111\u1ec3 t\u1ea1o y\xeau c\u1ea7u canh v\xe9. Vui l\xf2ng canh v\xe9 v\u1edbi m\xe3 \u0111\u1eb7t ch\u1ed7 kh\xe1c.`,okText:i,cancelText:"\u0110\xf3ng",hasIcon:!0,status:"error"}});n.containerInstance._rightButtonClick.subscribe(()=>{n.dismiss()}),n.afterDismissed().subscribe(a=>{a&&this.onRegisterNewPnrOrder()})}else this._modal.open(D.V,{title:"M\xe3 \u0111\u1eb7t ch\u1ed7 kh\xf4ng h\u1ee3p l\u1ec7",content:`M\xe3 \u0111\u1eb7t ch\u1ed7 <strong>${t.bookingCode}</strong> kh\xf4ng h\u1ee3p l\u1ec7 \u0111\u1ec3 t\u1ea1o y\xeau c\u1ea7u canh v\xe9. Vui l\xf2ng canh v\xe9 v\u1edbi m\xe3 \u0111\u1eb7t ch\u1ed7 kh\xe1c.`,status:"error",cancelText:"\u0110\xf3ng",okText:i,secondaryAction:!0}).afterClosed$.subscribe({next:a=>{a.data&&this.onRegisterNewPnrOrder()}})}})}onRegisterNewPnrOrder(){if(this._eventLogService.captureOpenFormDownFare({hasPNR:0,source:0}),this._detectMobileService.isMobile()){const t=this._bottomSheetService.open(A.g,{headerTitle:"T\u1ea1o y\xeau c\u1ea7u canh v\xe9 r\u1ebb",rightButtonIcon:"close",rightButtonIconClass:"text-neutral-gray-4",leftButtonIcon:"",containerFullHeigh:!0,data:{isSuggest:!0,sourceEvent:"SUGGEST"}});t.containerInstance._rightButtonClick.subscribe(o=>t.dismiss())}else this._modal.open(A.g,{isSuggest:!0,sourceEvent:"SUGGEST"})}}return l.\u0275fac=function(t){return new(t||l)(e.Y36(ee.h),e.Y36(te.J),e.Y36(f.KNP),e.Y36(ie.U),e.Y36(oe.h),e.Y36(ne.G),e.Y36(se._),e.Y36(ae.m),e.Y36(re.oE),e.Y36(le.fB),e.Y36(ce.TU),e.Y36(ge.F0),e.Y36(y.Fj),e.Y36(g.$A),e.Y36(de.BX),e.Y36(he.t7),e.Y36(F.a2),e.Y36(ue.P),e.Y36(me.L),e.Y36(pe.s),e.Y36(ve.x))},l.\u0275cmp=e.Xpm({type:l,selectors:[["booking-success-page"]],standalone:!0,features:[e.jDz],decls:46,vars:59,consts:[[4,"ngIf"],[1,"w-full","h-full","flex","gap-x-4","justify-center","p-4","md:hidden"],[1,"w-[764px]","h-full","flex","flex-col","gap-2"],["class","mb-2",4,"ngIf"],[1,""],[1,"flex","gap-x-[20px]","mb-4"],[1,"w-1","bg-primary-2-4"],[1,"text-heading-md","text-neutral-black"],[1,"flex","flex-col","gap-y-2"],[3,"bookingDetail","isBooked","actionChange","retryBooking",4,"ngFor","ngForOf"],["class","bg-white rounded shadow-cf-md p-6",4,"ngIf"],[1,"mt-12","w-[340px]","h-fit","flex","flex-col","gap-y-4"],[3,"listBookingText","modeBookingText","bookingContact","listBookingTextExplain","actionShare","modeChange"],[3,"listBookingCode"],[1,"py-2","px-4","md:flex","hidden","whitespace-nowrap","overflow-x-scroll","bg-neutral-white","sticky","top-0","z-[1]","shadow-cf-sm"],[1,"px-4","py-1.5","rounded-full","text-espressive-md","text-neutral-gray-4","border","border-transparent",3,"click"],["bookingDetailTab",""],["paxInfoTab",""],["totalPriceTab",""],["ticketPriceTab",""],["ticketNumberTab",""],["remarkTab",""],["historyTab",""],["class","p-4 gap-y-3 md:flex md:flex-col hidden w-full",4,"ngIf"],["class","bg-neutral-white pt-3 pr-4 pb-3 pl-4 flex-row gap-0 items-end justify-end w-full fixed bottom-0 hidden md:flex",3,"z-1000","click",4,"ngIf"],[1,"mb-2"],[3,"passengerInfos"],[3,"bookingDetail","isBooked","actionChange","retryBooking"],[1,"bg-white","rounded","shadow-cf-md","p-6"],[1,"mb-4","flex","items-center","gap-x-3"],[1,"text-heading-sm","text-neutral-black"],[1,"table-auto","w-full"],[1,"border-b","border-neutral-gray-1"],[1,"text-left","text-espressive-sm","text-neutral-gray-4","py-3"],[4,"ngFor","ngForOf"],[1,"text-body-md","text-neutral-black","py-3"],[1,"w-[48px]","h-[24px]","object-contain",3,"src"],[1,"flex","gap-x-[20px]","my-4"],[1,"bg-white","rounded","shadow-cf-md"],[3,"priceDetail"],[1,"p-6","flex","flex-col","items-end","gap-[10px]"],[1,"flex","items-center","gap-4"],[1,"text-espressive-md","text-neutral-black"],[1,"min-w-[140px]","text-end","text-heading-lg","text-secondary-3-4"],[1,"p-4","gap-y-3","md:flex","md:flex-col","hidden","w-full"],[3,"bookingDetail","onDetailClick","actionChange","retryBooking",4,"ngFor","ngForOf"],["class"," w-full",4,"ngIf"],[3,"bookingDetail","onDetailClick","actionChange","retryBooking"],[1,"w-full"],[3,"title","active","contentClass","panelClass"],["titleTemplate",""],["class","flex flex-col mt-3 rounded-lg bg-neutral-white p-3 gap-y-2",4,"ngFor","ngForOf"],[1,"text-espressive-sm","text-neutral-black"],[1,"flex","flex-col","mt-3","rounded-lg","bg-neutral-white","p-3","gap-y-2"],[1,"flex","items-center","gap-x-5"],[1,"text-body-sm","text-neutral-gray-4","w-[104px]"],[1,"text-espressive-md","text-neutral-gray-6"],["class","flex flex-col rounded-lg bg-neutral-white p-3 gap-y-2",4,"ngFor","ngForOf"],[1,"flex","flex-col","rounded-lg","bg-neutral-white","p-3","gap-y-2"],[1,"bg-neutral-white","pt-3","pr-4","pb-3","pl-4","flex-row","gap-0","items-end","justify-end","w-full","fixed","bottom-0","hidden","md:flex",3,"click"],[1,"flex","flex-row","gap-1","items-center","justify-start","shrink-0","relative"],[1,"text-neutral-gray-4","text-left","relative","text-espressive-xs"],[1,"text-secondary-3-4","text-center","relative","text-heading-sm"],["icon","chevron_up","size","small"],["totalPriceBottomSheet",""],[1,"flex","flex-col","gap-4","items-start","justify-start","w-full","relative","p-4","pb-12"],[1,"flex","flex-row","gap-6","items-center","justify-start","self-stretch","shrink-0","relative"],[1,"flex","flex-row","gap-3","items-center","justify-start","flex-1","relative"],[1,"flex","flex-col","gap-1","items-start","justify-start","shrink-0","relative"],[1,"text-neutral-gray-4","text-left","relative","text-body-sm"],[1,"flex","flex-col","gap-1","items-end","justify-center","shrink-0","relative"],[1,"text-neutral-gray-4","text-right","relative","text-body-sm"],[1,"bg-neutral-white","rounded-lg","border-solid","p-4","flex","flex-col","gap-2","items-end","justify-start","shrink-0","w-full","relative","overflow-hidden"],[1,"flex","flex-row","gap-1.5","items-center","justify-start","shrink-0","relative",3,"click"],["size","small","icon","copy"],[1,"text-neutral-gray-6","text-center","relative","flex","items-center","justify-center","text-body-md"],[1,"text-body-sm","w-full",3,"bookingText"]],template:function(t,o){if(1&t){const i=e.EpF();e.YNc(0,be,1,0,"cf-spinner",0),e.TgZ(1,"div")(2,"div",1)(3,"div",2),e.YNc(4,fe,6,1,"div",3),e.TgZ(5,"div",4)(6,"div",5),e._UZ(7,"div",6),e.TgZ(8,"div",7),e._uU(9,"Chi ti\u1ebft \u0111\u1eb7t ch\u1ed7"),e.qZA()(),e.TgZ(10,"div",8),e.YNc(11,ke,1,3,"booking-detail",9),e.qZA()(),e.YNc(12,Ce,22,1,"div",10),e.YNc(13,Se,22,1,"div",10),e.YNc(14,ye,15,8,"div",0),e.qZA(),e.TgZ(15,"div",11)(16,"cf-booking-text",12),e.NdJ("actionShare",function(a){return o.onShare(a)})("modeChange",function(a){return o.changeModeBookingText(a)}),e.qZA(),e._UZ(17,"remark-booking-page",13),e.qZA()(),e.TgZ(18,"div",14)(19,"div",15,16),e.NdJ("click",function(){e.CHM(i);const a=e.MAs(20);return e.KtG(o.mobileTabChange("BOOKING_DETAIL",a))}),e._uU(21," Chi ti\u1ebft \u0111\u1eb7t ch\u1ed7 "),e.qZA(),e.TgZ(22,"div",15,17),e.NdJ("click",function(){e.CHM(i);const a=e.MAs(23);return e.KtG(o.mobileTabChange("PAX_INFO",a))}),e._uU(24," Th\xf4ng tin h\xe0nh kh\xe1ch "),e.qZA(),e.TgZ(25,"div",15,18),e.NdJ("click",function(){e.CHM(i);const a=e.MAs(26);return e.KtG(o.mobileTabChange("TOTAL_PRICE",a))}),e._uU(27," T\u1ed5ng chi ph\xed "),e.qZA(),e.TgZ(28,"div",15,19),e.NdJ("click",function(){e.CHM(i);const a=e.MAs(29);return e.KtG(o.mobileTabChange("TICKET_FACE",a))}),e._uU(30," M\u1eb7t v\xe9 "),e.qZA(),e.TgZ(31,"div",15,20),e.NdJ("click",function(){e.CHM(i);const a=e.MAs(32);return e.KtG(o.mobileTabChange("TICKET_NUMBER",a))}),e._uU(33," S\u1ed1 v\xe9 "),e.qZA(),e.TgZ(34,"div",15,21),e.NdJ("click",function(){e.CHM(i);const a=e.MAs(35);return e.KtG(o.mobileTabChange("REMARK",a))}),e._uU(36," Remark "),e.qZA(),e.TgZ(37,"div",15,22),e.NdJ("click",function(){e.CHM(i);const a=e.MAs(38);return e.KtG(o.mobileTabChange("HISTORY",a))}),e._uU(39," L\u1ecbch s\u1eed "),e.qZA()(),e.YNc(40,Pe,4,3,"div",23),e.YNc(41,Oe,22,3,"div",23),e.YNc(42,Re,2,1,"div",23),e.YNc(43,Le,12,9,"div",24),e.YNc(44,Ke,2,1,"div",23),e.YNc(45,we,2,1,"div",23),e.qZA()}2&t&&(e.Q6J("ngIf",o.isLoading),e.xp6(4),e.Q6J("ngIf",o.isSuccess),e.xp6(7),e.Q6J("ngForOf",o.bookingDetails),e.xp6(1),e.Q6J("ngIf",o.hasBaggageSelected),e.xp6(1),e.Q6J("ngIf",o.hasSeatSelected),e.xp6(1),e.Q6J("ngIf",o.isSuccess),e.xp6(2),e.Q6J("listBookingText",o.listBookingText)("modeBookingText",o.modeBookingText)("bookingContact",o.bookingContact)("listBookingTextExplain",o.listBookingTextExplain),e.xp6(1),e.Q6J("listBookingCode",o.listBookingCode),e.xp6(2),e.ekj("text-secondary-3-4","BOOKING_DETAIL"===o.mobileTabMode)("!border-secondary-3-4","BOOKING_DETAIL"===o.mobileTabMode)("bg-secondary-3-1","BOOKING_DETAIL"===o.mobileTabMode),e.xp6(3),e.ekj("text-secondary-3-4","PAX_INFO"===o.mobileTabMode)("!border-secondary-3-4","PAX_INFO"===o.mobileTabMode)("bg-secondary-3-1","PAX_INFO"===o.mobileTabMode),e.xp6(3),e.ekj("text-secondary-3-4","TOTAL_PRICE"===o.mobileTabMode)("!border-secondary-3-4","TOTAL_PRICE"===o.mobileTabMode)("bg-secondary-3-1","TOTAL_PRICE"===o.mobileTabMode),e.xp6(3),e.ekj("text-secondary-3-4","TICKET_FACE"===o.mobileTabMode)("!border-secondary-3-4","TICKET_FACE"===o.mobileTabMode)("bg-secondary-3-1","TICKET_FACE"===o.mobileTabMode),e.xp6(3),e.ekj("text-secondary-3-4","TICKET_NUMBER"===o.mobileTabMode)("!border-secondary-3-4","TICKET_NUMBER"===o.mobileTabMode)("bg-secondary-3-1","TICKET_NUMBER"===o.mobileTabMode),e.xp6(3),e.ekj("text-secondary-3-4","REMARK"===o.mobileTabMode)("!border-secondary-3-4","REMARK"===o.mobileTabMode)("bg-secondary-3-1","REMARK"===o.mobileTabMode),e.xp6(3),e.ekj("text-secondary-3-4","HISTORY"===o.mobileTabMode)("!border-secondary-3-4","HISTORY"===o.mobileTabMode)("bg-secondary-3-1","HISTORY"===o.mobileTabMode),e.xp6(3),e.Q6J("ngIf","BOOKING_DETAIL"===o.mobileTabMode),e.xp6(1),e.Q6J("ngIf","PAX_INFO"===o.mobileTabMode),e.xp6(1),e.Q6J("ngIf","TOTAL_PRICE"===o.mobileTabMode),e.xp6(1),e.Q6J("ngIf","TOTAL_PRICE"===o.mobileTabMode),e.xp6(1),e.Q6J("ngIf","TICKET_FACE"===o.mobileTabMode),e.xp6(1),e.Q6J("ngIf","REMARK"===o.mobileTabMode))},dependencies:[C.O5,C.ax,w.AS,C.JJ,x.Js,x.AT,x.Cg,f.AxE,f.Sm8,k.OR,L.j$,U.N8,k.bY,K.N,x.CY,O.B,O.K,F.DW,k.gx],encapsulation:2}),l})()}}]);