"use strict";(self.webpackChunkcheapflightclient=self.webpackChunkcheapflightclient||[]).push([[9716],{86938:(Z,S,c)=>{c.d(S,{Y:()=>k});var f=c(80529),w=c(88001),x=c(50494),m=c(54004),A=c(69751),g=c(97582),h=c(87067);let U=(()=>{class l{}return(0,g.gn)([(0,h.C)()],l.prototype,"user_id",void 0),(0,g.gn)([(0,h.C)()],l.prototype,"session_id",void 0),(0,g.gn)([(0,h.C)()],l.prototype,"description",void 0),l})(),N=(()=>{class l{}return(0,g.gn)([(0,h.C)()],l.prototype,"content",void 0),(0,g.gn)([(0,h.C)()],l.prototype,"type",void 0),l})(),p=(()=>{class l{}return(0,g.gn)([(0,h.C)()],l.prototype,"original",void 0),(0,g.gn)([(0,h.C)()],l.prototype,"vi",void 0),l})();var v=c(94650);const y={headers:new f.WM({"Content-Type":"application/json"})};let k=(()=>{class l{constructor(o,u){this.http=o,this.appConfig=u}getAllConversation(){return this.http.get(this.appConfig.apiUrlAi+"conversations",y).pipe((0,m.U)(o=>(0,x.yE)(U,o,{excludeExtraneousValues:!0})))}getSessionHistory(o){return this.http.get(this.appConfig.apiUrlAi+"conversations/"+o,y).pipe((0,m.U)(u=>(0,x.yE)(N,u,{excludeExtraneousValues:!0})))}checkToken(){return this.http.get(this.appConfig.apiUrlAi+"check-token",y)}chat(o,u){return this.http.post(this.appConfig.apiUrlAi+"conversations/chat",JSON.stringify({question:u,session_id:o}),{responseType:"text",observe:"body",headers:new f.WM({"Content-Type":"application/json"})})}getTranslateFareClassTitle(o){return this.http.post(this.appConfig.apiUrlAi+"translate/fare-class-title",JSON.stringify(o),y).pipe((0,m.U)(u=>(0,x.yE)(p,u,{excludeExtraneousValues:!0})))}chatv2(o,u){const e={question:u,session_id:o};return new A.y(r=>{const a=new XMLHttpRequest;a.open("POST",this.appConfig.apiUrlAi+"conversations/chat",!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept","text/event-stream"),a.setRequestHeader("Authorization","Bearer "+this.getAccessToken()),a.onreadystatechange=()=>{if(a.readyState===XMLHttpRequest.LOADING&&200===a.status){const T=a.responseText;r.next(T),console.log(T)}a.readyState===XMLHttpRequest.DONE&&200===a.status&&(r.next(a.responseText),r.complete()),a.readyState===XMLHttpRequest.DONE&&401===a.status&&r.error(401)},a.onerror=T=>r.error(T),a.send(JSON.stringify(e))})}translateFareClass(o){const u={query:o};return new A.y(e=>{const r=new XMLHttpRequest;r.open("POST",this.appConfig.apiUrlAi+"translate/fare-class",!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept","text/event-stream"),r.setRequestHeader("Authorization","Bearer "+this.getAccessToken()),r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.LOADING&&200===r.status){const a=r.responseText;e.next(a),console.log(a)}r.readyState===XMLHttpRequest.DONE&&200===r.status&&(e.next(r.responseText),e.complete()),r.readyState===XMLHttpRequest.DONE&&401===r.status&&e.error(401)},r.onerror=a=>e.error(a),r.send(JSON.stringify(u))})}getAccessToken(){const o=this.getUser();return null==o?null:o.data.accessToken}getUser(){const o=localStorage.getItem("currentUser");return o?JSON.parse(o):null}}return l.\u0275fac=function(o){return new(o||l)(v.LFG(f.eN),v.LFG(w.qB))},l.\u0275prov=v.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()},39716:(Z,S,c)=>{c.r(S),c.d(S,{GaiComponent:()=>R});var f=c(36895),w=c(83700),x=c(44143),m=c(24006);const g={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var h,U=new Uint8Array(16);function N(){if(!h&&!(h=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(U)}for(var p=[],v=0;v<256;++v)p.push((v+256).toString(16).slice(1));const o=function C(t,n,s){if(g.randomUUID&&!n&&!t)return g.randomUUID();var i=(t=t||{}).random||(t.rng||N)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,n){s=s||0;for(var d=0;d<16;++d)n[s+d]=i[d];return n}return function y(t,n=0){return(p[t[n+0]]+p[t[n+1]]+p[t[n+2]]+p[t[n+3]]+"-"+p[t[n+4]]+p[t[n+5]]+"-"+p[t[n+6]]+p[t[n+7]]+"-"+p[t[n+8]]+p[t[n+9]]+"-"+p[t[n+10]]+p[t[n+11]]+p[t[n+12]]+p[t[n+13]]+p[t[n+14]]+p[t[n+15]]).toLowerCase()}(i)};var u=c(55471),e=c(94650),r=c(86938);const a=["scrollChat"];function T(t,n){1&t&&(e.TgZ(0,"div",18),e._uU(1,"Ch\u01b0a c\xf3 cu\u1ed9c h\u1ed9i tho\u1ea1i n\xe0o"),e.qZA())}function M(t,n){if(1&t){const s=e.EpF();e.TgZ(0,"div",19)(1,"div",20),e.NdJ("click",function(){const _=e.CHM(s).$implicit,F=e.oxw();return e.KtG(F.changeSession(_))}),e.TgZ(2,"div",21),e._uU(3),e.qZA()()()}if(2&t){const s=n.$implicit,i=e.oxw();e.xp6(1),e.ekj("bg-neutral-gray-1",i.sessionSelected.session_id===s.session_id),e.xp6(2),e.Oqu(s.description)}}function b(t,n){if(1&t&&(e.TgZ(0,"div",23)(1,"span",24),e._uU(2),e.qZA()()),2&t){const s=e.oxw().$implicit;e.xp6(2),e.Oqu(s.content)}}function E(t,n){if(1&t&&(e.TgZ(0,"div",25)(1,"div",26),e._UZ(2,"img",27),e.qZA(),e.TgZ(3,"div",28),e._UZ(4,"markdown",29),e.qZA()()),2&t){const s=e.oxw().$implicit;e.xp6(4),e.Q6J("data",s.content)}}function G(t,n){if(1&t&&(e.ynx(0),e.YNc(1,b,3,1,"div",22),e.YNc(2,E,5,1,"div",12),e.BQk()),2&t){const s=n.$implicit;e.xp6(1),e.Q6J("ngIf","human"==s.type),e.xp6(1),e.Q6J("ngIf","ai"==s.type||"AIMessageChunk"==s.type)}}function O(t,n){if(1&t&&(e.TgZ(0,"div",25)(1,"div",26),e._UZ(2,"img",27),e.qZA(),e.TgZ(3,"div",28),e._UZ(4,"markdown",29),e.qZA()()),2&t){const s=e.oxw();e.xp6(4),e.Q6J("data",s.streamingText)}}let R=(()=>{class t{constructor(s,i){this._aiService=s,this._cdr=i,this.isNewSession=!0,this.sessions=[],this.sessionSelected={session_id:"",user_id:"",description:""},this.inputText="",this.humanMessage="",this.messages=[],this.streamingText=""}ngOnInit(){this.loadSessions(),this.createNewSession()}loadSessions(){this._aiService.getAllConversation().subscribe({next:s=>{this.sessions=s.map(i=>({user_id:i.user_id,session_id:i.session_id,description:this.upperFirstLetter(i.description)}))}})}createNewSession(){this.isNewSession=!0,this.sessionSelected={session_id:o(),user_id:"",description:""},this.messages=[]}changeSession(s){this.isNewSession=!1,this.sessionSelected=s,this._aiService.getSessionHistory(this.sessionSelected.session_id).subscribe({next:i=>{this.messages=i,this.scrollToBottom()}})}ignoreTextAreaEnterDefault(s){s.preventDefault()}sendMessage(){""!=this.inputText&&(this.humanMessage=this.inputText,this.messages.push({content:this.humanMessage,type:"human"}),this.inputText="",this._cdr.markForCheck(),this.scrollToBottom(),this.callChat())}callChat(){this._aiService.chatv2(this.sessionSelected.session_id,this.humanMessage).subscribe({next:s=>{this.streamingText=s,this.scrollToBottom()},complete:()=>{this.messages.push({content:this.streamingText,type:"ai"}),this.streamingText="",this.isNewSession&&(this.sessions.push({session_id:this.sessionSelected.session_id,user_id:"",description:this.upperFirstLetter(this.humanMessage)}),this.isNewSession=!1),this._cdr.markForCheck(),this.scrollToBottom()},error:s=>{401==s&&this._aiService.getAllConversation().subscribe({next:i=>{this.callChat()}})}})}scrollToBottom(){setTimeout(()=>{this.scrollChatContainer.nativeElement.scrollTop=this.scrollChatContainer.nativeElement.scrollHeight})}upperFirstLetter(s){return s&&s[0].toUpperCase()+s.slice(1)||""}}return t.\u0275fac=function(s){return new(s||t)(e.Y36(r.Y),e.Y36(e.sBO))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-gai"]],viewQuery:function(s,i){if(1&s&&e.Gf(a,5),2&s){let d;e.iGM(d=e.CRH())&&(i.scrollChatContainer=d.first)}},standalone:!0,features:[e.jDz],decls:20,vars:6,consts:[[1,"w-full","h-[calc(100vh-80px)]","p-4","bg-neutral-gray-1"],[1,"bg-white","w-full","h-full","rounded","flex"],[1,"w-[300px]","h-full","border-r","border-r-neutral-gray-1","shrink-0","flex","flex-col"],[1,"border-b","border-b-neutral-gray-1","p-2","flex","items-center","justify-center","mb-1"],["cf-button","",1,"",3,"click"],[1,"flex","flex-col-reverse","overflow-y-auto"],["class","text-body-sm flex justify-center px-2 py-1",4,"ngIf"],["class","px-2 py-0.5",4,"ngFor","ngForOf"],[1,"flex","w-full","h-full","flex-col"],[1,"w-full","h-full","overflow-x-hidden","p-3","space-y-5","scroll-smooth","flex","flex-col","relative"],["scrollChat",""],[4,"ngFor","ngForOf"],["class","flex space-x-2 w-full",4,"ngIf"],[1,"h-[10px]","shrink-0"],[1,"shrink-0","bottom-0","w-full","p-2","bg-white","border-t","border-t-neutral-gray-1","flex","justify-center","items-center","space-x-2"],[1,"!w-[80%]"],["cf-input","",1,"w-[80%]","resize-none",3,"rows","ngModel","ngModelChange","keydown.enter","keyup.enter"],["cf-button","",3,"click"],[1,"text-body-sm","flex","justify-center","px-2","py-1"],[1,"px-2","py-0.5"],[1,"px-2","py-1","rounded","hover:bg-neutral-gray-1","cursor-pointer",3,"click"],[1,"line-clamp-1"],["class","rounded-2xl py-2 px-4 bg-neutral-gray-1 max-w-[80%] w-fit self-end",4,"ngIf"],[1,"rounded-2xl","py-2","px-4","bg-neutral-gray-1","max-w-[80%]","w-fit","self-end"],[1,"whitespace-break-spaces"],[1,"flex","space-x-2","w-full"],[1,"w-5","h-5","rounded-full","shrink-0"],["src","/assets/logo/small_logo.png",1,"w-5","h-5"],[1,"rounded","px-2","leading-8"],[3,"data"]],template:function(s,i){1&s&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),e.NdJ("click",function(){return i.createNewSession()}),e._uU(5,"T\u1ea1o tr\xf2 chuy\u1ec7n m\u1edbi"),e.qZA()(),e.TgZ(6,"div",5),e.YNc(7,T,2,0,"div",6),e.YNc(8,M,4,3,"div",7),e.qZA()(),e.TgZ(9,"div",8)(10,"div",9,10),e.YNc(12,G,3,2,"ng-container",11),e.YNc(13,O,5,1,"div",12),e._UZ(14,"div",13),e.qZA(),e.TgZ(15,"div",14)(16,"cf-input-group",15)(17,"textarea",16),e.NdJ("ngModelChange",function(_){return i.inputText=_})("keydown.enter",function(_){return i.ignoreTextAreaEnterDefault(_)})("keyup.enter",function(){return i.sendMessage()}),e.qZA()(),e.TgZ(18,"button",17),e.NdJ("click",function(){return i.sendMessage()}),e._uU(19,"G\u1eedi"),e.qZA()()()()()),2&s&&(e.xp6(7),e.Q6J("ngIf",0==i.sessions.length),e.xp6(1),e.Q6J("ngForOf",i.sessions),e.xp6(4),e.Q6J("ngForOf",i.messages),e.xp6(1),e.Q6J("ngIf",i.streamingText),e.xp6(4),e.Q6J("rows",1)("ngModel",i.inputText))},dependencies:[f.ez,f.sg,f.O5,w.N8,w.Xq,x.j$,x.ND,x.BN,m.u5,m.Fj,m.JJ,m.On,u.JP,u.lF],styles:["ul{list-style:revert;margin:0;padding:revert}  p{margin-bottom:16px!important}  p, li[_ngcontent-%COMP%]{white-space:break-spaces}"]}),t})()}}]);