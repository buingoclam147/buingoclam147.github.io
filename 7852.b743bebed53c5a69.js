"use strict";(self.webpackChunkcheapflightclient=self.webpackChunkcheapflightclient||[]).push([[7852],{97852:(b,p,o)=>{o.r(p),o.d(p,{GaiComponent:()=>w});var c=o(36895),d=o(83700),u=o(44143),l=o(24006),g=o(51588),h=o(55471),e=o(94650),m=o(86938);const f=["scrollChat"];function x(i,n){1&i&&(e.TgZ(0,"div",18),e._uU(1,"Ch\u01b0a c\xf3 cu\u1ed9c h\u1ed9i tho\u1ea1i n\xe0o"),e.qZA())}function _(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",19)(1,"div",20),e.NdJ("click",function(){const a=e.CHM(t).$implicit,Z=e.oxw();return e.KtG(Z.changeSession(a))}),e.TgZ(2,"div",21),e._uU(3),e.qZA()()()}if(2&i){const t=n.$implicit,s=e.oxw();e.xp6(1),e.ekj("bg-neutral-gray-1",s.sessionSelected.session_id===t.session_id),e.xp6(2),e.Oqu(t.description)}}function v(i,n){if(1&i&&(e.TgZ(0,"div",23)(1,"span",24),e._uU(2),e.qZA()()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.content)}}function T(i,n){if(1&i&&(e.TgZ(0,"div",25)(1,"div",26),e._UZ(2,"img",27),e.qZA(),e.TgZ(3,"div",28),e._UZ(4,"markdown",29),e.qZA()()),2&i){const t=e.oxw().$implicit;e.xp6(4),e.Q6J("data",t.content)}}function C(i,n){if(1&i&&(e.ynx(0),e.YNc(1,v,3,1,"div",22),e.YNc(2,T,5,1,"div",12),e.BQk()),2&i){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf","human"==t.type),e.xp6(1),e.Q6J("ngIf","ai"==t.type||"AIMessageChunk"==t.type)}}function y(i,n){if(1&i&&(e.TgZ(0,"div",25)(1,"div",26),e._UZ(2,"img",27),e.qZA(),e.TgZ(3,"div",28),e._UZ(4,"markdown",29),e.qZA()()),2&i){const t=e.oxw();e.xp6(4),e.Q6J("data",t.streamingText)}}let w=(()=>{class i{constructor(t,s){this._aiService=t,this._cdr=s,this.isNewSession=!0,this.sessions=[],this.sessionSelected={session_id:"",user_id:"",description:""},this.inputText="",this.humanMessage="",this.messages=[],this.streamingText=""}ngOnInit(){this.loadSessions(),this.createNewSession()}loadSessions(){this._aiService.getAllConversation().subscribe({next:t=>{this.sessions=t.map(s=>({user_id:s.user_id,session_id:s.session_id,description:this.upperFirstLetter(s.description)}))}})}createNewSession(){this.isNewSession=!0,this.sessionSelected={session_id:(0,g.Z)(),user_id:"",description:""},this.messages=[]}changeSession(t){this.isNewSession=!1,this.sessionSelected=t,this._aiService.getSessionHistory(this.sessionSelected.session_id).subscribe({next:s=>{this.messages=s,this.scrollToBottom()}})}ignoreTextAreaEnterDefault(t){t.preventDefault()}sendMessage(){""!=this.inputText&&(this.humanMessage=this.inputText,this.messages.push({content:this.humanMessage,type:"human"}),this.inputText="",this._cdr.markForCheck(),this.scrollToBottom(),this.callChat())}callChat(){this._aiService.chatv2(this.sessionSelected.session_id,this.humanMessage).subscribe({next:t=>{this.streamingText=t,this.scrollToBottom()},complete:()=>{this.messages.push({content:this.streamingText,type:"ai"}),this.streamingText="",this.isNewSession&&(this.sessions.push({session_id:this.sessionSelected.session_id,user_id:"",description:this.upperFirstLetter(this.humanMessage)}),this.isNewSession=!1),this._cdr.markForCheck(),this.scrollToBottom()},error:t=>{401==t&&this._aiService.getAllConversation().subscribe({next:s=>{this.callChat()}})}})}scrollToBottom(){setTimeout(()=>{this.scrollChatContainer.nativeElement.scrollTop=this.scrollChatContainer.nativeElement.scrollHeight})}upperFirstLetter(t){return t&&t[0].toUpperCase()+t.slice(1)||""}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(m.Y),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-gai"]],viewQuery:function(t,s){if(1&t&&e.Gf(f,5),2&t){let r;e.iGM(r=e.CRH())&&(s.scrollChatContainer=r.first)}},standalone:!0,features:[e.jDz],decls:20,vars:6,consts:[[1,"w-full","h-[calc(100vh-80px)]","p-4","bg-neutral-gray-1"],[1,"bg-white","w-full","h-full","rounded","flex"],[1,"w-[300px]","h-full","border-r","border-r-neutral-gray-1","shrink-0","flex","flex-col"],[1,"border-b","border-b-neutral-gray-1","p-2","flex","items-center","justify-center","mb-1"],["cf-button","",1,"",3,"click"],[1,"flex","flex-col-reverse","overflow-y-auto"],["class","text-body-sm flex justify-center px-2 py-1",4,"ngIf"],["class","px-2 py-0.5",4,"ngFor","ngForOf"],[1,"flex","w-full","h-full","flex-col"],[1,"w-full","h-full","overflow-x-hidden","p-3","space-y-5","scroll-smooth","flex","flex-col","relative"],["scrollChat",""],[4,"ngFor","ngForOf"],["class","flex space-x-2 w-full",4,"ngIf"],[1,"h-[10px]","shrink-0"],[1,"shrink-0","bottom-0","w-full","p-2","bg-white","border-t","border-t-neutral-gray-1","flex","justify-center","items-center","space-x-2"],[1,"!w-[80%]"],["cf-input","",1,"w-[80%]","resize-none",3,"rows","ngModel","ngModelChange","keydown.enter","keyup.enter"],["cf-button","",3,"click"],[1,"text-body-sm","flex","justify-center","px-2","py-1"],[1,"px-2","py-0.5"],[1,"px-2","py-1","rounded","hover:bg-neutral-gray-1","cursor-pointer",3,"click"],[1,"line-clamp-1"],["class","rounded-2xl py-2 px-4 bg-neutral-gray-1 max-w-[80%] w-fit self-end",4,"ngIf"],[1,"rounded-2xl","py-2","px-4","bg-neutral-gray-1","max-w-[80%]","w-fit","self-end"],[1,"whitespace-break-spaces"],[1,"flex","space-x-2","w-full"],[1,"w-5","h-5","rounded-full","shrink-0"],["src","/assets/logo/small_logo.png",1,"w-5","h-5"],[1,"rounded","px-2","leading-8"],[3,"data"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),e.NdJ("click",function(){return s.createNewSession()}),e._uU(5,"T\u1ea1o tr\xf2 chuy\u1ec7n m\u1edbi"),e.qZA()(),e.TgZ(6,"div",5),e.YNc(7,x,2,0,"div",6),e.YNc(8,_,4,3,"div",7),e.qZA()(),e.TgZ(9,"div",8)(10,"div",9,10),e.YNc(12,C,3,2,"ng-container",11),e.YNc(13,y,5,1,"div",12),e._UZ(14,"div",13),e.qZA(),e.TgZ(15,"div",14)(16,"cf-input-group",15)(17,"textarea",16),e.NdJ("ngModelChange",function(a){return s.inputText=a})("keydown.enter",function(a){return s.ignoreTextAreaEnterDefault(a)})("keyup.enter",function(){return s.sendMessage()}),e.qZA()(),e.TgZ(18,"button",17),e.NdJ("click",function(){return s.sendMessage()}),e._uU(19,"G\u1eedi"),e.qZA()()()()()),2&t&&(e.xp6(7),e.Q6J("ngIf",0==s.sessions.length),e.xp6(1),e.Q6J("ngForOf",s.sessions),e.xp6(4),e.Q6J("ngForOf",s.messages),e.xp6(1),e.Q6J("ngIf",s.streamingText),e.xp6(4),e.Q6J("rows",1)("ngModel",s.inputText))},dependencies:[c.ez,c.sg,c.O5,d.N8,d.Xq,u.j$,u.ND,u.BN,l.u5,l.Fj,l.JJ,l.On,h.JP,h.lF],styles:["ul{list-style:revert;margin:0;padding:revert}  p{margin-bottom:16px!important}  p, li[_ngcontent-%COMP%]{white-space:break-spaces}"]}),i})()}}]);