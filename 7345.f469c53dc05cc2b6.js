"use strict";(self.webpackChunkcheapflightclient=self.webpackChunkcheapflightclient||[]).push([[7345],{97345:(X,C,r)=>{r.r(C),r.d(C,{BtcSearchComponent:()=>z});var _=r(36895),S=r(83700),F=r(27898),o=r(72506),d=r(50518),T=r(64070),L=r(41047),A=r(54646),O=r(99137),M=r(53620),D=r(37453),B=r(82858),j=r(82692),P=r(53819),I=r(88001),u=r(15439),Y=r(77579),J=r(82722),e=r(94650),E=r(31380),Z=r(24006),N=r(28490),w=r(98184),R=r(88605),G=r(9381),Q=r(77492),H=r(11787);const U=["containerEl"],W=["searchInputCpn"];function K(h,m){if(1&h){const n=e.EpF();e.TgZ(0,"div",24)(1,"btc-num-of-pas",7),e.NdJ("numberOfPassengerChange",function(i){e.CHM(n);const a=e.oxw();return e.KtG(a.numberOfPassengerChange(i))}),e.qZA(),e.TgZ(2,"btc-airline-filter",8),e.NdJ("airlineFilterChange",function(i){e.CHM(n);const a=e.oxw();return e.KtG(a.airlineFilterChange(i))}),e.qZA(),e._UZ(3,"btc-voucher-selector",9),e.TgZ(4,"btc-cabin-selector",10),e.NdJ("cabinChange",function(i){e.CHM(n);const a=e.oxw();return e.KtG(a.cabinChange(i))}),e.qZA(),e.TgZ(5,"btc-pax-type-selector",11),e.NdJ("paxTypeChange",function(i){e.CHM(n);const a=e.oxw();return e.KtG(a.paxTypeChange(i))}),e.qZA()()}if(2&h){const n=e.oxw();e.xp6(1),e.Q6J("adultNumber",n.dataSearch.adultCount)("childNumber",n.dataSearch.childCount)("infantNumber",n.dataSearch.infantCount),e.xp6(1),e.Q6J("airlineList",n.airlineFilters),e.xp6(1),e.Q6J("isShowTooltipFirstTime",!1)("promotionGroupList",n.dataSearch.promotionGroupFilters),e.xp6(1),e.Q6J("cabinList",n.cabinList)("actived",n.isAirLineInternational),e.xp6(1),e.Q6J("paxTypeList",n.paxTypeList)("actived",n.isAirLineInternational)}}let z=(()=>{class h{constructor(n,t,i,a,s,g,v,p,f,y,b){this.cfIconRegister=n,this._helperSvc=t,this._fb=i,this._locationDataService=a,this.overlayContainer=s,this._mobileDetectSvc=g,this._cdr=v,this._eventLogService=p,this.searchResultProviderSvc=f,this.appConfig=y,this._viewportRuler=b,this.dataSearch=d.Av,this.airlineFilters=d._q,this.cabinList=d.St,this.paxTypeList=d.S,this.isAirLineInternational=!1,this.typeSearch=T.VB,this.isMobile=!1,this._destroy$=new Y.x,this.initIcon(),this.initForm(),this.isMobile=this._mobileDetectSvc.isMobile()}ngOnDestroy(){this.onOverlayStateChange().disconnect(),this._destroy$.next(),this._destroy$.complete()}ngAfterViewInit(){window.addEventListener("message",n=>{var t;if("onOutside"===n.data&&(this.searchInputCpn.dateRange.close(),this.outsideClick()),n.data&&"sendUtmParams"===n.data.action){const i=null===(t=n.data)||void 0===t?void 0:t.utmParams;this.searchResultProviderSvc.btcCampaignData={utmParams:i}}}),this.onOverlayStateChange()}isOverlayOpen(){return this.overlayContainer.getContainerElement().children.length>0}onOverlayStateChange(){const n=this.overlayContainer.getContainerElement(),t=new MutationObserver(()=>{window.parent.postMessage({isOverlayOpen:this.isOverlayOpen(),isMobile:this.isMobile},"*")});return t.observe(n,{childList:!0}),t}outsideClick(){this.containerEl.nativeElement.click()}ngOnInit(){window.onload=()=>{const t=document.documentElement.scrollHeight;window.parent.postMessage({height:t},"*")},new MutationObserver(()=>{const t=document.documentElement.scrollHeight;window.parent.postMessage({height:t},"*")}).observe(document.body,{attributes:!0,childList:!0,subtree:!0}),this._viewportRuler.change().pipe((0,J.R)(this._destroy$)).subscribe(()=>{this.isMobile=matchMedia("(max-width: 768px)").matches,this._cdr.detectChanges()})}initForm(){this.journeyFormArr=this._fb.array([]),this._helperSvc.addJourney({startPoint:null,endPoint:null,departDate:null},this.journeyFormArr,"ONE_WAY")}initIcon(){this.cfIconRegister.registerIcons([o.bHT,o.D5L,o.TM4,o.gll,o.TOh,o.KYu,o.tLH,o.IIV,o._hx,o.YwC,o.esH])}flightTypeChange(n){var t;switch(this.isMobile&&window.parent.postMessage({typeSearch:n},"*"),n){case this.typeSearch.OneWay:this._helperSvc.updateJourneyByType(this.journeyFormArr,"ONE_WAY");break;case this.typeSearch.RoundTrip:this._helperSvc.updateJourneyByType(this.journeyFormArr,"ROUND_TRIP");break;case this.typeSearch.MultiWay:this._helperSvc.updateJourneyByType(this.journeyFormArr,"MULTI_WAY")}const{cabin:i,paxType:a,airline:s}=null===(t=this.dataSearch)||void 0===t?void 0:t.journey[0];this.dataSearch=Object.assign(Object.assign({},this.dataSearch),{type:n,journey:this._helperSvc.progressJourneyFormArr(this.journeyFormArr.value,n,{cabin:i,paxType:a,airline:s})})}progressInternationalFlight(n){let t=!1;return(n.startPoint||n.endPoint)&&(t=!!n.startPoint&&this._locationDataService.checkAirportInternational(n.startPoint)||!!n.endPoint&&this._locationDataService.checkAirportInternational(n.endPoint),this.cabinList=[...this._helperSvc.resetCabinList(this.cabinList)],this.paxTypeList=[...this._helperSvc.resetPaxTypeList(this.paxTypeList)]),this.airlineFilters=[...this._helperSvc.progressAirlineFileByInternational(this.airlineFilters,t)],t}numberOfPassengerChange({adult:n,child:t,infant:i}){this.dataSearch=Object.assign(Object.assign({},this.dataSearch),{adultCount:n,childCount:t,infantCount:i})}airlineFilterChange(n){this.airlineFilters.forEach(t=>t.actived=!1),this.airlineFilters.filter(t=>n.includes(t.value)).forEach(t=>t.actived=!0)}cabinChange(n){this.cabinList=[...this.cabinList.map(t=>Object.assign(Object.assign({},t),{actived:n.value===t.value}))]}paxTypeChange({value:n}){this.paxTypeList=[...this.paxTypeList.map(t=>Object.assign(Object.assign({},t),{actived:!!n&&t.value===n}))]}removeRoute(n){console.log("remove route",n)}searchInputChange(){this.isAirLineInternational=this.progressInternationalFlight(this.journeyFormArr.controls[0].value)}generateRangeDateSearchMinFare(n){const t=u(new Date),i=u(n);let a=[];a.push(t.format("YYYY-MM-DD"));let s=t.clone().add(1,"month").startOf("month");for(;s.isBefore(i)||s.isSame(i,"month");)a.push(s.format("YYYY-MM-DD")),s.add(1,"month");return a}onDateTypeChange(n){console.log("date type change",n)}onCheckDirectFlight(n){this.dataSearch.isDirectFlight=n}searchFlight(){var n,t,i;if(this.journeyFormArr.markAllAsTouched(),this.journeyFormArr.invalid)return;const{adultCount:a,childCount:s,infantCount:g,isDirectFlight:v,type:p,promotionGroupFilters:f}=this.dataSearch,y=null===(n=this.cabinList.find(l=>l.actived))||void 0===n?void 0:n.value,b=null===(t=this.paxTypeList.find(l=>l.actived))||void 0===t?void 0:t.value,V=this.airlineFilters.filter(l=>l.actived).map(l=>l.value).join(","),c=this._helperSvc.progressJourneyFormArr(this.journeyFormArr.value,p,{cabin:y,paxType:b,airline:V});this._eventLogService.captureGMBRSearchClick(Object.assign({search_type:p===T.VB.OneWay?"OW":"RT",start_point:c[0].startPoint,end_point:c[0].endPoint,chain_point:`${c[0].startPoint}-${c[0].endPoint}`,departure_date:c[0].departDate?u(c[0].departDate).format("YYYY-MM-DD"):"",return_date:c[1]&&c[1].departDate?u(c[1].departDate).format("YYYY-MM-DD"):"",num_adt:a,num_chd:s,num_inf:g,device_type:this.isMobile?"MOBILE":"DESKTOP"},null===(i=this.searchResultProviderSvc.btcCampaignData)||void 0===i?void 0:i.utmParams));const x=(0,L.B)(this._helperSvc.compactInputData({adult:a,child:s,infant:g,isDirectFlight:v,promotion:[],promotionGroupFilters:f,type:p+"",journey:c,agentPromotion:null}));window.parent.postMessage({action:"redirect",url:"DEV"===this.appConfig.env?`/search-dev.html?${x}`:`/search.html?${x}`},"*")}}return h.\u0275fac=function(n){return new(n||h)(e.Y36(o.KNP),e.Y36(E.J),e.Y36(Z.qu),e.Y36(N._),e.Y36(w.Xj),e.Y36(G.L),e.Y36(e.sBO),e.Y36(Q.x),e.Y36(H.x),e.Y36(I.qB),e.Y36(R.rL))},h.\u0275cmp=e.Xpm({type:h,selectors:[["btc-search"]],viewQuery:function(n,t){if(1&n&&(e.Gf(U,5),e.Gf(W,5)),2&n){let i;e.iGM(i=e.CRH())&&(t.containerEl=i.first),e.iGM(i=e.CRH())&&(t.searchInputCpn=i.first)}},standalone:!0,features:[e.jDz],decls:26,vars:14,consts:[[1,"w-full","bg-transparent"],["containerEl",""],[1,"bg-neutral-white","p-6","rounded-lg","w-full","shadow-cf-md","md:p-4","max-w-[1440px]","mx-auto","pointer-events-auto"],[1,"flex","items-center","justify-between","mb-5"],[1,"md:w-full"],[3,"flightType","typeSearchChange"],[1,"flex","items-center","justify-end","gap-x-4","md:hidden"],[3,"adultNumber","childNumber","infantNumber","numberOfPassengerChange"],[3,"airlineList","airlineFilterChange"],[3,"isShowTooltipFirstTime","promotionGroupList"],[3,"cabinList","actived","cabinChange"],[3,"paxTypeList","actived","paxTypeChange"],[1,"mb-[20px]","md:mb-4"],[3,"formArray","type","removeRoute","dataChange","dateTypeChange"],["searchInputCpn",""],["class","gap-2 hidden md:flex overflow-x-auto md:flex-wrap items-center",4,"ngIf"],[1,"h-0","border-b","border-b-neutral-gray-2","my-4","hidden","md:block"],[1,"flex","justify-between","items-center","md:flex-col","md:items-start","md:gap-y-4"],[1,"flex","justify-start","gap-x-[34px]"],[1,"flex","items-center","gap-3","whitespace-nowrap"],["size","medium",3,"checkChange"],[1,"flex","justify-end","gap-x-2","w-full"],["cf-button","","size","medium","color","primary-1","type","solid",1,"md:justify-center",3,"click"],["icon","search","size","small",1,"mr-2.5"],[1,"gap-2","hidden","md:flex","overflow-x-auto","md:flex-wrap","items-center"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0,1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"btc-type-search",5),e.NdJ("typeSearchChange",function(a){return t.flightTypeChange(a)}),e.qZA()(),e.TgZ(6,"div",6)(7,"btc-num-of-pas",7),e.NdJ("numberOfPassengerChange",function(a){return t.numberOfPassengerChange(a)}),e.qZA(),e.TgZ(8,"btc-airline-filter",8),e.NdJ("airlineFilterChange",function(a){return t.airlineFilterChange(a)}),e.qZA(),e._UZ(9,"btc-voucher-selector",9),e.TgZ(10,"btc-cabin-selector",10),e.NdJ("cabinChange",function(a){return!t.isMobile&&t.cabinChange(a)}),e.qZA(),e.TgZ(11,"btc-pax-type-selector",11),e.NdJ("paxTypeChange",function(a){return!t.isMobile&&t.paxTypeChange(a)}),e.qZA()()(),e.TgZ(12,"div",12)(13,"btc-search-input",13,14),e.NdJ("removeRoute",function(a){return t.removeRoute(a)})("dataChange",function(){return t.searchInputChange()})("dateTypeChange",function(a){return t.onDateTypeChange(a)}),e.qZA()(),e.YNc(15,K,6,10,"div",15),e._UZ(16,"div",16),e.TgZ(17,"div",17)(18,"div",18)(19,"div",19)(20,"cf-checkbox",20),e.NdJ("checkChange",function(a){return t.onCheckDirectFlight(a)}),e._uU(21," Ch\u1ec9 c\xe1c chuy\u1ebfn bay th\u1eb3ng "),e.qZA()()(),e.TgZ(22,"div",21)(23,"button",22),e.NdJ("click",function(){return t.searchFlight()}),e._UZ(24,"cf-icon",23),e._uU(25," T\xecm chuy\u1ebfn bay "),e.qZA()()()()()),2&n&&(e.xp6(5),e.Q6J("flightType",t.dataSearch.type),e.xp6(2),e.Q6J("adultNumber",t.dataSearch.adultCount)("childNumber",t.dataSearch.childCount)("infantNumber",t.dataSearch.infantCount),e.xp6(1),e.Q6J("airlineList",t.airlineFilters),e.xp6(1),e.Q6J("isShowTooltipFirstTime",!0)("promotionGroupList",t.dataSearch.promotionGroupFilters),e.xp6(1),e.Q6J("cabinList",t.cabinList)("actived",t.isAirLineInternational),e.xp6(1),e.Q6J("paxTypeList",t.paxTypeList)("actived",t.isAirLineInternational),e.xp6(2),e.Q6J("formArray",t.journeyFormArr)("type",t.dataSearch.type||0),e.xp6(2),e.Q6J("ngIf",t.isMobile))},dependencies:[_.ez,_.O5,A.x,O.w,M.l,D.d,B._,j.T,P.W,F.u,S.N8,S.Xq,o.AxE,o.Sm8],styles:["[_nghost-%COMP%]{display:block}"]}),h})()}}]);