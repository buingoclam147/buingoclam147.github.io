"use strict";(self.webpackChunkcheapflightclient=self.webpackChunkcheapflightclient||[]).push([[2678],{42678:(ye,oe,u)=>{u.d(oe,{yL:()=>K,u1:()=>de,I5:()=>E,FH:()=>ue});var Z=u(80529),z=u(44500),R=u(54004),E=(()=>{return(a=E||(E={})).JOURNEY="JOURNEY",a.PASSENGER="PASSENGER",a.CONFIGURATION="CONFIGURATION",E;var a})(),t=u(97582),W=u(97380),i=u(87067),A=u(43429);class S{}(0,t.gn)([(0,i.C)()],S.prototype,"status",void 0),(0,t.gn)([(0,A.D)(()=>ae),(0,i.C)()],S.prototype,"data",void 0),(0,t.gn)([(0,i.C)()],S.prototype,"objectError",void 0),(0,t.gn)([(0,i.C)()],S.prototype,"success",void 0);class ae extends W.VP{}class G{}(0,t.gn)([(0,i.C)()],G.prototype,"airline",void 0),(0,t.gn)([(0,i.C)()],G.prototype,"flightType",void 0),(0,t.gn)([(0,A.D)(()=>f),(0,i.C)()],G.prototype,"journeys",void 0),(0,t.gn)([(0,A.D)(()=>c),(0,i.C)()],G.prototype,"passengers",void 0);class f{}(0,t.gn)([(0,i.C)()],f.prototype,"leg",void 0),(0,t.gn)([(0,i.C)()],f.prototype,"startPoint",void 0),(0,t.gn)([(0,i.C)()],f.prototype,"endPoint",void 0),(0,t.gn)([(0,i.C)()],f.prototype,"departTime",void 0),(0,t.gn)([(0,i.C)()],f.prototype,"arrivalTime",void 0),(0,t.gn)([(0,i.C)()],f.prototype,"duration",void 0),(0,t.gn)([(0,i.C)()],f.prototype,"segments",void 0),(0,t.gn)([(0,i.C)()],f.prototype,"rangeTime",void 0);class c{}(0,t.gn)([(0,i.C)()],c.prototype,"birthday",void 0),(0,t.gn)([(0,i.C)()],c.prototype,"firstName",void 0),(0,t.gn)([(0,i.C)()],c.prototype,"lastName",void 0),(0,t.gn)([(0,i.C)()],c.prototype,"type",void 0),(0,t.gn)([(0,i.C)()],c.prototype,"key",void 0),(0,t.gn)([(0,i.C)()],c.prototype,"parentKey",void 0),(0,t.gn)([(0,i.C)()],c.prototype,"namePrefix",void 0),(0,t.gn)([(0,i.C)()],c.prototype,"gender",void 0),(0,t.gn)([(0,i.C)()],c.prototype,"index",void 0);class b{}(0,t.gn)([(0,i.C)()],b.prototype,"timeCreate",void 0),(0,t.gn)([(0,i.C)()],b.prototype,"timeExpire",void 0),(0,t.gn)([(0,i.C)()],b.prototype,"timeUpdate",void 0),(0,t.gn)([(0,i.C)()],b.prototype,"timeFinished",void 0),(0,t.gn)([(0,A.D)(()=>k),(0,i.C)()],b.prototype,"fareMonitors",void 0),(0,t.gn)([(0,i.C)()],b.prototype,"notifyBeforeExpired",void 0),(0,t.gn)([(0,i.C)()],b.prototype,"targetPrice",void 0);class k{}(0,t.gn)([(0,i.C)()],k.prototype,"onlyCareLowerFare",void 0),(0,t.gn)([(0,i.C)()],k.prototype,"expectLowerFareClass",void 0),(0,t.gn)([(0,i.C)()],k.prototype,"specifyFareClass",void 0),(0,t.gn)([(0,i.C)()],k.prototype,"currentFareClass",void 0),(0,t.gn)([(0,i.C)()],k.prototype,"specifyFareClassInfo",void 0);class C{}(0,t.gn)([(0,i.C)()],C.prototype,"airline",void 0),(0,t.gn)([(0,i.C)()],C.prototype,"originalPnr",void 0),(0,t.gn)([(0,i.C)()],C.prototype,"detectedPnr",void 0),(0,t.gn)([(0,i.C)()],C.prototype,"originalFare",void 0),(0,t.gn)([(0,i.C)()],C.prototype,"detectedFare",void 0),(0,t.gn)([(0,i.C)()],C.prototype,"originalFareClass",void 0),(0,t.gn)([(0,i.C)()],C.prototype,"detectedFareClass",void 0),(0,t.gn)([(0,i.C)()],C.prototype,"higherFare",void 0),(0,t.gn)([(0,i.C)()],C.prototype,"lastTimeUpdate",void 0);class O{}(0,t.gn)([(0,i.C)()],O.prototype,"status",void 0),(0,t.gn)([(0,A.D)(()=>P),(0,i.C)()],O.prototype,"data",void 0),(0,t.gn)([(0,i.C)()],O.prototype,"objectError",void 0),(0,t.gn)([(0,i.C)()],O.prototype,"success",void 0);class P{}(0,t.gn)([(0,i.C)()],P.prototype,"orderId",void 0),(0,t.gn)([(0,i.C)()],P.prototype,"canUpdate",void 0),(0,t.gn)([(0,i.C)()],P.prototype,"code",void 0),(0,t.gn)([(0,i.C)()],P.prototype,"huntFareConditions",void 0),(0,t.gn)([(0,i.C)()],P.prototype,"advanceSetting",void 0),(0,t.gn)([(0,i.C)()],P.prototype,"ticketInfo",void 0),(0,t.gn)([(0,A.D)(()=>W.v_),(0,i.C)()],P.prototype,"availableSlotInfo",void 0);var B=u(50494),y=u(94650);const N={headers:new Z.WM({"Content-Type":"application/json"})};let K=(()=>{class a{constructor(e,s){this.http=e,this.appConfig=s}getLstAirlineFareoptions(){return this.http.post(this.appConfig.apiUrlTPS+"ticket-low-fare/get-list-airline-fare-class",JSON.stringify({airline:"vn,qh,vj"}),N)}registerHuntBooking(e){return this.http.post(this.appConfig.apiUrlTPS+"hunt_for_ticket/register-order",JSON.stringify(e),N)}getPnrOrderDetail(e){return this.http.get(this.appConfig.apiUrlTPS+"hunt_for_ticket/pnr-order_detail/"+e,N).pipe((0,R.U)(s=>(0,B.yE)(S,s,{excludeExtraneousValues:!0})))}getCurrentConfigOrder(e){return this.http.post(this.appConfig.apiUrlTPS+"hunt_for_ticket/current-config-order",JSON.stringify({orderId:e}),N).pipe((0,R.U)(s=>(0,B.yE)(O,s,{excludeExtraneousValues:!0})))}updateConfigOrder(e){return this.http.post(this.appConfig.apiUrlTPS+"hunt_for_ticket/update_order_config",JSON.stringify(e),N).pipe((0,R.U)(s=>(0,B.yE)(S,s,{excludeExtraneousValues:!0})))}}return a.\u0275fac=function(e){return new(e||a)(y.LFG(Z.eN),y.LFG(z.qB))},a.\u0275prov=y.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var n=u(24006),x=u(57085),se=u(77579),X=u(35650),H=u(43201),h=u(15439);const _=a=>{const m=a.get("targetVNPrice"),e=a.get("targetVJPrice"),s=a.get("targetQHPrice"),l=a.get("fareOptions"),d=a.get("enableTimeStart"),p=a.get("enableFareOption"),F=a.get("enablePriceOption"),v=a.get("startTimeRange");let g={};return null!=d&&d.value&&(null!=v&&v.value&&(null==v?void 0:v.value.length)>0||(g.invalidTimeRanges=!0)),null!=p&&p.value&&(null!=l&&l.value&&(null==l?void 0:l.value.length)>0||(g.invalidFares=!0)),null!=F&&F.value&&(null!=m&&m.value||null!=e&&e.value||null!=s&&s.value?((null==m?void 0:m.value)<0||(null==e?void 0:e.value)<0||(null==s?void 0:s.value)<0)&&(g.negativePrice=!0):g.invalidPrice=!0),!d&&!F&&(g.invalidPriceFareOption=!0),Object.values(g),Object.values(g).length>0?g:null};var ee=u(82761),le=u(40899);let ue=(()=>{class a{constructor(e,s,l,d,p){this.route=e,this._route=s,this.fb=l,this._permissionService=d,this._bookingHunterService=p,this.optionsAdultPassenger=[],this.numberOfPassenger={adult:1,child:0,infant:0},this.phoneAreaDefault=z.$T,this.hasVJAirline=!1,this.showPriceOption=!1,this.showTimeStartOption=!1,this.showFareOption=!0,this.numberOfPassengerChange$=new se.x,this.isBooker=!this._permissionService.isVNAccount(),this.optionDepartureTime=[{name:"S\xe1ng s\u1edbm",code:"early_morning",start:"00:00",end:"05:59",isActive:!1,disable:!1,startTime:0,endTime:360,totalAvailable:0},{name:"Bu\u1ed5i s\xe1ng",code:"morning",start:"06:00",end:"11:59",isActive:!1,disable:!1,startTime:360,endTime:720,totalAvailable:0},{name:"Bu\u1ed5i chi\u1ec1u",code:"afternoon",start:"12:00",end:"17:59",isActive:!1,disable:!1,startTime:720,endTime:1080,totalAvailable:0},{name:"Bu\u1ed5i t\u1ed1i",code:"evening",start:"18:00",end:"23:59",isActive:!1,disable:!1,startTime:1080,endTime:1439,totalAvailable:0},{name:"T\xf9y ch\u1ecdn",code:"custom",start:"00:00",end:"23:59",isActive:!1,disable:!1,startTime:0,endTime:1439,totalAvailable:0}],this.customRangeItem={rangeValues:[0,1439],startTimeStr:"00:00",endTimeStr:"23:59"},this.departureTime=h().toDate().getTime(),this.earliestDoBChild=(0,H.Z)(this.departureTime,-2),this.earliestDoBChild=(0,X.Z)(this.earliestDoBChild,-1),this.earliestDoBInfant=h().toDate(),this.lastestDoBChild=(0,H.Z)(this.departureTime,-11),this.lastestDoBInfant=(0,H.Z)(this.departureTime,-2),this.lastestDoBInfant=(0,X.Z)(this.lastestDoBInfant,1)}initForm(){this.resetDataService(),this.initJourneyForm(),this.initConfigurationForm(),this.initPassengerForm()}preloadForm(e){var s,l,d,p,F,v,g,U,L,q,J,j,M,$,w,Q;const I=e.ticketInfo.journeys[0],V="PRICE"===e.huntFareConditions.type;this.showPriceOption=V,this.showFareOption=!V;const pe=(null===(l=null===(s=e.huntFareConditions.specifyPriceList)||void 0===s?void 0:s.find(r=>"VN"===r.airline.toUpperCase()))||void 0===l?void 0:l.targetPrice)||0,ge=(null===(p=null===(d=e.huntFareConditions.specifyPriceList)||void 0===d?void 0:d.find(r=>"QH"===r.airline.toUpperCase()))||void 0===p?void 0:p.targetPrice)||0,he=(null===(v=null===(F=e.huntFareConditions.specifyPriceList)||void 0===F?void 0:F.find(r=>"VJ"===r.airline.toUpperCase()))||void 0===v?void 0:v.targetPrice)||0;let te=!0;if(I.rangeTime.forEach(r=>{this.optionDepartureTime.forEach(o=>{o.start===r.fromDate&&o.end===r.toDate&&(o.isActive=!0,te=!1)})}),te&&I.rangeTime[0]){const r=I.rangeTime[0],o=this.convertTimeRangeStrToMin(r.fromDate),ne=this.convertTimeRangeStrToMin(r.toDate);this.customRangeItem={rangeValues:[o,ne],startTimeStr:r.fromDate,endTimeStr:r.toDate},this.optionDepartureTime[4].isActive=!0,this.optionDepartureTime[4].start=r.fromDate,this.optionDepartureTime[4].end=r.toDate,this.optionDepartureTime[4].startTime=o,this.optionDepartureTime[4].endTime=ne}const Y=this.optionDepartureTime.filter(r=>r.isActive),ie=Y&&Y.length>0;this.showTimeStartOption=ie;const ve=(null!==(g=h(I.departTime))&&void 0!==g&&g.isBefore(h())?null:h(I.departTime).toDate())||null;this.journeyFormGroup=this.fb.group({startPoint:[I.startPoint,[n.kI.required]],endPoint:[I.endPoint,[n.kI.required]],departDate:[ve,[n.kI.required]],startTimeRange:[Y],enablePriceOption:[V],targetVNPrice:[pe],targetVJPrice:[ge],targetQHPrice:[he],enableFareOption:[!V],enableTimeStart:[ie],fareOptions:[e.huntFareConditions.specifyFareClassList]},{validators:_});const re=h(e.advanceSetting.timeExecute).isAfter(h().toDate()),T=re?h(e.advanceSetting.timeExecute).toDate():null,ce=re&&T?`${null==T?void 0:T.getHours().toString().padStart(2,"0")}:${null==T?void 0:T.getMinutes().toString().padStart(2,"0")}`:null;this.configurationFormGroup=this.fb.group({dateExpires:[T,[n.kI.required]],timeExpires:[ce,[n.kI.required]],sendNotify:[e.advanceSetting.notifBeforExpire,[n.kI.required]],agentDisplayName:[null],agentAvatar:[null],agentName:[null],agentPhone:[null,[n.kI.required,n.kI.minLength(7),n.kI.maxLength(11)]],agentPhoneArea:[this.phoneAreaDefault,n.kI.required],agentEmail:[null],agentId:[null,[n.kI.required]]}),this.numberOfPassenger={adult:(null===(L=null===(U=e.ticketInfo.passengers)||void 0===U?void 0:U.filter(r=>{var o;return"ADT"===(null===(o=r.type)||void 0===o?void 0:o.toUpperCase())}))||void 0===L?void 0:L.length)||0,child:(null===(J=null===(q=e.ticketInfo.passengers)||void 0===q?void 0:q.filter(r=>{var o;return"CHD"===(null===(o=r.type)||void 0===o?void 0:o.toUpperCase())}))||void 0===J?void 0:J.length)||0,infant:(null===(M=null===(j=e.ticketInfo.passengers)||void 0===j?void 0:j.filter(r=>{var o;return"INF"===(null===(o=r.type)||void 0===o?void 0:o.toUpperCase())}))||void 0===M?void 0:M.length)||0},this.passengerFormGroup=this.fb.group({adultPassenger:this.fb.array([]),childPassenger:this.fb.array([]),infantPassenger:this.fb.array([])},{validator:(0,x.aV)()});const me=(null===($=e.ticketInfo.passengers)||void 0===$?void 0:$.filter(r=>{var o;return"ADT"===(null===(o=r.type)||void 0===o?void 0:o.toUpperCase())}).map(r=>{var o;return{firstName:r.firstName,lastName:r.lastName,gender:(null===(o=r.gender)||void 0===o?void 0:o.toLowerCase())||"male"}}))||[],fe=(null===(w=e.ticketInfo.passengers)||void 0===w?void 0:w.filter(r=>{var o;return"CHD"===(null===(o=r.type)||void 0===o?void 0:o.toUpperCase())}).map(r=>{var o;return{firstName:r.firstName,lastName:r.lastName,gender:(null===(o=r.gender)||void 0===o?void 0:o.toLowerCase())||"male",birthday:h(r.birthday).toDate()}}))||[],Ce=(null===(Q=e.ticketInfo.passengers)||void 0===Q?void 0:Q.filter(r=>{var o;return"INF"===(null===(o=r.type)||void 0===o?void 0:o.toUpperCase())}).map(r=>{var o;return{firstName:r.firstName,lastName:r.lastName,gender:(null===(o=r.gender)||void 0===o?void 0:o.toLowerCase())||"male",birthday:h(r.birthday).toDate(),parentIndex:r.parentIndex+""}}))||[];this.initPassengerForm(),this.initAdultFormGroup(),this.initChildFormGroup(),this.initInfantFormGroup(),this.passengerFormGroup.patchValue({adultPassenger:me,childPassenger:fe,infantPassenger:Ce}),this.preInitialFormOrderId=void 0}reloadPassengerForm(){const e=this.passengerFormGroup.value;this.initPassengerForm(),this.initAdultFormGroup(),this.initChildFormGroup(),this.initInfantFormGroup(),this.passengerFormGroup.patchValue(Object.assign({},e))}initJourneyForm(){this.journeyFormGroup=this.fb.group({startPoint:["",[n.kI.required]],endPoint:["",[n.kI.required]],departDate:[null,[n.kI.required]],startTimeRange:[null],enablePriceOption:[!1],targetVNPrice:[0],targetVJPrice:[0],targetQHPrice:[0],enableFareOption:[!0],enableTimeStart:[!1],fareOptions:[null]},{validators:_})}initConfigurationForm(){this.configurationFormGroup=this.fb.group({dateExpires:[null,[n.kI.required]],timeExpires:[null,[n.kI.required]],sendNotify:[!1,[n.kI.required]],agentDisplayName:[null],agentAvatar:[null],agentName:[null],agentPhone:[null,[n.kI.required,n.kI.minLength(7),n.kI.maxLength(11)]],agentPhoneArea:[this.phoneAreaDefault,n.kI.required],agentEmail:[null],agentId:[null,[n.kI.required]]})}initPassengerForm(){this.passengerFormGroup=this.fb.group({secretRemark:[null],publicRemark:[null],adultPassenger:this.fb.array([]),childPassenger:this.fb.array([]),infantPassenger:this.fb.array([])},{validator:(0,x.aV)()})}initAdultFormGroup(){for(let e=0;e<this.numberOfPassenger.adult;e++){const s=this.fb.group({firstName:[null,[n.kI.required]],lastName:[null,[n.kI.required]],gender:["male",[n.kI.required]],membershipQH:[null],membershipVN:[null]});this.getFormArray("adultPassenger").push(s)}}initChildFormGroup(){for(let e=0;e<this.numberOfPassenger.child;e++){const s=this.fb.group({birthday:[null,[n.kI.required]],firstName:[null,[n.kI.required]],lastName:[null,[n.kI.required]],gender:["male",[n.kI.required]],membershipQH:[null],membershipVN:[null]},{validator:(0,x.$K)("birthday",this.departureTime)});this.getFormArray("childPassenger").push(s)}}initInfantFormGroup(){for(let e=0;e<this.numberOfPassenger.infant;e++){const s=this.fb.group({birthday:[null,[n.kI.required]],firstName:[null,[n.kI.required]],lastName:[null,[n.kI.required]],gender:["male",[n.kI.required]],parentIndex:[e+"",[n.kI.required]],membershipQH:[null],membershipVN:[null]},{validator:(0,x.DW)("birthday",this.departureTime)});this.getFormArray("infantPassenger").push(s)}}getNumberOfPassenger(){this.initAdultPassengerOptions()}getFormArray(e){return this.passengerFormGroup.controls[e]}getFormControlInArray(e,s){return e.controls[s]}initAdultPassengerOptions(){for(let e=0;e<this.numberOfPassenger.adult;e++)this.optionsAdultPassenger.push({code:e+"",name:`Ng\u01b0\u1eddi l\u1edbn ${e+1}`})}changeNumberOfPassenger(e){this.numberOfPassenger=e,this.numberOfPassengerChange$.next(e)}numOfPax(){return this.numberOfPassenger}formJourneyData(){return this.journeyFormGroup.value}formPassengerData(){return this.passengerFormGroup.value}formConfigurationData(){return this.configurationFormGroup.value}resetDataService(){this.customRangeItem={rangeValues:[0,1439],startTimeStr:"00:00",endTimeStr:"23:59"},this.showPriceOption=!1,this.showTimeStartOption=!1,this.showFareOption=!0,this.selectedFaresTree=[],this.optionDepartureTime=[{name:"S\xe1ng s\u1edbm",code:"early_morning",start:"00:00",end:"05:59",isActive:!1,disable:!1,startTime:0,endTime:360,totalAvailable:0},{name:"Bu\u1ed5i s\xe1ng",code:"morning",start:"06:00",end:"11:59",isActive:!1,disable:!1,startTime:360,endTime:720,totalAvailable:0},{name:"Bu\u1ed5i chi\u1ec1u",code:"afternoon",start:"12:00",end:"17:59",isActive:!1,disable:!1,startTime:720,endTime:1080,totalAvailable:0},{name:"Bu\u1ed5i t\u1ed1i",code:"evening",start:"18:00",end:"23:59",isActive:!1,disable:!1,startTime:1080,endTime:1439,totalAvailable:0},{name:"T\xf9y ch\u1ecdn",code:"custom",start:"00:00",end:"23:59",isActive:!1,disable:!1,startTime:0,endTime:1439,totalAvailable:0}]}isAgent2Show(){const e=this._permissionService.getCurrentAuthor();return"AGENT2"===(null==e?void 0:e.titleCode.toUpperCase())}getSourceEvent(){switch(this.sourceEvent){case"SEARCH_INPUT":return 0;case"SEARCH_RESULT":return 1;case"HEADER_MANAGE":return 2;case"EMPTY_STATE":return 3;case"REGENERATE":return 4;default:return-1}}convertTimeRangeStrToMin(e){return h.duration(e).asMinutes()}minuteToString(e){const s=Math.floor(e/60),l=e%60;let d=`${s}`,p=`${l}`;return s<10&&(d=`0${s}`),l<10&&(p=`0${l}`),`${d}:${p}`}checkVJAirline(){var e;const s=null===(e=this.selectedFaresTree)||void 0===e?void 0:e.filter(l=>l.isActive).map(l=>l.code.toUpperCase());this.journeyFormGroup.value.enableFareOption&&s.includes("VJ")||this.journeyFormGroup.value.enablePriceOption&&this.journeyFormGroup.value.targetVJPrice?(this.hasVJAirline=!0,this.configurationFormGroup.controls.agentPhone.setValidators([n.kI.required,n.kI.minLength(7),n.kI.maxLength(11)]),this.configurationFormGroup.controls.agentPhoneArea.setValidators([n.kI.required])):(this.hasVJAirline=!1,this.configurationFormGroup.controls.agentPhone.setValidators(null),this.configurationFormGroup.controls.agentPhoneArea.setValidators(null))}}return a.\u0275fac=function(e){return new(e||a)(y.LFG(ee.gz),y.LFG(ee.F0),y.LFG(n.qu),y.LFG(le.$A),y.LFG(K))},a.\u0275prov=y.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var D=u(53820);const de={[D.b.CREATE]:{name:"\u0110ang s\u0103n v\xe9",description:"S\u0103n v\xe9 t\u1ef1 \u0111\u1ed9ng \u0111ang ho\u1ea1t \u0111\u1ed9ng",icon:"search",backgroundColor:"bg-[#FFEAB9]",textColor:"text-secondary-7-5"},[D.b.IN_PROCESS]:{name:"\u0110ang canh v\xe9",description:"Canh v\xe9 r\u1ebb t\u1ef1 \u0111\u1ed9ng \u0111ang ho\u1ea1t \u0111\u1ed9ng",icon:"search",backgroundColor:"bg-[#FFEAB9]",textColor:"text-secondary-7-5"},[D.b.COMPLETED]:{name:"\u0110\xe3 s\u0103n th\xe0nh c\xf4ng",description:"\u0110\xe3 s\u0103n \u0111\u01b0\u1ee3c v\xe9",icon:"check",backgroundColor:"bg-[#07A35D]",textColor:"text-neutral-white"},[D.b.IN_PROCESS_PRICE_UP]:{name:"\u0110ang s\u0103n gi\xe1 t\u0103ng",description:"Gi\xe1 v\xe9 \u0111\xe3 t\u0103ng, vui l\xf2ng c\xe2n nh\u1eafc xu\u1ea5t v\xe9",icon:"arrow_right_up",backgroundColor:"bg-[#ffd1bc]",textColor:"text-primary-1-4"},[D.b.CANCEL]:{name:"\u0110\xe3 h\u1ee7y",description:"\u0110\xe3 h\u1ee7y y\xeau c\u1ea7u s\u0103n v\xe9",icon:"coupon_slash",backgroundColor:"bg-[#999999]",textColor:"text-neutral-white"},[D.b.EXPIRED]:{name:"\u0110\xe3 h\u1ebft s\u0103n",description:"H\u1ebft h\u1ea1n s\u0103n v\xe9",icon:"clock",backgroundColor:"bg-[#CCCCCC]",textColor:"text-neutral-gray-6"}}}}]);