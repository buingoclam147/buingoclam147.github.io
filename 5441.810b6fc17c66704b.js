"use strict";(self.webpackChunkcheapflightclient=self.webpackChunkcheapflightclient||[]).push([[5441],{65441:(x,b,c)=>{c.r(b),c.d(b,{MobileSearchInputComponent:()=>U,SearchFlightPageComponent:()=>A});var d=c(40899),v=c(36895),m=c(24006),F=c(82761),f=c(83700),S=c(27898),h=c(72506),o=c(27361),u=c(88001),_=c(15439),e=c(94650),I=c(17997),M=c(85114),y=c(53041),D=c(42678);function P(s,g){if(1&s){const t=e.EpF();e.TgZ(0,"div",26)(1,"div",27),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.addMultiRoute())}),e._UZ(2,"cf-icon",28),e.TgZ(3,"div",29),e._uU(4,"Th\xeam ch\u1eb7ng m\u1edbi"),e.qZA()(),e.TgZ(5,"div",30),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.removeAllDataMultiRoute())}),e._UZ(6,"cf-icon",31),e.TgZ(7,"div",32),e._uU(8,"X\xf3a t\u1ea5t c\u1ea3"),e.qZA()()()}}function O(s,g){if(1&s){const t=e.EpF();e.TgZ(0,"button",33),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onRegisterBookingHunter())}),e._UZ(1,"cf-icon",34),e.TgZ(2,"span"),e._uU(3,"S\u0103n v\xe9"),e.qZA()()}}let A=(()=>{class s{constructor(t,i,n,a,r,p,l){this.cfIconRegister=t,this._searchMinFareDataProvider=i,this._router=n,this._searchInputService=a,this._searchFlightService=r,this._permissionService=p,this._requestDataService=l,this.flightTypeSearch=o.jX.OneWay,this.multiFilghtType=o.jX.MultiWay,this.huntBookingFlag=this._permissionService.hasPermission(d.or.CanMonitorHuntFareTicket),this.searchMinFaresResult=[],this.listDateSearchMinFares=[],this.initIcon(),this.initMinFareOption(),this.initDateSearchMinFare(),this.resetForm(),a.flightType="ONE_WAY"}initIcon(){this.cfIconRegister.registerIcons([h.bHT,h.D5L,h.TM4,h.gll,h.TOh,h.KYu,h.tLH,h.IIV,h._hx,h.YwC])}initMinFareOption(){this.minFareOptionConfig={minPrice:new Map,airlineMinPrice:[{airline:u.QK.VJ,airlineName:"Vietjet Air",color:"#E03C31",selected:!0},{airline:u.QK.VN,airlineName:"Vietnam Airlines",color:"#2E5EAA",selected:!0}],isRangeMinFare:!1,showMinPrice:!0,showLunarDate:!0}}initDateSearchMinFare(t=new Date){const i=_(t).format("YYYY-MM-DD"),n=_(t).add(1,"month").startOf("month").format("YYYY-MM-DD");this.listDateSearchMinFares.push(i),this.listDateSearchMinFares.push(n)}resetForm(){this._searchInputService.reset()}numberOfPassengerChange(t){this._searchInputService.numberOfPassengerChange(t),this._searchInputService.suggestPromotion()}airlineFilterChange(t){this._searchInputService.airlineFilterChange(t)}cabinChange(t){this._searchInputService.cabinChange(t)}paxTypeChange(t){this._searchInputService.paxTypeChange(t)}addMultiRoute(){this._searchInputService.addMultiRoute()}removeRoute(t){this._searchInputService.removeRoute(t)}removeAllDataMultiRoute(){this._searchInputService.removeAllDataMultiRoute()}flightTypeChange(t){switch(this.flightTypeSearch=t,t){case o.jX.OneWay:this._searchInputService.flightTypeChange("ONE_WAY"),this.minFareOptionConfig=Object.assign(Object.assign({},this.minFareOptionConfig),{isRangeMinFare:!1});break;case o.jX.RoundTrip:this._searchInputService.flightTypeChange("ROUND_TRIP"),this.minFareOptionConfig=Object.assign(Object.assign({},this.minFareOptionConfig),{isRangeMinFare:!0});break;case o.jX.MultiWay:this._searchInputService.flightTypeChange("MULTI_WAY")}}searchFlight(){let t;t=this.flightTypeSearch===o.jX.OneWay?"ONE_WAY":this.flightTypeSearch===o.jX.RoundTrip?"ROUND_TRIP":"MULTI_WAY",this._searchInputService.prepareRequestFlight(t)&&(this._searchMinFareDataProvider.searchMinFareData=this.searchMinFaresResult,this._router.navigate(["/admin/search-flight-result"]))}searchInputChange(){this.suggestPromotion(),this._searchInputService.checkInternationalFlight(),this.searchMinFaresApi(this.listDateSearchMinFares)}onDateTypeChange(t){"DEPART"===t&&this.mappingMinFares(0),"ARRIVE"===t&&this.mappingMinFares(1)}onNavigateDatepicker(t){const i=this.generateRangeDateSearchMinFare(t),n=[];i.forEach(a=>{this.listDateSearchMinFares.some(r=>r.includes(a))||(this.listDateSearchMinFares.push(a),n.push(a))}),n.length?this.searchMinFaresApi(n):this.minFareOptionConfig=Object.assign({},this.minFareOptionConfig)}generateRangeDateSearchMinFare(t){const i=_(new Date),n=_(t);let a=[];a.push(i.format("YYYY-MM-DD"));let r=i.clone().add(1,"month").startOf("month");for(;r.isBefore(n)||r.isSame(n,"month");)a.push(r.format("YYYY-MM-DD")),r.add(1,"month");return a}searchMinFaresApi(t){const i=this._searchInputService.getSearchInputData();if(i.startPoint&&i.endPoint){let n=[];this.flightTypeSearch===o.jX.OneWay&&(n=t.map(a=>({departDate:_(new Date(a)).format("YYYY-MM-DD"),endPoint:i.endPoint,leg:0,providers:`${u.QK.VJ},${u.QK.VN}`,startPoint:i.startPoint}))),this.flightTypeSearch===o.jX.RoundTrip&&(n=t.map(a=>({departDate:_(new Date(a)).format("YYYY-MM-DD"),endPoint:i.endPoint,leg:0,providers:`${u.QK.VJ},${u.QK.VN}`,startPoint:i.startPoint})),n.push(...t.map(a=>({departDate:_(new Date(a)).format("YYYY-MM-DD"),endPoint:i.startPoint,leg:1,providers:`${u.QK.VJ},${u.QK.VN}`,startPoint:i.endPoint})))),this._searchFlightService.searchMinFare(n).subscribe({next:a=>{"OK"===a.status&&(a.data.length?(a.data.forEach(r=>{const p=this.searchMinFaresResult.find(l=>l.leg===r.leg);p?Object.entries(r.data).forEach(l=>{p.data.set(l[0],l[1])}):this.searchMinFaresResult.push(Object.assign(Object.assign({},r),{data:new Map(Object.entries(r.data))}))}),this.mappingMinFares(n[0].leg)):this.minFareOptionConfig=Object.assign({},this.minFareOptionConfig))}})}}onToggleAirline(t){t&&this.mappingMinFares()}mappingMinFares(t=0){if(this.searchMinFaresCurrentLegResult=this.searchMinFaresResult.find(i=>i.leg===t),this.searchMinFaresCurrentLegResult){this.minFareOptionConfig.minPrice=new Map;const i=this.minFareOptionConfig.airlineMinPrice.filter(n=>n.selected).map(n=>n.airline);this.searchMinFaresCurrentLegResult.data.forEach((n,a)=>{const r=n.filter(C=>i.includes(C.key)),p=r.length?r.reduce((C,T)=>T.value<C.value?T:C):null,l=p?this.minFareOptionConfig.airlineMinPrice.find(C=>C.airline===p.key):null;this.minFareOptionConfig.minPrice.set(a,p?{price:Math.ceil(p.value/1e3),airline:(null==l?void 0:l.airline)||p.key,airlineName:(null==l?void 0:l.airlineName)||p.key,color:(null==l?void 0:l.color)||""}:null)}),this.minFareOptionConfig=Object.assign({},this.minFareOptionConfig)}}suggestPromotion(){this._searchInputService.suggestPromotion()}onCheckDirectFlight(t){this._searchInputService.checkDirectFlight(t)}onRegisterBookingHunter(){this._requestDataService.sourceEvent="SEARCH_INPUT",this._router.navigate(["admin/request-booking-hunter"],{state:{isEntryPointSearch:!1}})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(h.KNP),e.Y36(I.W),e.Y36(F.F0),e.Y36(M.v),e.Y36(y.t7),e.Y36(d.$A),e.Y36(D.FH))},s.\u0275cmp=e.Xpm({type:s,selectors:[["search-flight-page"]],hostAttrs:[1,"h-full"],standalone:!0,features:[e.jDz],decls:33,vars:25,consts:[[1,"relative","h-full"],["src","https://cheapflighttest.s3.ap-southeast-1.amazonaws.com/banner.png",1,"w-full","md:h-[218px]","md:object-cover","h-full"],[1,"absolute","top-0","left-0","w-full","pt-[53px]","px-[30px]","md:pt-5","md:px-4"],[1,"bg-neutral-white","p-6","rounded-lg","w-full","shadow-cf-md","md:p-4"],[1,"flex","items-center","justify-between","mb-5"],[1,"md:w-full"],[3,"flightType","flightTypeSearchChange"],[1,"flex","items-center","justify-end","gap-x-4","md:hidden"],[3,"adultNumber","childNumber","infantNumber","numberOfPassengerChange"],[3,"airlineList","airlineFilterChange"],[3,"isShowTooltipFirstTime","promotionGroupList"],[3,"cabinList","actived","cabinChange"],[3,"paxTypeList","actived","paxTypeChange"],[1,"mb-[20px]","md:mb-4"],[3,"formArray","minFareOptionConfig","removeRoute","dataChange","toggleAirline","navigateDatepicker","dateTypeChange"],[1,"gap-2","hidden","md:flex","overflow-x-auto","md:flex-wrap"],["class","flex items-center gap-x-10 mb-5",4,"ngIf"],[1,"h-0","border-b","border-b-neutral-gray-2","my-4","hidden","md:block"],[1,"flex","justify-between","items-center","md:flex-col","md:items-start","md:gap-y-4"],[1,"flex","justify-start","gap-x-[34px]"],[1,"flex","items-center","gap-3","whitespace-nowrap"],["size","medium",3,"checkChange"],[1,"flex","justify-end","gap-x-2","w-full"],["cf-button","","size","medium","type","solid","class","!bg-neutral-gray-5 flex gap-x-2 text-neutral-white hover:!opacity-80 hover:!bg-neutral-gray-5 active:!bg-neutral-gray-5 active:!opacity-100",3,"click",4,"ngIf"],["cf-button","","size","medium","color","primary-1","type","solid",1,"md:justify-center",3,"click"],["icon","search","size","small",1,"mr-2.5"],[1,"flex","items-center","gap-x-10","mb-5"],[1,"flex","items-center","text-secondary-1-5","cursor-pointer",3,"click"],["icon","plus","size","small",1,"mr-2.5"],[1,"text-heading-xs"],[1,"flex","items-center","text-neutral-black","cursor-pointer",3,"click"],["icon","rotate_left","size","small",1,"mr-2.5"],[1,"text-body-md"],["cf-button","","size","medium","type","solid",1,"!bg-neutral-gray-5","flex","gap-x-2","text-neutral-white","hover:!opacity-80","hover:!bg-neutral-gray-5","active:!bg-neutral-gray-5","active:!opacity-100",3,"click"],["icon","ticket","size","small",1,"mr-1.5"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"img",1),e.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"cf-flight-type-selector",6),e.NdJ("flightTypeSearchChange",function(a){return i.flightTypeChange(a)}),e.qZA()(),e.TgZ(7,"div",7)(8,"cf-number-of-passenger",8),e.NdJ("numberOfPassengerChange",function(a){return i.numberOfPassengerChange(a)}),e.qZA(),e.TgZ(9,"cf-airline-filter",9),e.NdJ("airlineFilterChange",function(a){return i.airlineFilterChange(a)}),e.qZA(),e._UZ(10,"cf-voucher-selector",10),e.TgZ(11,"cf-cabin-selector",11),e.NdJ("cabinChange",function(a){return i.cabinChange(a)}),e.qZA(),e.TgZ(12,"cf-pax-type-selector",12),e.NdJ("paxTypeChange",function(a){return i.paxTypeChange(a)}),e.qZA()()(),e.TgZ(13,"div",13)(14,"cf-search-flight-input",14),e.NdJ("removeRoute",function(a){return i.removeRoute(a)})("dataChange",function(){return i.searchInputChange()})("toggleAirline",function(a){return i.onToggleAirline(a)})("navigateDatepicker",function(a){return i.onNavigateDatepicker(a)})("dateTypeChange",function(a){return i.onDateTypeChange(a)}),e.qZA()(),e.TgZ(15,"div",15)(16,"cf-number-of-passenger",8),e.NdJ("numberOfPassengerChange",function(a){return i.numberOfPassengerChange(a)}),e.qZA(),e.TgZ(17,"cf-airline-filter",9),e.NdJ("airlineFilterChange",function(a){return i.airlineFilterChange(a)}),e.qZA(),e._UZ(18,"cf-voucher-selector",10),e.TgZ(19,"cf-cabin-selector",11),e.NdJ("cabinChange",function(a){return i.cabinChange(a)}),e.qZA(),e.TgZ(20,"cf-pax-type-selector",12),e.NdJ("paxTypeChange",function(a){return i.paxTypeChange(a)}),e.qZA()(),e.YNc(21,P,9,0,"div",16),e._UZ(22,"div",17),e.TgZ(23,"div",18)(24,"div",19)(25,"div",20)(26,"cf-checkbox",21),e.NdJ("checkChange",function(a){return i.onCheckDirectFlight(a)}),e._uU(27," Ch\u1ec9 c\xe1c chuy\u1ebfn bay th\u1eb3ng "),e.qZA()()(),e.TgZ(28,"div",22),e.YNc(29,O,4,0,"button",23),e.TgZ(30,"button",24),e.NdJ("click",function(){return i.searchFlight()}),e._UZ(31,"cf-icon",25),e._uU(32," T\xecm chuy\u1ebfn bay "),e.qZA()()()()()()),2&t&&(e.xp6(6),e.Q6J("flightType",i.flightTypeSearch),e.xp6(2),e.Q6J("adultNumber",i._searchInputService.numberOfPassenger.adult)("childNumber",i._searchInputService.numberOfPassenger.child)("infantNumber",i._searchInputService.numberOfPassenger.infant),e.xp6(1),e.Q6J("airlineList",i._searchInputService.airlineFilters),e.xp6(1),e.Q6J("isShowTooltipFirstTime",!0)("promotionGroupList",i._searchInputService.promotionGroupFilters),e.xp6(1),e.Q6J("cabinList",i._searchInputService.cabinList)("actived",i._searchInputService.hasAirportInternational),e.xp6(1),e.Q6J("paxTypeList",i._searchInputService.paxTypeList)("actived",i._searchInputService.hasAirportInternational),e.xp6(2),e.Q6J("formArray",i._searchInputService.searchInputForm)("minFareOptionConfig",i.minFareOptionConfig),e.xp6(2),e.Q6J("adultNumber",i._searchInputService.numberOfPassenger.adult)("childNumber",i._searchInputService.numberOfPassenger.child)("infantNumber",i._searchInputService.numberOfPassenger.infant),e.xp6(1),e.Q6J("airlineList",i._searchInputService.airlineFilters),e.xp6(1),e.Q6J("isShowTooltipFirstTime",!1)("promotionGroupList",i._searchInputService.promotionGroupFilters),e.xp6(1),e.Q6J("cabinList",i._searchInputService.cabinList)("actived",i._searchInputService.hasAirportInternational),e.xp6(1),e.Q6J("paxTypeList",i._searchInputService.paxTypeList)("actived",i._searchInputService.hasAirportInternational),e.xp6(1),e.Q6J("ngIf",i.flightTypeSearch===i.multiFilghtType),e.xp6(8),e.Q6J("ngIf",i.huntBookingFlag))},dependencies:[h.AxE,h.Sm8,f.N8,f.Xq,S.u,o.DA,o.z6,o.h4,o.uX,o.t3,m.u5,m.UX,F.Bz,v.O5,o.qB,o.P_],encapsulation:2}),s})();var Z=c(13138),N=c(28490),Y=c(37094);function R(s,g){1&s&&e._UZ(0,"cf-icon",15)}function w(s,g){1&s&&e._UZ(0,"cf-icon",16)}function J(s,g){if(1&s&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"date"),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Oqu(e.xi3(2,1,t.journeys[0].departDate,"dd/MM/yyyy"))}}function k(s,g){if(1&s&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.AsE("",e.xi3(2,2,t.journeys[0].departDate,"dd/MM/yyyy")," - ",e.xi3(3,5,t.journeys[1].departDate,"dd/MM/yyyy"),"")}}function j(s,g){1&s&&(e.TgZ(0,"div"),e._uU(1,"M\u1ed9t chi\u1ec1u"),e.qZA())}function E(s,g){1&s&&(e.TgZ(0,"div"),e._uU(1,"Kh\u1ee9 h\u1ed3i"),e.qZA())}function Q(s,g){if(1&s){const t=e.EpF();e.TgZ(0,"div",17),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.openQuotation())}),e._UZ(1,"cf-icon",18),e.TgZ(2,"div",19),e._uU(3," B\xe1o gi\xe1 "),e.qZA()()}}function L(s,g){if(1&s){const t=e.EpF();e.TgZ(0,"div",41)(1,"div",42),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.addMultiRoute())}),e._UZ(2,"cf-icon",43),e.TgZ(3,"div",44),e._uU(4,"Th\xeam ch\u1eb7ng m\u1edbi"),e.qZA()(),e.TgZ(5,"div",45),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.removeAllDataMultiRoute())}),e._UZ(6,"cf-icon",46),e.TgZ(7,"div",47),e._uU(8,"X\xf3a t\u1ea5t c\u1ea3"),e.qZA()()()}}function K(s,g){if(1&s){const t=e.EpF();e.TgZ(0,"div",20)(1,"div",21)(2,"div",22)(3,"cf-flight-type-selector",23),e.NdJ("flightTypeSearchChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.flightTypeChange(n))}),e.qZA()(),e.TgZ(4,"div",24)(5,"cf-number-of-passenger",25),e.NdJ("numberOfPassengerChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.numberOfPassengerChange(n))}),e.qZA(),e.TgZ(6,"cf-airline-filter",26),e.NdJ("airlineFilterChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.airlineFilterChange(n))}),e.qZA(),e._UZ(7,"cf-voucher-selector",27),e.TgZ(8,"cf-cabin-selector",28),e.NdJ("cabinChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.cabinChange(n))}),e.qZA(),e.TgZ(9,"cf-pax-type-selector",29),e.NdJ("paxTypeChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.paxTypeChange(n))}),e.qZA()()(),e.TgZ(10,"div",30)(11,"cf-search-flight-input",31),e.NdJ("removeRoute",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.removeRoute(n))})("dataChange",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.suggestPromotion())})("dataChange",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.searchInputChange())})("toggleAirline",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.onToggleAirline(n))})("navigateDatepicker",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.onNavigateDatepicker(n))}),e.qZA()(),e.TgZ(12,"div",32)(13,"cf-number-of-passenger",25),e.NdJ("numberOfPassengerChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.numberOfPassengerChange(n))}),e.qZA(),e.TgZ(14,"cf-airline-filter",26),e.NdJ("airlineFilterChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.airlineFilterChange(n))}),e.qZA(),e._UZ(15,"cf-voucher-selector",27),e.TgZ(16,"cf-cabin-selector",28),e.NdJ("cabinChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.cabinChange(n))}),e.qZA(),e.TgZ(17,"cf-pax-type-selector",29),e.NdJ("paxTypeChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.paxTypeChange(n))}),e.qZA()(),e.YNc(18,L,9,0,"div",33),e._UZ(19,"div",34),e.TgZ(20,"div",35)(21,"div",36)(22,"div",37)(23,"cf-checkbox",38),e.NdJ("checkChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.onCheckDirectFlight(n))}),e._uU(24," Ch\u1ec9 c\xe1c chuy\u1ebfn bay th\u1eb3ng "),e.qZA()()(),e.TgZ(25,"button",39),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.researchFlight())}),e._UZ(26,"cf-icon",40),e._uU(27," T\xecm chuy\u1ebfn bay "),e.qZA()()()}if(2&s){const t=e.oxw();e.xp6(3),e.Q6J("flightType",t.flightTypeSearch),e.xp6(2),e.Q6J("adultNumber",t._searchInputService.numberOfPassenger.adult)("childNumber",t._searchInputService.numberOfPassenger.child)("infantNumber",t._searchInputService.numberOfPassenger.infant),e.xp6(1),e.Q6J("airlineList",t._searchInputService.airlineFilters),e.xp6(1),e.Q6J("isShowTooltipFirstTime",!0)("promotionGroupList",t._searchInputService.promotionGroupFilters),e.xp6(1),e.Q6J("cabinList",t._searchInputService.cabinList)("actived",t._searchInputService.hasAirportInternational),e.xp6(1),e.Q6J("paxTypeList",t._searchInputService.paxTypeList)("actived",t._searchInputService.hasAirportInternational),e.xp6(2),e.Q6J("formArray",t._searchInputService.searchInputForm)("minFareOptionConfig",t.minFareOptionConfig),e.xp6(2),e.Q6J("adultNumber",t._searchInputService.numberOfPassenger.adult)("childNumber",t._searchInputService.numberOfPassenger.child)("infantNumber",t._searchInputService.numberOfPassenger.infant),e.xp6(1),e.Q6J("airlineList",t._searchInputService.airlineFilters),e.xp6(1),e.Q6J("isShowTooltipFirstTime",!1)("promotionGroupList",t._searchInputService.promotionGroupFilters),e.xp6(1),e.Q6J("cabinList",t._searchInputService.cabinList)("actived",t._searchInputService.hasAirportInternational),e.xp6(1),e.Q6J("paxTypeList",t._searchInputService.paxTypeList)("actived",t._searchInputService.hasAirportInternational),e.xp6(1),e.Q6J("ngIf",t.flightTypeSearch===t.multiFilghtType),e.xp6(5),e.Q6J("checked",t.isDirectFlight)}}let U=(()=>{class s{constructor(t,i,n,a,r,p,l){switch(this._searchInputService=t,this._searchFlightService=i,this._dataProvider=n,this._locationData=a,this._iconRegister=r,this._bottomSheetService=p,this._permissionService=l,this.showQuotation=this._permissionService.hasPermission(d.or.CreateFlightTicketQuote),this.showSharedFlight=this._permissionService.hasPermission(d.or.CanShareFlightSelected),this.flightTypeSearch=o.jX.OneWay,this.multiFilghtType=o.jX.MultiWay,this.onReseachFlight=new e.vpe,this.onFlightTypeChange=new e.vpe,this.onQuotation=new e.vpe,this.searchMinFaresResult=[],this.listDateSearchMinFares=[],this.loadJourneyInfo(),this.initMinFareOption(),this.initDateSearchMinFare(),this.searchMinFaresApi(this.listDateSearchMinFares),r.registerIcons([h.Ffn,h.PlV,h.Lxr]),t.flightType){case"ONE_WAY":default:this.flightTypeSearch=o.jX.OneWay,this.minFareOptionConfig=Object.assign(Object.assign({},this.minFareOptionConfig),{isRangeMinFare:!1});break;case"ROUND_TRIP":this.flightTypeSearch=o.jX.RoundTrip,this.minFareOptionConfig=Object.assign(Object.assign({},this.minFareOptionConfig),{isRangeMinFare:!0});break;case"MULTI_WAY":this.flightTypeSearch=o.jX.MultiWay}}ngOnInit(){this._searchInputService.selectedDateBar$.subscribe({next:t=>{t&&t.length&&this.journeys.forEach((i,n)=>{i.departDate=t[i.leg]})}})}initMinFareOption(){this.minFareOptionConfig={minPrice:new Map,airlineMinPrice:[{airline:u.QK.VJ,airlineName:"Vietjet Air",color:"#E03C31",selected:!0},{airline:u.QK.VN,airlineName:"Vietnam Airlines",color:"#2E5EAA",selected:!0}],isRangeMinFare:!1,showMinPrice:!0,showLunarDate:!0}}initDateSearchMinFare(t=new Date){const i=_(t).format("YYYY-MM-DD"),n=_(t).add(1,"month").startOf("month").format("YYYY-MM-DD");this.listDateSearchMinFares.push(i),this.listDateSearchMinFares.push(n)}loadJourneyInfo(){this.adultNumber=this._dataProvider.searchInputData.adult,this.childNumber=this._dataProvider.searchInputData.child,this.journeys=this._dataProvider.searchInputData.journey,this.isDirectFlight=this._searchInputService.isDirectFlight,this.startPoint=this._locationData.getCityNameByCode(this.journeys[0].startPoint),this.endPoint=this._locationData.getCityNameByCode(this.journeys[0].endPoint)}openSearchInputBottomSheet(t){this.bottomSheetRef=this._bottomSheetService.open(t,{headerTitle:"T\xecm ki\u1ebfm",leftButtonIcon:"close",rightButtonIcon:"",leftButtonIconClass:"text-neutral-gray-4",containerFullHeigh:!0}),this.bottomSheetRef.containerInstance._leftButtonClick.subscribe(i=>this.bottomSheetRef.dismiss())}flightTypeChange(t){this.flightTypeSearch=t,this.onFlightTypeChange.emit(t)}numberOfPassengerChange(t){this._searchInputService.numberOfPassengerChange(t),this._searchInputService.suggestPromotion()}airlineFilterChange(t){this._searchInputService.airlineFilterChange(t)}addMultiRoute(){this._searchInputService.addMultiRoute()}removeRoute(t){this._searchInputService.removeRoute(t)}suggestPromotion(){this._searchInputService.suggestPromotion()}removeAllDataMultiRoute(){this._searchInputService.removeAllDataMultiRoute()}onCheckDirectFlight(t){this._searchInputService.checkDirectFlight(t),this.isDirectFlight=this._searchInputService.isDirectFlight}researchFlight(){this.bottomSheetRef.dismiss(),this.onReseachFlight.emit(),this.loadJourneyInfo()}openQuotation(){this.onQuotation.emit()}cabinChange(t){this._searchInputService.cabinChange(t)}paxTypeChange(t){this._searchInputService.paxTypeChange(t)}onNavigateDatepicker(t){const i=this.generateRangeDateSearchMinFare(t),n=[];i.forEach(a=>{this.listDateSearchMinFares.some(r=>r.includes(a))||(this.listDateSearchMinFares.push(a),n.push(a))}),n.length&&this.searchMinFaresApi(this.listDateSearchMinFares)}generateRangeDateSearchMinFare(t){const i=_(new Date),n=_(t);let a=[];a.push(i.format("YYYY-MM-DD"));let r=i.clone().add(1,"month").startOf("month");for(;r.isBefore(n)||r.isSame(n,"month");)a.push(r.format("YYYY-MM-DD")),r.add(1,"month");return a}searchMinFaresApi(t){const i=this._searchInputService.getSearchInputData();if(i.startPoint&&i.endPoint){let n=[];this.flightTypeSearch===o.jX.OneWay&&(n=t.map(a=>({departDate:_(new Date(a)).format("YYYY-MM-DD"),endPoint:i.endPoint,leg:0,providers:`${u.QK.VJ},${u.QK.VN}`,startPoint:i.startPoint}))),this.flightTypeSearch===o.jX.RoundTrip&&(n=t.map(a=>({departDate:_(new Date(a)).format("YYYY-MM-DD"),endPoint:i.endPoint,leg:0,providers:`${u.QK.VJ},${u.QK.VN}`,startPoint:i.startPoint})),n.push(...t.map(a=>({departDate:_(new Date(a)).format("YYYY-MM-DD"),endPoint:i.startPoint,leg:1,providers:`${u.QK.VJ},${u.QK.VN}`,startPoint:i.endPoint})))),this._searchFlightService.searchMinFare(n).subscribe({next:a=>{"OK"===a.status&&a.data.length&&(this.searchMinFaresResult=a.data,this.searchMinFaresCurrentLegResult=this.searchMinFaresResult.find(r=>r.leg===n[0].leg),this.mappingMinFares())}})}}onToggleAirline(t){t&&this.mappingMinFares()}mappingMinFares(){if(this.searchMinFaresCurrentLegResult){this.minFareOptionConfig.minPrice=new Map;const t=this.minFareOptionConfig.airlineMinPrice.filter(i=>i.selected).map(i=>i.airline);Object.entries(this.searchMinFaresCurrentLegResult.data).forEach(i=>{const n=i[1].filter(p=>t.includes(p.key)),a=n.length?n.reduce((p,l)=>l.value<p.value?l:p):null,r=a?this.minFareOptionConfig.airlineMinPrice.find(p=>p.airline===a.key):null;this.minFareOptionConfig.minPrice.set(i[0],a?{price:Math.ceil(a.value/1e3),airline:(null==r?void 0:r.airline)||a.key,airlineName:(null==r?void 0:r.airlineName)||a.key,color:(null==r?void 0:r.color)||""}:null)}),this.minFareOptionConfig=Object.assign({},this.minFareOptionConfig)}}searchInputChange(){this.suggestPromotion(),this._searchInputService.checkInternationalFlight(),this.searchMinFaresApi(this.listDateSearchMinFares)}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(M.v),e.Y36(y.t7),e.Y36(Z.R),e.Y36(N._),e.Y36(h.KNP),e.Y36(Y.a2),e.Y36(d.$A))},s.\u0275cmp=e.Xpm({type:s,selectors:[["mobile-search-input"]],inputs:{currentMode:"currentMode"},outputs:{onReseachFlight:"onReseachFlight",onFlightTypeChange:"onFlightTypeChange",onQuotation:"onQuotation"},standalone:!0,features:[e.jDz],decls:22,vars:9,consts:[[1,"flex","items-center","justify-between","w-full"],[1,"flex","flex-col","grow-1","gap-y-1"],[1,"flex","items-center","gap-x-1"],[1,"text-espressive-sm","text-neutral-gray-6"],["class","text-secondary-7-5","icon","arrow_right","size","small",4,"ngIf"],["class","rotate-90 text-secondary-7-5","icon","sort","size","small",4,"ngIf"],[1,"p-1","rounded-full","bg-secondary-6-1"],["icon","edit","size","small",1,"text-secondary-6-4",3,"click"],[1,"flex","items-center"],["class","text-body-sm text-neutral-gray-5",4,"ngIf"],[1,"w-0","border-r","border-r-secondary-7-2","mx-1","h-4"],[1,"text-body-sm","text-neutral-gray-5"],[4,"ngIf"],["class","flex items-center gap-x-1.5",3,"click",4,"ngIf"],["searchInputBottomSheet",""],["icon","arrow_right","size","small",1,"text-secondary-7-5"],["icon","sort","size","small",1,"rotate-90","text-secondary-7-5"],[1,"flex","items-center","gap-x-1.5",3,"click"],["icon","document","size","small"],[1,"text-body-md-short"],[1,"bg-neutral-white","p-6","rounded-lg","w-full","shadow-cf-md","md:p-4"],[1,"flex","items-center","justify-between","mb-5"],[1,"md:w-full"],[3,"flightType","flightTypeSearchChange"],[1,"flex","items-center","justify-end","gap-4","flex-wrap","md:hidden"],[3,"adultNumber","childNumber","infantNumber","numberOfPassengerChange"],[3,"airlineList","airlineFilterChange"],[3,"isShowTooltipFirstTime","promotionGroupList"],[3,"cabinList","actived","cabinChange"],[3,"paxTypeList","actived","paxTypeChange"],[1,"mb-[20px]","md:mb-4"],[3,"formArray","minFareOptionConfig","removeRoute","dataChange","toggleAirline","navigateDatepicker"],[1,"gap-2","hidden","md:flex","flex-wrap","overflow-x-auto"],["class","flex items-center gap-x-10 mb-5",4,"ngIf"],[1,"h-0","border-b","border-b-neutral-gray-2","my-4","hidden","md:block"],[1,"flex","justify-between","items-center","md:flex-col","md:items-start","md:gap-y-4"],[1,"flex","justify-start","gap-x-[34px]"],[1,"flex","items-center","gap-3"],["size","medium",3,"checked","checkChange"],["cf-button","","size","medium","color","primary-1","type","solid",1,"md:w-full","md:justify-center",3,"click"],["icon","search","size","small",1,"mr-2.5"],[1,"flex","items-center","gap-x-10","mb-5"],[1,"flex","items-center","text-secondary-1-5","cursor-pointer",3,"click"],["icon","plus","size","small",1,"mr-2.5"],[1,"text-heading-xs"],[1,"flex","items-center","text-neutral-black","cursor-pointer",3,"click"],["icon","rotate_left","size","small",1,"mr-2.5"],[1,"text-body-md"]],template:function(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4),e.qZA(),e.YNc(5,R,1,0,"cf-icon",4),e.YNc(6,w,1,0,"cf-icon",5),e.TgZ(7,"div",3),e._uU(8),e.qZA(),e.TgZ(9,"div",6)(10,"cf-icon",7),e.NdJ("click",function(){e.CHM(n);const r=e.MAs(21);return e.KtG(i.openSearchInputBottomSheet(r))}),e.qZA()()(),e.TgZ(11,"div",8),e.YNc(12,J,3,4,"div",9),e.YNc(13,k,4,8,"div",9),e._UZ(14,"div",10),e.TgZ(15,"div",11),e.YNc(16,j,2,0,"div",12),e.YNc(17,E,2,0,"div",12),e.qZA()()(),e.TgZ(18,"div"),e.YNc(19,Q,4,0,"div",13),e.qZA()(),e.YNc(20,K,28,25,"ng-template",null,14,e.W1O)}2&t&&(e.xp6(4),e.Oqu(i.startPoint),e.xp6(1),e.Q6J("ngIf",1===i.journeys.length),e.xp6(1),e.Q6J("ngIf",2===i.journeys.length),e.xp6(2),e.Oqu(i.endPoint),e.xp6(4),e.Q6J("ngIf",1===i.journeys.length),e.xp6(1),e.Q6J("ngIf",2===i.journeys.length),e.xp6(3),e.Q6J("ngIf",1===i.journeys.length),e.xp6(1),e.Q6J("ngIf",2===i.journeys.length),e.xp6(2),e.Q6J("ngIf",i.showQuotation&&"retail"===i.currentMode))},dependencies:[v.ez,v.O5,v.uU,h.AxE,h.Sm8,o.DA,f.N8,f.Xq,S.u,o.z6,o.h4,o.uX,o.t3,m.u5,m.UX,F.Bz,o.qB,o.P_],encapsulation:2}),s})()},17997:(x,b,c)=>{c.d(b,{W:()=>v});var d=c(94650);let v=(()=>{class m{get searchMinFareData(){return JSON.parse(sessionStorage.getItem("searchMinFareData"))}set searchMinFareData(f){const S=f.map(h=>Object.assign(Object.assign({},h),{data:Object.fromEntries(h.data)}));sessionStorage.setItem("searchMinFareData",JSON.stringify(S))}removeSearchMinFareData(){sessionStorage.removeItem("searchMinFareData")}}return m.\u0275fac=function(f){return new(f||m)},m.\u0275prov=d.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()}}]);