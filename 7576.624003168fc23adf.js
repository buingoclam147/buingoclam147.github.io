"use strict";(self.webpackChunkcheapflightclient=self.webpackChunkcheapflightclient||[]).push([[7576],{77576:(E,y,l)=>{l.r(y),l.d(y,{CreateRolePageComponent:()=>B,RoleManagePageComponent:()=>D});var p=l(36895),n=l(72506),d=l(83700),C=l(48373),b=l(39840),k=l(28746),e=l(94650),u=l(14580),h=l(82761);function c(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"tr",12)(1,"td",13),e._uU(2),e.qZA(),e.TgZ(3,"td",13),e._uU(4),e.qZA(),e.TgZ(5,"td",14)(6,"button",15),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.edit(s.id))}),e._uU(7,"S\u1eeda"),e.qZA()()()}if(2&o){const t=m.$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description)}}function g(o,m){1&o&&e._UZ(0,"cf-spinner")}const F=function(){return{num:25}},M=function(){return{num:50}},R=function(){return{num:75}},w=function(){return{num:100}},S=function(o,m,t,i){return[o,m,t,i]};let D=(()=>{class o{constructor(t,i,r){this._roleService=i,this._router=r,this.listOfData=[],this.pageSize=25,this.currentPage=1,this.isLoading=!1,this.sortChange=(s,a)=>{let v=a.map(_=>_);for(let _=0;_<s.length;_++){const A=s[_];"name"===A.key&&(v=v.sort("ascend"===A.sort?(P,Z)=>this.increaseAlphabetSort(P.name,Z.name):(P,Z)=>this.decreaseAlphabetSort(P.name,Z.name)))}return v},this.searchChange=(s,a)=>a,this.increaseAlphabetSort=(s,a)=>s<a?-1:s>a?1:0,this.decreaseAlphabetSort=(s,a)=>s>a?-1:s<a?1:0,t.registerIcons([]),this.onSearch()}onSearch(){this.isLoading=!0,this._roleService.getAllRole().pipe((0,k.x)(()=>this.isLoading=!1)).subscribe({next:t=>{this.listOfData=t.data}})}checkChange(t){this.pageSize=parseInt(t)}addRole(){this._router.navigate(["admin/create-role"])}edit(t){this._router.navigate([`admin/edit-role/${t}`])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(n.KNP),e.Y36(u.Nj),e.Y36(h.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["role-manage-page"]],standalone:!0,features:[e.jDz],decls:19,vars:17,consts:[[1,"py-4","px-[30px]","rounded-lg"],[1,"bg-neutral-white","rounded-lg","shadow-cf-md"],[1,"p-4","flex","justify-between","items-center"],[1,"text-heading-sm"],["cf-button","","type","secondary",3,"click"],[1,"",3,"fnSort","fnSearch","pageSizeList","listData","pageSize"],["managerTable",""],["cf-thead",""],["cf-th","",1,"whitespace-nowrap",3,"sortName"],["cf-th","",1,"whitespace-nowrap"],["ngFor","",3,"ngForOf"],[4,"ngIf"],[1,"border-b","border-neutral-gray-1"],["cf-td","",1,"py-2","px-3","text-body-sm"],["cf-td","",1,"py-2","px-3"],["cf-button","","size","small","type","secondary",3,"click"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4,"Qu\u1ea3n l\xfd quy\u1ec1n"),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return i.addRole()}),e._uU(6," Th\xeam quy\u1ec1n "),e.qZA()(),e.TgZ(7,"cf-table",5,6)(9,"thead",7)(10,"th",8),e._uU(11,"Quy\u1ec1n"),e.qZA(),e.TgZ(12,"th",9),e._uU(13,"M\xf4 t\u1ea3"),e.qZA(),e.TgZ(14,"th",9),e._uU(15,"Thao t\xe1c"),e.qZA()(),e.TgZ(16,"tbody"),e.YNc(17,c,8,2,"ng-template",10),e.qZA()()()(),e.YNc(18,g,1,0,"cf-spinner",11)),2&t){const r=e.MAs(8);e.xp6(7),e.Q6J("fnSort",i.sortChange)("fnSearch",i.searchChange)("pageSizeList",e.l5B(12,S,e.DdM(8,F),e.DdM(9,M),e.DdM(10,R),e.DdM(11,w)))("listData",i.listOfData)("pageSize",i.pageSize),e.xp6(3),e.Q6J("sortName","name"),e.xp6(7),e.Q6J("ngForOf",r.partOfdata),e.xp6(1),e.Q6J("ngIf",i.isLoading)}},dependencies:[p.ez,p.sg,p.O5,n.AxE,d.N8,d.Xq,C.rC,C.E_,C.zs,C.qS,b.OR],encapsulation:2}),o})();var f=l(24006),x=l(44143),z=l(27898),T=l(62331);function N(o,m){1&o&&e._UZ(0,"cf-input-hint",14),2&o&&e.Q6J("hint","Nh\u1eadp t\xean quy\u1ec1n")}function U(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"div",19)(1,"div")(2,"cf-checkbox",20),e.NdJ("checkChange",function(r){const a=e.CHM(t).$implicit,v=e.oxw(2);return e.KtG(v.permissionChange(r,a))}),e.TgZ(3,"div",21),e._uU(4),e.qZA()()()()}if(2&o){const t=m.$implicit;e.xp6(2),e.Q6J("checked",t.actived),e.xp6(2),e.hij(" ",t.description," ")}}function J(o,m){if(1&o&&(e.TgZ(0,"div",15)(1,"div",16),e._uU(2),e.qZA(),e.TgZ(3,"div",17),e.YNc(4,U,5,2,"div",18),e.qZA()()),2&o){const t=m.$implicit;e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Q6J("ngForOf",t.permissions)}}function O(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.submit())}),e._uU(1,"T\u1ea1o m\u1edbi"),e.qZA()}}function q(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.submit())}),e._uU(1,"L\u01b0u"),e.qZA()}}let B=(()=>{class o{constructor(t,i,r,s,a){this._fb=t,this._roleService=i,this._router=r,this._toastService=s,this._route=a,this.allPermissionCategory=[],this.enabledPermission=[],this.editMode=!1,this.roleForm=t.group({name:["",f.kI.required],description:[""]}),a.snapshot.params.id?(this.editMode=!0,this.id=a.snapshot.params.id,this.initPermission(this.id)):this.initPermission(null)}initCurrentRolePermission(t){this._roleService.getRole(t).subscribe({next:i=>{this.allPermissionCategory.flatMap(r=>r.permissions).filter(r=>i.data.permissions.includes(r.name)).forEach(r=>this.permissionChange(!0,r)),this.roleForm.controls.name.setValue(i.data.name),this.roleForm.controls.description.setValue(i.data.description)},error:()=>{this._toastService.add({severity:"error",summary:"C\xf3 l\u1ed7i x\u1ea3y ra khi l\u1ea5y d\u1eef li\u1ec7u quy\u1ec1n",detail:"",sticky:!1})}})}initPermission(t){this._roleService.getAllPermission().subscribe({next:i=>{this.allPermissionCategory=i.data.map(r=>({description:r.description,name:r.name,permissions:r.permissions.map(s=>({description:s.description,category:s.category,name:s.name,isSecurityCritical:s.isSecurityCritical,impliedBy:s.impliedBy?s.impliedBy.map(a=>({description:a.description,category:a.category,name:a.name,isSecurityCritical:a.isSecurityCritical,impliedBy:[],actived:!1})):[],actived:!1}))})),t&&this.initCurrentRolePermission(this.id)}})}permissionChange(t,i){t?(i.actived=!0,this.allPermissionCategory.flatMap(s=>s.permissions).filter(s=>s.impliedBy.filter(a=>a.name===i.name).length>0).forEach(s=>s.actived=!0)):(this.removePermission(i),this.removePermissionImplied(i))}removePermission(t){t.actived=!1}removePermissionImplied(t){this.allPermissionCategory.flatMap(i=>i.permissions).filter(i=>i.impliedBy.filter(r=>r.name===t.name).length>0).forEach(i=>{this.removePermission(i)}),this.allPermissionCategory.flatMap(i=>i.permissions).filter(i=>t.impliedBy.map(r=>r.name).includes(i.name)).forEach(i=>this.removePermission(i))}submit(){this.enabledPermission=this.allPermissionCategory.flatMap(t=>t.permissions).filter(t=>t.actived).map(t=>t.name),this.enabledPermission=this.allPermissionCategory.flatMap(t=>t.permissions).filter(t=>!(!t.actived||t.impliedBy.length>0&&t.impliedBy.map(i=>i.name).filter(i=>this.enabledPermission.includes(i)).length>0)).map(t=>t.name),this.roleForm.valid&&(this.editMode?this.processUpdateRole():this.processCreateRole())}processCreateRole(){this._roleService.createRole({name:this.roleForm.controls.name.value,description:this.roleForm.controls.description.value,permissions:this.enabledPermission}).subscribe({next:t=>{this._router.navigate(["admin/role-manage"])},error:t=>{this._toastService.add({severity:"error",summary:"C\xf3 l\u1ed7i x\u1ea3y ra",detail:"",sticky:!1})}})}processUpdateRole(){this._roleService.updateRole({id:this.id,name:this.roleForm.controls.name.value,description:this.roleForm.controls.description.value,permissions:this.enabledPermission}).subscribe({next:t=>{this._router.navigate(["admin/role-manage"])},error:t=>{this._toastService.add({severity:"error",summary:"C\xf3 l\u1ed7i x\u1ea3y ra",detail:"",sticky:!1})}})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.qu),e.Y36(u.Nj),e.Y36(h.F0),e.Y36(T.BX),e.Y36(h.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-create-role-page"]],standalone:!0,features:[e.jDz],decls:21,vars:8,consts:[[1,"flex","justify-center","py-4","px-[30px]","rounded-lg"],[1,"bg-neutral-white","rounded-lg","shadow-cf-md","w-[1000px]","max-w-[1000px]"],[1,"p-4","flex","justify-between","items-center"],[1,"text-heading-sm"],[1,"p-4"],[1,"grow-[400]","!w-full",3,"status"],["cfLabel","",1,"text-espressive-sm","text-black","mb-1.5"],["cf-input","","size","medium","placeholder","Nh\u1eadp t\xean",3,"formControl"],["cfHint","",3,"hint",4,"ngIf"],["cf-input","","size","medium","placeholder","Nh\u1eadp m\xf4 t\u1ea3",3,"formControl"],[1,"p-4","pt-0","flex","flex-col","gap-y-6"],["class","flex flex-col items-start gap-y-4",4,"ngFor","ngForOf"],[1,"p-4","flex","justify-end"],["cf-button","","size","medium","color","primary-1",3,"click",4,"ngIf"],["cfHint","",3,"hint"],[1,"flex","flex-col","items-start","gap-y-4"],[1,"text-espressive-md"],[1,"pl-2","text-neutral-gray-5","flex","flex-col","gap-y-4","w-full"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"flex","items-center"],["size","medium",3,"checked","checkChange"],[1,"text-espressive-md","text-neutral-gray-5"],["cf-button","","size","medium","color","primary-1",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4,"T\u1ea1o m\u1edbi quy\u1ec1n"),e.qZA()(),e.TgZ(5,"div",4)(6,"cf-input-group",5)(7,"label",6),e._uU(8," T\xean quy\u1ec1n "),e.qZA(),e._UZ(9,"input",7),e.YNc(10,N,1,1,"cf-input-hint",8),e.qZA(),e.TgZ(11,"cf-input-group",5)(12,"label",6),e._uU(13," M\xf4 t\u1ea3 "),e.qZA(),e._UZ(14,"input",9),e.qZA()(),e.TgZ(15,"div",10),e.YNc(16,J,5,2,"div",11),e.qZA(),e.TgZ(17,"div",12),e.YNc(18,O,2,0,"button",13),e.YNc(19,q,2,0,"button",13),e.qZA()()(),e._UZ(20,"cf-toast")),2&t&&(e.xp6(6),e.Q6J("status",i.roleForm.controls.name.invalid&&(i.roleForm.controls.name.dirty||i.roleForm.controls.name.touched)?"error":"default"),e.xp6(3),e.Q6J("formControl",i.roleForm.controls.name),e.xp6(1),e.Q6J("ngIf",(null==i.roleForm.controls.name.errors?null:i.roleForm.controls.name.errors.required)&&(i.roleForm.controls.name.dirty||i.roleForm.controls.name.touched)),e.xp6(1),e.Q6J("status",i.roleForm.controls.name.invalid&&(i.roleForm.controls.description.dirty||i.roleForm.controls.description.touched)?"error":"default"),e.xp6(3),e.Q6J("formControl",i.roleForm.controls.description),e.xp6(2),e.Q6J("ngForOf",i.allPermissionCategory),e.xp6(2),e.Q6J("ngIf",!i.editMode),e.xp6(1),e.Q6J("ngIf",i.editMode))},dependencies:[p.ez,p.sg,p.O5,f.u5,f.Fj,f.JJ,f.UX,f.oH,x.j$,x.ND,x.BN,x.v2,z.u,d.N8,d.Xq,T.hj],encapsulation:2}),o})()},27898:(E,y,l)=>{l.d(y,{u:()=>e});var p=l(36895),n=l(94650),d=l(72506);function C(u,h){if(1&u&&(n.O4$(),n.TgZ(0,"svg",4),n._UZ(1,"path",5),n.qZA()),2&u){const c=n.oxw();n.ekj("fill-neutral-gray-1",c.disabled)("stroke-neutral-gray-3",c.disabled)("w-5","medium"==c.size)("h-5","medium"==c.size)}}function b(u,h){if(1&u&&(n.O4$(),n.TgZ(0,"svg",4),n._UZ(1,"path",6)(2,"path",7),n.qZA()),2&u){const c=n.oxw();n.ekj("!text-neutral-gray-3",c.disabled)("w-5","medium"==c.size)("h-5","medium"==c.size)}}const k=["*"];let e=(()=>{class u{constructor(c){this.cfIconRegister=c,this.checked=!1,this.size="small",this.disabled=!1,this.checkChange=new n.vpe,c.registerIcons([d.aCG,d.llu])}toggle(){this.checked=!this.checked,this.checkChange.emit(this.checked)}}return u.\u0275fac=function(c){return new(c||u)(n.Y36(d.KNP))},u.\u0275cmp=n.Xpm({type:u,selectors:[["cf-checkbox"]],inputs:{checked:"checked",size:"size",disabled:"disabled"},outputs:{checkChange:"checkChange"},standalone:!0,features:[n.jDz],ngContentSelectors:k,decls:5,vars:8,consts:[[1,"flex","items-center","gap-x-2","hover","text-neutral-gray-4","hover:text-primary-2-4","focus:text-primary-2-4","cursor-pointer",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","none","viewBox","0 0 16 16",3,"fill-neutral-gray-1","stroke-neutral-gray-3","w-5","h-5",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","none","viewBox","0 0 16 16",3,"!text-neutral-gray-3","w-5","h-5",4,"ngIf"],[1,"text-body-md","text-neutral-black"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","none","viewBox","0 0 16 16"],["stroke","currentColor","stroke-linejoin","round","stroke-width","1.5","d","M11.333 2.667H4.667a2 2 0 0 0-2 2v6.666a2 2 0 0 0 2 2h6.666a2 2 0 0 0 2-2V4.667a2 2 0 0 0-2-2Z"],["fill","currentColor","stroke","currentColor","stroke-linejoin","round","stroke-width","1.5","d","M11.333 2.667H4.667a2 2 0 0 0-2 2v6.666a2 2 0 0 0 2 2h6.666a2 2 0 0 0 2-2V4.667a2 2 0 0 0-2-2Z"],["stroke","#fff","stroke-linecap","round","stroke-linejoin","round","d","M11.333 5.333 7.133 10l-1.8-2"]],template:function(c,g){1&c&&(n.F$t(),n.TgZ(0,"div",0),n.NdJ("click",function(){return g.toggle()}),n.YNc(1,C,2,8,"svg",1),n.YNc(2,b,3,6,"svg",2),n.TgZ(3,"div",3),n.Hsn(4),n.qZA()()),2&c&&(n.ekj("!text-primary-2-4",g.checked)("pointer-events-none",g.disabled),n.xp6(1),n.Q6J("ngIf",!g.checked),n.xp6(1),n.Q6J("ngIf",g.checked),n.xp6(1),n.ekj("!text-neutral-gray-4",g.disabled))},dependencies:[d.AxE,p.O5],encapsulation:2,changeDetection:0}),u})()}}]);